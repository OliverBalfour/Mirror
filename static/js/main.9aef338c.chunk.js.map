{"version":3,"sources":["backends/indexeddb.js","backends/github.js","backends/edit-set.js","backends/index.js","kanban/utils.js","reducer.js","components/popovermenu.js","components/tabview.js","store.js","components/markdown.js","components/autoresize-textarea.js","components/autocomplete-editor.js","kanban/attributes/description.js","kanban/attributes/datetime.js","kanban/attributes/duration.js","kanban/attributes/location.js","kanban/attributes/index.js","components/dialogs.js","components/menubar.js","components/undoredo.js","components/loading-screen.js","kanban/column-header.js","kanban/card.js","kanban/column.js","kanban/boardview.js","kanban/index.js","zettelkasten/index.js","app.js","serviceWorker.js","index.js","common/string.js","common/react.js","common/time.js","common/index.js","components/markdown-base.js"],"names":["loadState","a","loadAll","initial","generateInitialState","state","saveState","keys","length","loadLegacyLocalStorageState","loadIDBState","console","error","getAllInNamespace","namespace","whitelist","promises","key","chunks","split","id","indexOf","push","get","then","Promise","all","cards","columns","tabs","standaloneNamespaces","colID","items","Object","prototype","hasOwnProperty","call","localStorage","result","JSON","parse","kanban","e","loading","set","shallowNamespaces","load","commit","editSet","edit","type","object","del","value","window","deleteAllState","map","res","i","startsWith","pruneUnusedState","deleteOrphaned","KANBAN_CARD_TYPE","ZETTEL_NOTE_TYPE","deletedTabs","tabOrder","tab","splice","notDeletedTabs","filter","x","includes","notDeletedColumns","tabID","deletedColumns","notDeletedCards","cardID","deletedCards","stack","accessible","node","pop","string","content","description","matches","replace","match","linked","substring","location","reload","__idb","getAll","exportIDBState","obj","forEach","val","json","stringify","downloadData","importIDBState","document","body","innerHTML","input","getElementById","addEventListener","reader","FileReader","readAsText","files","onloadend","__octokit","getOctokit","Octokit","auth","config","token","sha","loggedIn","Boolean","gh","update","request","gist_id","compileEditSet","catch","updateLatestSHA","toString","filename","getEditFilename","serializeObject","getFilename","getObjectPath","parts","specialKeys","frontmatter","Date","getTime","serialized","join","deserializeObject","markdown","start","str","trim","leftPaddedValue","trimStart","getLatestSHA","latest","status","hasLoggedInBefore","log","synchroniseState","idb","forcePush","prompt","forcePull","getNewCommitSHAs","allSHAs","getAllModifiedFiles","diff","getDiffObject","current","EditSet","param","add","deserialize","endpoint","username","fetch","text","per_page","commits","data","version","since","SHAs","page_no","page","getGistRevision","response","revisions","revision","file","path","ptr","slice","layer","logOut","confirm","this","inv","old","other","j","shallowEqual","ids","getEditID","objectDict","oldDict","arrayOfIDs","delete","hist","editSetHistory","past","shift","future","undo","allowed","unshift","invert","redo","namespaceNames","ghb","local","editSetBuffer","timer","waitingOn","resolve","reject","concat","setTimeout","f","alert","handles","intervals","unsafeSetState","createAction","overwriteState","transferCard","reorderCard","addCard","editCardContent","editCard","deleteCard","archiveCard","addColumn","deleteColumn","renameColumn","moveColumn","archiveCardsInColumn","sortColByTime","addTab","deleteTab","renameTab","moveTab","addZettel","editZettel","deleteZettel","toggleZettelStarred","loadZettel","createAsyncThunk","thunkAPI","card","rejectWithValue","selectors","getColumnsInTabs","objectMap","col","archivedCards","values","activeCards","starredZettels","cardsByTab","flatMap","loadingZettel","validTabName","name","snackbar","variant","tabNames","toLowerCase","encURI","eventCardChanged","clearTimeout","time","remainingMS","ms","label","pushNotification","abbreviatedDescription","handleEventReminderForCard","reducer","createReducer","ps","payload","ns","structuredClone","deepMerge","ActionTypes","UNDO","REDO","epochms","srcColID","dstColID","srcIndex","dstIndex","produce","s","moved","edited","c","generateID","created","tabIdx","deleteInList","editAll","deleteAllByID","colIDs","editAllByID","column","concatSimple","cardIDs","srcIdx","dstIdx","archived","archivedFromColID","zettel","fullZettel","sort","b","aMS","bMS","pending","fulfilled","rejected","undoBlacklist","undoableReducer","undoable","limit","neverSkipReducer","action","currentState","previousHistory","children","React","anchorEl","setAnchorEl","handleClose","Menu","keepMounted","open","onClose","entries","func","MenuItem","onClick","currentTarget","render","index","setIndex","columnsLocked","toggleColumnsLocked","handleChange","event","newValue","Grow","style","flexGrow","className","AppBar","position","backgroundColor","zIndex","Tabs","onChange","indicatorColor","textColor","Tab","IconButton","store","configureStore","present","middleware","thunk","dispatch","core","activeElement","tagName","ctrlKey","which","shiftKey","UndoActionCreators","globalSelectors","boards","localSelector","KaTeXMarkdown","props","source","parseWikilinks","fallback","ref","setValue","offset","hiddenDivRef","inputRef","resize","hiddenDiv","swap","display","swapped","innerText","height","visibility","offsetHeight","useEventListener","padding","target","addNote","useSelector","editor","TextareaEditor","strategy","context","beforeCursor","search","term","callback","searchCards","maxCount","cache","template","linkName","options","dropdown","rotate","textcomplete","Textcomplete","destroy","Edit","setCard","editingDescription","setEditingDescription","handleKeyDown","stopPropagation","InputLabel","ClickAwayListener","onClickAway","mouseEvent","onKeyDown","undefined","autoFocus","marginTop","overflow","tabIndex","onDoubleClick","Indicator","title","icon","enAU","weekStart","setDateTime","utils","DateFnsUtils","locale","DateTimePicker","newDate","showTodayButton","format","size","marginLeft","startOfToday","prettyPrintDate","timeUrgencyClassName","duration","prettySeconds","durationStr","setDurationStr","autoFocusRef","setDuration","unprettySeconds","focus","invalid","TextField","width","margin","fullWidth","helperText","days","Math","floor","hours","minutes","groups","exec","pf","k","parseFloat","_setLocation","setLocation","AttributeIndicators","AttributeEditingFields","IndicatorBuilder","Chip","classes","AttributeHeader","Button","color","useCtrlEnter","ConfirmDialog","respond","subtitle","labels","useFlag","Dialog","DialogTitle","DialogContent","DialogContentText","DialogActions","PromptDialog","inputType","placeholder","buttons","CardEditDialog","useDispatch","currentColID","sel","setColID","newCard","setContent","done","maxWidth","disableBackdropClick","shouldProtect","Select","labelId","ListSubheader","multiline","rowsMax","flexDirection","AboutDialog","href","GitHubLoginDialog","setToken","gistID","setGistID","setUsername","autoComplete","active","setActive","useState","aboutOpen","setAboutOpen","GHOpen","setGHOpen","menuItems","Notification","requestPermission","permission","theme","setTheme","Fragment","Toolbar","minHeight","TabIndicatorProps","verticalAlign","edge","postLogIn","ActionCreators","locked","handleProps","confirmOpen","setConfirmOpen","promptOpen","setPromptOpen","dateTimeAttributeUsed","setEditingCard","draggableId","provided","snapshot","innerRef","draggableProps","dragHandleProps","isDragging","editingNew","setEditingNew","editingValue","setEditingValue","addButton","scrollContainerRef","scrollTop","internals","droppableId","ignoreContainerClipping","isDraggingOver","mergeRefs","cancel","isDragDisabled","EditingCard","flagSet","ButtonGroup","AddColumn","hide","tabInfo","tabObj","useHashLocation","loc","setLoc","editingCard","tabIDfromCardID","onDragEnd","destination","direction","draggingFromThisWith","currentTab","setCurrentTab","num","useTitle","__lastCurrentTab","_setColumnsLocked","addPromptOpen","setAddPromptOpen","renamePromptOpen","setRenamePromptOpen","tabName","max","currentCardID","ZettelLoadingView","ZettelFailedLoadingView","ZettelView","editing","starred","setNewCard","part","saveZettel","setEditing","yes","starZettel","ZettelButtons","baseTabNames","ComponentsContainer","show","Root","useInterval","tabURLs","setTabURLs","setLoading","enqueueSnackbar","useSnackbar","currentlyLoading","setTabURL","newURL","move","newTabURLs","n","getScreen","maxSnack","autoHideDuration","containerRoot","hostname","ReactDOM","navigator","serviceWorker","ready","registration","unregister","message","firstLine","m","prefix","regex","lastIndex","parseable","before","link","after","countRegexOccurrences","re","parseLaTeX","katex","blockRegex","inlineRegex","displayMode","renderToString","throwOnError","fmapRegexMatch","encodeURIComponent","refs","filteredRefs","inst","currentLoc","hash","handler","removeEventListener","navigate","to","__useTitleInUse","original","setInterval","clearInterval","elem","flagName","ReloadProtect","onbeforeunload","Hidden","RawHTMLString","purify","dangerouslySetInnerHTML","__html","DOMPurify","sanitize","ADD_ATTR","ErrorBoundary","hasError","ThemeProvider","themes","dark","createMuiTheme","palette","primary","main","secondary","warning","info","success","light","setState","documentElement","__lastGeneratedID","date","timeString","fn","newID","parseInt","epochMilliseconds","now","getHours","getMinutes","weekDiff","weekStartsOn","yearDiff","dayOfWeek","getDay","day","getDate","remaining","mapFn","reduce","obj1","obj2","every","list","oldState","history","replaceState","copy","isObject","item","Array","isArray","createElement","blob","Blob","URL","createObjectURL","download","click","allowArchived","tl","initialState","actionMap","prevState","nextState","PrismMarked","renderer","marked","Renderer","use","MarkdownBase","postprocess","RawMarkdown","gfm"],"mappings":"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","file":"static/js/main.9aef338c.chunk.js","sourcesContent":["\n/**\n * IndexedDB backend for offline use and caching (98% browser support via caniuse)\n *\n * Cards, columns and tabs are stored individually indexed with \"mirror.namespace.id\"\n * eg you could get card ID 12345 via get(\"mirror.cards.12345\").then(card => doStuff())\n */\n\n// IndexedDB wrapper with a simple async key-value storage API\nimport { get, set, keys, del } from 'idb-keyval';\nimport { generateInitialState, standaloneNamespaces, shallowNamespaces } from './index';\nimport { downloadData } from '../common';\n\n// If loadAll is false, zettels other than main are not loaded (need lazy loading)\nexport async function loadState (loadAll = true) {\n  const initial = async () => {\n    const state = await generateInitialState();\n    await saveState(state);\n    return state;\n  };\n  const idbKeys = await keys();\n  if (!idbKeys.length) {\n    const state = loadLegacyLocalStorageState();\n    if (state) {\n      await saveState(state);\n      return state;\n    }\n    return await initial();\n  }\n  try {\n    return await loadIDBState(loadAll);\n  } catch (e) {\n    console.error(e);\n    return await initial();\n  }\n}\n\nconst getAllInNamespace = async (state, namespace, whitelist = null) => {\n  let promises = [];\n  for (let key of await keys()) {\n    let chunks = key.split('.');\n    if (chunks[1] === namespace) {\n      let id = chunks[2];\n      if (whitelist && whitelist.indexOf(id) === -1) continue;\n      promises.push(\n        get(key).then(key => state[namespace][id] = key)\n      );\n    }\n  }\n  await Promise.all(promises);\n  return state;\n}\n\nexport async function loadIDBState (loadAll = true) {\n  const state = {\n    cards: {},\n    columns: {},\n    tabs: {},\n  };\n  for (let key of standaloneNamespaces) {\n    state[key] = await get(`mirror.${key}`) || [];\n  }\n  let promises = [\n    getAllInNamespace(state, 'tabs'),\n    getAllInNamespace(state, 'columns').then(() => {\n      if (!loadAll) {\n        // Only load cards in the Kanban boards and the main Zettelkasten note\n        let whitelist = ['main'];\n        for (let colID in state.columns) {\n          whitelist.push(...state.columns[colID].items);\n        }\n        return getAllInNamespace(state, 'cards', whitelist);\n      } else {\n        return getAllInNamespace(state, 'cards');\n      }\n    })\n  ];\n  await Promise.all(promises);\n  return state;\n}\n\nfunction loadLegacyLocalStorageState () {\n  try {\n    if (Object.prototype.hasOwnProperty.call(localStorage, 'kanban')) {\n      const result = JSON.parse(localStorage.kanban);\n      delete localStorage.kanban;\n      return result;\n    }\n  } catch (e) {\n    console.error(e);\n    return null;\n  }\n}\n\nexport async function saveState (state) {\n  try {\n    if (!state || state.loading) return;\n    if (await get('mirror.starredZettels') == null)\n      await set('mirror.starredZettels', []);\n    for (let key of standaloneNamespaces) {\n      if (Object.prototype.hasOwnProperty.call(state, key))\n        await set(`mirror.${key}`, state[key]);\n    }\n    let promises = [];\n    for (let namespace of shallowNamespaces) {\n      for (let id in state[namespace]) {\n        promises.push(\n          set(`mirror.${namespace}.${id}`, state[namespace][id])\n        );\n      }\n    }\n    return await Promise.all(promises);\n  } catch (e) {\n    console.error(e);\n  }\n}\n\nexport async function load (namespace, id = null) {\n  try {\n    if (!id) { // eg tabOrder\n      return await get('mirror.'+namespace);\n    } else { // eg cards\n      return await get('mirror.'+namespace+'.'+id);\n    }\n  } catch (e) {\n    return null;\n  }\n}\n\nexport async function commit (editSet) {\n  const promises = [];\n  for (let edit of editSet.set) {\n    switch (edit.type) {\n      case 'add':\n      case 'edit':\n        promises.push(set(`mirror.${edit.namespace}.${edit.object.id}`, edit.object));\n        break;\n      case 'delete':\n        promises.push(del(`mirror.${edit.namespace}.${edit.id}`));\n        break;\n      case 'param':\n        promises.push(set(`mirror.${edit.namespace}`, edit.value));\n        break;\n      default:\n    }\n  }\n  return await Promise.all(promises);\n}\n\n// For manual intervention of corrupted state\nwindow.deleteAllState = async () => {\n  let res = await Promise.all((await keys()).map(key => del(key)));\n  for (let i = localStorage.length - 1; i >= 0; i--) {\n    const key = localStorage.key(i);\n    if (key.startsWith('__GITHUB')) {\n      delete localStorage[key];\n    }\n  }\n  return res;\n};\n\n// Deletes all invisible Kanban tabs/columns/cards (IDB stuff isn't ever deleted, only no longer linked to)\n// To delete orphaned zettels (ie not accessible via links from the main card) supply deleteOrphaned = true\n// This is useful for pruning indirectly accessible sensitive information from a state snapshot\n//  which needs to be publicly shared (eg the initial state JSON file)\n// This is far from optimized and should only be used in development with small amounts of data\n// **NOT WELL TESTED, MAKE A BACKUP FIRST**\n// It will delete notes only linked to by Kanban cards, for instance.\nwindow.pruneUnusedState = async (deleteOrphaned = false) => {\n  const state = await loadState();\n\n  const KANBAN_CARD_TYPE = 0;  // From reducers.js\n  const ZETTEL_NOTE_TYPE = 1;  // From reducers.js\n\n  // Find invisible Kanban tabs/columns/cards\n  const deletedTabs = Object.keys(state.tabs);\n  for (let tab of state.tabOrder) {\n    deletedTabs.splice(deletedTabs.indexOf(tab), 1);\n  }\n  const notDeletedTabs = Object.keys(state.tabs).filter(x => !deletedTabs.includes(x));\n\n  const notDeletedColumns = [];\n  for (let colID of Object.keys(state.columns)) {\n    for (let tabID of notDeletedTabs) {\n      if (state.tabs[tabID].columns.indexOf(colID) !== -1) {\n        notDeletedColumns.push(colID);\n      }\n    }\n  }\n  const deletedColumns = Object.keys(state.columns).filter(x => !notDeletedColumns.includes(x));\n\n  const notDeletedCards = [];\n  for (let cardID of Object.keys(state.cards)) {\n    for (let colID of notDeletedColumns) {\n      if (state.columns[colID].items.indexOf(cardID) !== -1) {\n        notDeletedCards.push(cardID);\n      }\n    }\n  }\n  const deletedCards = Object.keys(state.cards).filter(x => state.cards[x].type === KANBAN_CARD_TYPE && !notDeletedCards.includes(x));\n\n  if (deleteOrphaned) {\n    // Find inaccessible zettels\n    const stack = ['main'];\n    const accessible = [];\n    while (stack.length) {\n      const node = stack.pop();\n      accessible.push(node);\n      // Search content and description fields for note IDs\n      let string = state.cards[node].content + state.cards[node].description;\n      // Remove any substrings with ```any characters``` or `non newline chars`\n      // because wikilinks in these are ignored\n      string = string.replace(/```[^`]*```/gm, '').replace(/`[^`\\n]`/gm, '');\n      // Find all links (assumes [[note id]] format)\n      const matches = string.match(/(\\[\\[[A-Za-z0-9_-]+\\]\\])/gm);\n      const linked = matches ? matches.map(x => x.substring(2, x.length - 2)) : [];\n      // Push them to the stack if they haven't already been traversed \n      stack.push(...linked.filter(cardID => state.cards[cardID].type === ZETTEL_NOTE_TYPE && accessible.indexOf(cardID) === -1));\n    }\n    deletedCards.push(...Object.keys(state.cards).filter(cardID => state.cards[cardID].type === ZETTEL_NOTE_TYPE && accessible.indexOf(cardID) === -1));\n  }\n\n  // Do the deletion\n  while (deletedCards.length)\n    delete state.cards[deletedCards.pop()];\n  while (deletedColumns.length)\n    delete state.columns[deletedColumns.pop()];\n  while (deletedTabs.length)\n    delete state.tabs[deletedTabs.pop()];\n\n  // Delete all IDB keys and save only the pruned data\n  for (let key of await keys())\n    await del(key);\n  await saveState(state);\n  window.location.reload();\n};\n\nwindow.__idb = { get, set, keys, del };\nwindow.__idb.getAll = async () => Promise.all(\n  (await window.__idb.keys()).map(async x => [x, await window.__idb.get(x)])\n);\n\nwindow.exportIDBState = async () => {\n  const obj = {};\n  const values = await window.__idb.getAll();\n  values.forEach(([key, val]) => obj[key] = val);\n  const json = JSON.stringify(obj);\n  downloadData(json, \"mirror-backup.json\", \"application/json\");\n};\n\nwindow.importIDBState = async () => {\n  // Temporary hack\n  // Long term solution is to write an imperative API for creating file upload dialogs\n  // on the fly and use that here\n  document.body.innerHTML = \"Choose a file to upload, or reload to cancel.&nbsp;<input type='file' id='fileinput'/>\";\n  const input = document.getElementById('fileinput');\n  input.addEventListener(\"change\", async () => {\n    const reader = new FileReader();\n    reader.readAsText(input.files[0]);\n    reader.onloadend = async () => {\n      const obj = JSON.parse(reader.result);\n      const promises = [];\n      for (let key in obj) {\n        promises.push(set(key, obj[key]));\n      }\n      await Promise.all(promises);\n      window.location.reload();\n    }\n  });\n};\n","\n/**\n * GitHub Gist backend for synchronisation between clients\n *\n * Any discrepancies in the exported functions are due to API\n * limitations\n */\n\nimport { standaloneNamespaces, shallowNamespaces, EditSet } from './';\nimport * as idb from './indexeddb';\n\n// GitHub API client dynamic import (memoised)\nlet __octokit = null;\nconst __getOctokit = () => import(\"@octokit/core\").then(({ Octokit }) =>\n  new Octokit({\n    auth: config.token,\n  })\n);\nconst getOctokit = async () => {\n  if (__octokit) return __octokit;\n  return __octokit = await __getOctokit();\n}\n\nexport const config = {\n  sha: {\n    get latest() { return localStorage['__GITHUB_GIST_LATEST_SHA']; },\n    set latest(x) { localStorage['__GITHUB_GIST_LATEST_SHA'] = x; },\n    get current() { return localStorage['__GITHUB_GIST_CURRENT_SHA']; },\n    set current(x) { localStorage['__GITHUB_GIST_CURRENT_SHA'] = x; },\n  },\n  // This is fairly insecure, especially given there are possible XSS vulnerabilities\n  // See https://stackoverflow.com/a/58467408/4642943 for alternatives\n  // once security becomes a bigger concern.\n  get token() { return localStorage['__GITHUB_TOKEN']; },\n  set token(x) { localStorage['__GITHUB_TOKEN'] = x; },\n  get username() { return localStorage['__GITHUB_USERNAME']; },\n  set username(x) { localStorage['__GITHUB_USERNAME'] = x; },\n  get gist_id() { return localStorage['__GITHUB_GIST_ID']; },\n  set gist_id(x) { localStorage['__GITHUB_GIST_ID'] = x; },\n};\n\nexport function loggedIn () {\n  return Boolean(config.token);\n}\n\nexport async function commit (editSet) {\n  if (editSet.set.length === 0) return [];\n  // If this fails it is due to authentication failure\n  // TODO: handle this case in a user-friendly way\n  const gh = await getOctokit();\n  const update = set =>\n    gh.request('PATCH /gists/{gist_id}', {\n      gist_id: config.gist_id,\n      description: \"Mirror synchronisation (https://oliverbalfour.github.io/Mirror/)\",\n      files: compileEditSet(set)\n    })\n  // If one of the actions failed, the whole request fails\n  // To minimise collateral damage we repeat each action individually\n  await update(editSet).catch(async e => {\n    console.error(e);\n    return await Promise.all(\n      editSet.set.map(edit => update({ set: [edit] }))\n    ).catch(console.error)\n  });\n  await updateLatestSHA().catch(e => {\n    console.error(`Commit of changes failed. State may no longer be reflected by online sync target. Error: ${e.toString()}`);\n  });\n}\n\nfunction compileEditSet (editSet) {\n  // Produces the file modifications object\n  // https://developer.github.com/v3/gists/#update-a-gist\n  const files = {};\n  for (let edit of editSet.set) {\n    const filename = getEditFilename(edit);\n    switch (edit.type) {\n      case 'delete':\n        files[filename] = null;\n        break;\n      case 'add':\n      case 'edit':\n      {\n        const content = serializeObject(edit.object);\n        files[filename] = { filename, content };\n        break;\n      }\n      case 'param':\n        files[filename] = { filename, content: JSON.stringify(edit.value) }\n        break;\n      default:\n    }\n  }\n  return files;\n}\n\nfunction getEditFilename (edit) {\n  return getFilename(edit.namespace, edit.object ? edit.object.id : null);\n}\nfunction getFilename (namespace, id = null) {\n  if (namespace === 'cards')\n    return `${id}.md`;\n  else if (id)\n    return `${namespace}.${id}.md`;\n  else\n    return `${namespace}.md`;\n}\n\nfunction getObjectPath (filename) {\n  const parts = filename.split('.');\n  if (parts.length === 2) {\n    if (standaloneNamespaces.indexOf(parts[0]) === -1) {\n      return ['cards', parts[0]];\n    } else {\n      return [parts[0]];\n    }\n  } else {\n    return [parts[0], parts[1]];\n  }\n}\n\nfunction serializeObject (object) {\n  // Cards are serialized to markdown with YAML frontmatter\n  // where the values are JSON serialized\n  // Columns and tabs contain just the frontmatter component\n  const specialKeys = ['description'];\n  let frontmatter = [];\n  for (let key in object) {\n    if (specialKeys.indexOf(key) === -1) {\n      const value = key === 'time' ? new Date(object[key]).getTime() : JSON.stringify(object[key]);\n      frontmatter.push(`${key}: ${value}`);\n    }\n  }\n  let serialized = `---\\n${frontmatter.join('\\n')}\\n---\\n`;\n  if (object.description) serialized += object.description;\n  return serialized;\n}\n\nfunction deserializeObject (markdown) {\n  const object = {};\n  const [start , frontmatter, description] = markdown.split('---');\n  if (!frontmatter) return JSON.parse(start);\n  frontmatter.split('\\n').filter(str => str.trim().length).forEach(str => {\n    const [key, ...leftPaddedValues] = str.split(':');\n    const leftPaddedValue = leftPaddedValues.join(':');\n    // Need to be careful with these objects; if someone edits a GitHub Gist\n    // file to include \"hasOwnProperty: 0\" it could cause a crash\n    object[key] = JSON.parse(leftPaddedValue.trimStart());\n  });\n  if (description.trim().length)\n    object.description = description.trim();\n  return object;\n}\n\n// Call when first logged in\n// This will update the IndexedDB cache/GitHub Gist\n// and return a state object asynchronously\nexport async function postLogIn () {\n  // If there is a file called `__logged_in` then the gist has been used\n  // on another computer and so the remote state is used to patch local state.\n  // If the file does not exist, we patch the remote state with the local.\n  // Patch meaning write one state over another without deleting existing state,\n  // that is not overwritten.\n\n    // SHA must be set prior to calling `get`\n  config.sha.latest = await getLatestSHA();\n  const hasLoggedInBefore = (await get('__logged_in', false)).status !== 404;\n\n  console.log('Logging in. Has ' + (hasLoggedInBefore ? '' : 'not ') + 'logged in before.');\n\n  let state = {};\n  if (hasLoggedInBefore) {\n    state = await synchroniseState();\n    console.log('Finished loading and caching remote state.');\n  } else {\n    await set('__logged_in', 'true');\n    await saveState(await idb.loadState());\n    console.log('Finished writing local state to remote.');\n  }\n  return state;\n}\n\nexport const forcePush = async () => {\n  if (window.prompt('Force push to GitHub? This will reversibly OVERWRITE REMOTE STATE.'\n    + 'Only use if corrupted. Enter \"PUSH\" to continue') !== 'PUSH') return;\n  await saveState(await idb.loadState());\n  console.log('Finished force pushing local state to remote.');\n}\n\nexport const forcePull = async () => {\n  if (window.prompt('Force pull from GitHub? This will IRREVERSIBLY OVERWRITE LOCAL STATE.'\n    + 'Only use if corrupted. Enter \"PULL\" to continue') !== 'PULL') return;\n  const allSHAs = await getNewCommitSHAs(null);\n  const files = await getAllModifiedFiles(allSHAs);\n  const diff = getDiffObject(files);\n  await idb.saveState(diff);\n  config.sha.current = config.sha.latest = allSHAs[0];\n  console.log(`Reset local state to ${config.sha.current.substring(0, 10)}`);\n  window.location.reload();\n}\n\n// Call on app initialisation and periodically thereafter\nexport const synchroniseState = async () => {\n  try {\n    config.sha.latest = await getLatestSHA();\n    if (config.sha.latest === config.sha.current) {\n      console.log('No state updates required');\n      return {};\n    }\n    const files = await getAllModifiedFiles();\n    const diff = getDiffObject(files);\n    await idb.saveState(diff);\n    console.log(`Updated local state: ${(config.sha.current || 'none').substring(0, 10)}..${config.sha.latest.substring(0, 10)}`);\n    config.sha.current = config.sha.latest;\n    return diff;\n  } catch (e) {\n    console.log(`Error occurred while synchronising state. Check network connection. Error: ${e.toString()}`);\n  }\n}\n\n// Save initial state, or save state after logging in\nexport const saveState = async state => {\n  const set = new EditSet();\n  for (let namespace of standaloneNamespaces) {\n    set.param(namespace, state[namespace], null);\n  }\n  for (let namespace of shallowNamespaces) {\n    for (let id in state[namespace]) {\n      set.add(namespace, state[namespace][id]);\n    }\n  }\n  // commit(set) rather than set.commit() as we don't want to\n  // touch the undo stack\n  commit(set);\n};\n\nasync function get (filename, deserialize = true) {\n  // There is an undocumented endpoint for accessing raw files here:\n  // https://gist.githubusercontent.com/:user/:id/raw/:sha/:filename\n  const endpoint = \"https://gist.githubusercontent.com/\"\n  + `${config.username}/${config.gist_id}/raw/${config.sha.latest}/${filename}`;\n  const res = await fetch(endpoint);\n  if (deserialize)\n    return deserializeObject(res.text());\n  else\n    return res;\n}\n\n// Warning: this will change the remote latest commit SHA\n// but not update it locally. Call updateLatestSHA if needed.\nasync function set (filename, content) {\n  if (content.length === 0) content = 'null';\n  const files = { [filename]: { filename, content } };\n  const gh = await getOctokit();\n  await gh.request('PATCH /gists/{gist_id}', {\n    gist_id: config.gist_id,\n    files\n  })\n}\n\nexport async function load (namespace, id = null) {\n  try {\n    return await get(getFilename(namespace, id));\n  } catch (e) {\n    return null;\n  }\n}\n\nexport async function getLatestSHA () {\n  const gh = await getOctokit();\n  const commits = await gh.request('GET /gists/{gist_id}/commits', {\n    gist_id: config.gist_id,\n    per_page: 1,\n  });\n  return commits.data[0].version;\n}\n\nasync function updateLatestSHA () {\n  // Sets the latest and current SHAs to the latest SHA on the remote\n  // Use with caution; only for internal use\n  config.sha.current = config.sha.latest = await getLatestSHA();\n}\n\n// Returns a list of commits in order of newest to oldest since the last known commit\nexport async function getNewCommitSHAs (since = config.sha.current) {\n  const gh = await getOctokit();\n  const SHAs = [];\n  let page_no = 1;\n  while (page_no < 100) {\n    const commits = (await gh.request('GET /gists/{gist_id}/commits', {\n      gist_id: config.gist_id,\n      per_page: 100,\n      page: page_no,\n    })).data;\n    if (commits.length === 0) break;\n    for (let commit of commits) {\n      const { version } = commit;\n      if (since === version) break;\n      SHAs.push(version);\n    }\n    page_no++;\n  }\n  return SHAs;\n}\n\nasync function getGistRevision (sha) {\n  // https://api.github.com/gists/:id/:sha has a files field\n  const gh = await getOctokit();\n  const response = await gh.request('GET /gists/{gist_id}/{sha}', {\n    gist_id: config.gist_id,\n    sha\n  });\n  // Returns a dict where filenames are the keys, and the values are objects\n  // with a \"content\" field\n  return response.data.files;\n}\n\n// Returns a dict with key = filename, value = contents\n// Assumes no truncation, does not handle errors\nasync function getAllModifiedFiles (SHAs = null) {\n  if (!SHAs) SHAs = await getNewCommitSHAs();\n  const files = {};\n  const promises = [];\n  for (let i = 0; i < SHAs.length; i++) {\n    promises.push(getGistRevision(SHAs[i]));\n  }\n  const revisions = await Promise.all(promises);\n  let i = SHAs.length;\n  while (i --> 0) {\n    const revision = revisions[i];\n    for (let file in revision) {\n      if (file === '__logged_in') continue;\n      files[file] = revision[file].content;\n    }\n  }\n  return files;\n}\n\nfunction getDiffObject (files) {\n  const diff = {};\n  for (let filename in files) {\n    // Ignore extraneous files\n    // As card filenames aren't qualified, we can't just assume a file is extraneous\n    // and ignore it. Thus, we ignore files iff there is a parsing error\n    let object;\n    try {\n      object = deserializeObject(files[filename]);\n    } catch (e) {\n      continue;\n    }\n    // The object may be stored in a deep hierarchy\n    const path = getObjectPath(filename);\n    let ptr = diff;\n    for (let layer of path.slice(0, -1)) {\n      ptr[layer] = ptr[layer] || {};\n      ptr = ptr[layer];\n    }\n    ptr[path[path.length - 1]] = object;\n  }\n  return diff;\n}\n\nexport function logOut () {\n  const confirmed = window.confirm('Are you sure you want to log out? All your state will be saved locally and on GitHub, but it will no longer synchronise.');\n  if (!confirmed) return;\n  for (let i = localStorage.length - 1; i >= 0; i--) {\n    const key = localStorage.key(i);\n    if (key.startsWith('__GITHUB')) {\n      delete localStorage[key];\n    }\n  }\n  window.location.reload();\n}\n","\nimport { shallowEqual } from '../common';\n\nexport default class EditSet {\n  constructor () {\n    this.set = [];\n    this.inv = [];\n  }\n  add (namespace, object) {\n    this.set.push({ type: 'add', namespace, object });\n    this.inv.push({ type: 'delete', namespace, id: object.id });\n    return this;\n  }\n  edit (namespace, object, old) {\n    this.set.push({ type: 'edit', namespace, object });\n    this.inv.push({ type: 'edit', namespace, object: old });\n    return this;\n  }\n  delete (namespace, id, old) {\n    this.set.push({ type: 'delete', namespace, id });\n    this.inv.push({ type: 'add', namespace, object: old });\n    return this;\n  }\n  param (namespace, value, old) {\n    // Params are always present, this updates a param\n    this.set.push({ type: 'param', namespace, value });\n    this.inv.push({ type: 'param', namespace, value: old });\n    return this;\n  }\n  concat (other) {\n    // Cancel out inverse operations (remove both operations)\n    for (let i = other.inv.length - 1; i >= 0; i--) {\n      for (let j = this.set.length - 1; j >= 0; j--) {\n        if (shallowEqual(other.inv[i], this.set[j])) {\n          other.inv.splice(i, 1);\n          other.set.splice(i, 1);\n          this.inv.splice(j, 1);\n          this.set.splice(j, 1);\n        }\n      }\n    }\n    // Combine the sets\n    this.set.push(...other.set);\n    this.inv.push(...other.inv);\n    // Prune duplicates (later edits should override earlier ones)\n    const ids = [];\n    for (let i = this.set.length - 1; i >= 0; i--) {\n      const id = getEditID(this.set[i]);\n      if (ids.indexOf(id) !== -1) {\n        this.set.splice(i, 1);\n      } else {\n        ids.push(id);\n      }\n    }\n    return this;\n  }\n  concatSimple (other) {\n    this.set.push(...other.set);\n    this.inv.push(...other.inv);\n    return this;\n  }\n  editAll (namespace, objectDict, oldDict) {\n    for (let id in objectDict) {\n      this.edit(namespace, objectDict[id], oldDict[id]);\n    }\n    return this;\n  }\n  editAllByID (namespace, objectDict, arrayOfIDs, oldDict) {\n    for (let id of arrayOfIDs) {\n      this.edit(namespace, objectDict[id], oldDict[id]);\n    }\n    return this;\n  }\n  deleteAllByID (namespace, arrayOfIDs, oldDict) {\n    for (let id of arrayOfIDs) {\n      this.delete(namespace, id, oldDict[id]);\n    }\n    return this;\n  }\n  invert () {\n    const other = new EditSet();\n    other.set = this.inv;\n    other.inv = this.set;\n    return other;\n  }\n}\n\nconst getEditID = edit => {\n  switch (edit.type) {\n    case 'add':\n    case 'edit':\n      return edit.object.id;\n    case 'delete':\n      return edit.id;\n    case 'param':\n      return edit.namespace;\n    default:\n  }\n}\n","\nimport * as ghb from './github';\nimport * as idb from './indexeddb';\nimport { set } from 'idb-keyval';\n\nimport EditSet from './edit-set';\nexport const UNDO_LIMIT = 20;\nEditSet.prototype.commit = function () {\n  commit(this);\n  hist.editSetHistory.past.push(this);\n  if (hist.editSetHistory.past.length > UNDO_LIMIT)\n    hist.editSetHistory.past.shift();\n  // Clear the future for any state mutating actions\n  hist.editSetHistory.future = [];\n}\nconst hist = {\n  editSetHistory: {\n    past: [],    // [oldest edit,  ..., 1 edit ago]\n    future: [],  // [1 edit ahead, ..., n edits ahead]\n  },\n  undo: {\n    allowed: () => hist.editSetHistory.past.length > 0,\n    commit: () => {\n      const set = hist.editSetHistory.past.pop();\n      hist.editSetHistory.future.unshift(set);\n      if (hist.editSetHistory.future.length > UNDO_LIMIT)\n        hist.editSetHistory.future.pop();\n      commit(set.invert());\n    },\n  },\n  redo: {\n    allowed: () => hist.editSetHistory.future.length > 0,\n    commit: () => {\n      const set = hist.editSetHistory.future.shift();\n      hist.editSetHistory.past.push(set);\n      if (hist.editSetHistory.past.length > UNDO_LIMIT)\n        hist.editSetHistory.past.shift();\n      commit(set);\n    }\n  }\n}\nexport { EditSet, hist };\n\nexport const namespaceNames = {\n  cards: 'cards',\n  columns: 'columns',\n  tabs: 'tabs',\n  tabOrder: 'tabOrder',\n  starredZettels: 'starredZettels',\n}\n\n// Namespaces that are not objects but not necessarily primitives\nexport const standaloneNamespaces = [\n  'tabOrder',\n  'starredZettels',\n];\n\n// Namespaces that are dictionaries of depth one\nexport const shallowNamespaces = [\n  'cards',\n  'columns',\n  'tabs',\n];\n\nexport async function loadState (loadAll = true) {\n  // Return the IndexedDB state with GitHub mutations too\n  // TODO: load state async and have loading status indicator rather than blocking\n  // this needs to give the user an indication of when it's done\n  let state = await idb.loadState(loadAll);\n  if (ghb.loggedIn()) {\n    state = { ...state, ...await ghb.synchroniseState() };\n  }\n  return state;\n}\n\nexport async function saveState (state) {\n  return await Promise.all([idb.saveState(state), ghb.saveState(state)]);\n}\n\n// Load tabOrder: await load('tabOrder')\n// Load card: await load('cards', cardID)\nexport async function load (namespace, id = null) {\n  const local = await idb.load(namespace, id);\n  if (local) return local;\n  return ghb.load(namespace, id);\n}\n\n// To avoid data races, we rate limit edits to 5s intervals where extra\n// edits are concat'd onto the buffer\n// Data races could occur when quickly undoing an edit if the packets arrive in\n// the wrong order.\nlet editSetBuffer = new EditSet();\nlet timer = null;\nlet waitingOn = [];\nconst commit = editSet => new Promise((resolve, reject) => {\n  const promises = [\n    idb.commit(editSet)\n  ];\n  if (ghb.loggedIn()) {\n    if (!timer) {\n      promises.push(ghb.commit(editSet));\n      timer = setTimeout(() => {\n        ghb.commit(editSetBuffer);\n        timer = null;\n        editSetBuffer = new EditSet();\n        waitingOn.forEach(f => f());\n        waitingOn = [];\n      }, 5000);\n      Promise.all(promises).then(resolve);\n    } else {\n      editSetBuffer.concat(editSet);\n      waitingOn.push(resolve);\n    }\n  } else {\n    Promise.all(promises).then(resolve);\n  }\n});\n\nexport const generateInitialState = () =>\n  fetch(\"./initial-state.json\")\n    .then(res => res.json())\n    .then(obj => {\n      const promises = [];\n      for (let key in obj) {\n        promises.push(set(key, obj[key]));\n      }\n      return Promise.all(promises);\n    })\n    .then(x => idb.loadIDBState(true))\n    .catch(e => alert(\"Could not load initial state. Perhaps you forgot a trailing slash in the URL? Error: \" + e));\n","\nimport { pushNotification, abbreviatedDescription } from '../common';\n\n// Handles notifications for cards with a datetime attribute\nconst handles = {}; // maps card ID to a list of setTimeout handles\nconst minute = 60000; // in milliseconds\nconst intervals = [  // intervals before the event that reminders happen at\n    [10 * minute, \"10 minutes\"],\n    [60 * minute, \"1 hour\"],\n    [60 * minute * 6, \"6 hours\"],\n];\n\n// BUG: this should be called when the initial state is loaded and synchronisestate is called too!!!\nexport function handleEventReminderForCard (id, card) {\n  if (id in handles) {\n    for (const x of handles[id]) {\n      clearTimeout(x);\n    }\n    delete handles[id];\n  }\n  if (card && card.time) {\n    const date = new Date(card.time);\n    // Ignore times starting at midnight?\n    // if (date.getHours() === 0 && date.getMinutes() === 0 && date.getSeconds() === 0 && date.getMilliseconds() === 0) {\n    //   return;\n    // }\n    const remainingMS = date.getTime() - new Date().getTime();\n    if (remainingMS < 0) return;\n    handles[id] = [];\n    for (const [ms, label] of intervals) {\n      if (remainingMS > ms) {\n        handles[id].push(setTimeout(() => {\n          pushNotification(`Due in ${label}: ${abbreviatedDescription(card)}`);\n        }, remainingMS - ms));\n      }\n    }\n  }\n}\n","\n/**\n * Kanban boards core Redux logic\n *\n * State is normalised as { tabs, columns, cards }\n *  where each tab has several columns which contain cards\n *  each has a unique ID as a key in the respective object\n */\n\nimport { createAction, createAsyncThunk } from '@reduxjs/toolkit';\nimport undoable, { ActionTypes } from 'redux-undo';\nimport produce from 'immer';\nimport { generateID, objectMap, deleteInList, createReducer, shallowEqual,\n  structuredClone, deepMerge, encURI } from './common';\nimport { EditSet, load, namespaceNames as c, hist, UNDO_LIMIT } from './backends';\nimport { handleEventReminderForCard } from './kanban/utils';\n\n// Action creators\n\nexport const unsafeSetState = createAction('mirror/SET_STATE');  // Used for async initial state\n// TODO: how should overwriteState be treated by undo/redo?\n// Used to overwrite local data with updates from remote\nexport const overwriteState = createAction('mirror/OVERWRITE_STATE');\n\nexport const transferCard = createAction('kanban/TRANSFER_CARD');\nexport const reorderCard = createAction('kanban/REORDER_CARD');\nexport const addCard = createAction('kanban/ADD_CARD'); // takes { content, colID }\nexport const editCardContent = createAction('kanban/EDIT_CARD_CONTENT');//takes {content, cardID}\nexport const editCard = createAction('kanban/EDIT_CARD'); // takes a card object; allows editing all of a card's params\nexport const deleteCard = createAction('kanban/DELETE_CARD');//takes cardID\nexport const archiveCard = createAction('kanban/ARCHIVE_CARD');//takes cardID\n\nexport const moveCard = ([srcColID, dstColID, srcIndex, dstIndex]) =>\n  srcColID === dstColID\n    ? reorderCard({ colID: srcColID, srcIndex, dstIndex })\n    : transferCard({ srcColID, dstColID, srcIndex, dstIndex });\n\nexport const addColumn = createAction('kanban/ADD_COLUMN'); // takes { name, tabID }\nexport const deleteColumn = createAction('kanban/DELETE_COLUMN'); // takes string column ID\nexport const renameColumn = createAction('kanban/RENAME_COLUMN'); // takes { colID, name }\nexport const moveColumn = createAction('kanban/MOVE_COLUMN'); // takes [srcIdx, dstIdx, tabIdx]\nexport const archiveCardsInColumn = createAction('kanban/ARCHIVE_ALL_COLUMN'); // takes colID\nexport const sortColByTime = createAction('kanban/SORT_COLUMN_BY_CARD_TIME_ATTRIBUTE');\n\nexport const addTab = createAction('kanban/ADD_TAB'); // takes name\nexport const deleteTab = createAction('kanban/DELETE_TAB'); // takes tabIdx\nexport const renameTab = createAction('kanban/RENAME_TAB'); // takes { tabID, name }\nexport const moveTab = createAction('kanban/MOVE_TAB'); // takes [srcIdx, dstIdx]\n\nexport const addZettel = createAction('zettelkasten/ADD_ZETTEL'); // takes { zettel: {...} }\nexport const editZettel = createAction('zettelkasten/EDIT_ZETTEL'); // takes { zettel }\nexport const deleteZettel = createAction('zettelkasten/DELETE_ZETTEL'); // takes zettelID\nexport const toggleZettelStarred = createAction('zettelkasten/TOGGLE_STARRED'); // takes zettelID\n\n// createAsyncThunk a normal action creator creator you dispatch as usual with .pending,\n// .fulfilled and .rejected action types for handling by a reducer\nexport const loadZettel = createAsyncThunk(\n  'zettelkasten/LOAD_ZETTEL', async (cardID, thunkAPI) => {\n    const card = await load('cards', cardID);\n    if (!card) {\n      // Reject if the card couldn't be loaded\n      return thunkAPI.rejectWithValue(cardID);\n    } else {\n      return card;\n    }\n  }\n);\n\n// Selectors\n\nexport const selectors = {\n  // Map[TabID, Column], Column :: { id, items: List[Card] }, not List[CardID]\n  getColumnsInTabs: state =>\n    objectMap(state.tabs, tab =>\n      tab.columns.map(colID => state.columns[colID]).map(col => ({\n        ...col, items: col.items.map(card => state.cards[card])\n      }))),\n  columns: state => state.columns,\n  tabs: state => state.tabs,\n  tabOrder: state => state.tabOrder,\n  cards: state => state.cards,\n  archivedCards: state => Object.values(state.cards).filter(card => Object.keys(card).indexOf(\"archived\") !== -1),\n  activeCards:   state => Object.values(state.cards).filter(card => Object.keys(card).indexOf(\"archived\") === -1),\n  starredZettels: state => state.starredZettels ? state.starredZettels : [],\n  // gets { [tabID]: list_of_cardIDs }\n  cardsByTab: state => objectMap(state.tabs, tab =>\n    tab.columns.flatMap(colID => state.columns[colID].items)),\n  loadingZettel: state => state.loadingZettel,\n};\n\n// Reducers\n\nexport const\n  KANBAN_CARD_TYPE = 0,\n  ZETTEL_NOTE_TYPE = 1;\n\nconst loadingState = {\n  loading: true\n};\n\n// Helpers\nconst validTabName = (name, state) => {\n  if (!name.length) {\n    window.snackbar(\"Tab name cannot be empty\", { variant: 'warning' });\n    return false;\n  }\n  const tabNames = Object.values(state.tabs).map(tab => tab.name.toLowerCase());\n  if (tabNames.indexOf(name.toLowerCase()) !== -1 || tabNames.map(encURI).indexOf(encURI(name)) !== -1) {\n    window.snackbar(\"Tab name already exists\", { variant: 'warning' });\n    return false;\n  }\n  return true;\n}\n\n// Called whenever a card/zettel's contents or attributes have changed (except timestamps)\n// After deletion card is null\nfunction eventCardChanged (id, card) {\n  handleEventReminderForCard(id, card);\n}\n\n// Use our version of createReducer that does not enable Immer by default\n// Note that these reducers are not pure, they commit changes to IndexedDB\n// and the GitHub Gist API. As the app cannot function without these features,\n// these side effects have to happen somewhere, and none of the features\n// impure reducers break are relevant or would work anyway, the rule of pure\n// reducers is intentionally broken.\n// Note: ps is previous state, s is draft state, ns is next state, a is action\nconst reducer = createReducer(loadingState, {\n  // Only used for updating the initial state from the loading state\n  // Makes no changes to the remote (pure functional reducer)\n  [unsafeSetState]: (ps, a) => a.payload,\n  // Update the state, for loading remote state on top of existing state\n  // This does not copy everything into memory, it only overwrites existing state keys\n  [overwriteState]: (ps, a) => {\n    if (JSON.stringify(a.payload) === \"{}\") return ps;\n    const ns = structuredClone(ps);\n    deepMerge(ns, a.payload);\n    return ns;\n  },\n  // Invert the edit sets for IndexedDB and GitHub\n  // Every other action clears the redo stack if present\n  [ActionTypes.UNDO]: (ps, a) => {\n    hist.undo.commit();\n    return ps;\n  },\n  [ActionTypes.REDO]: (ps, a) => {\n    hist.redo.commit();\n    return ps;\n  },\n  [transferCard]: (ps, a) => {\n    const epochms = new Date().getTime();\n    const { srcColID, dstColID, srcIndex, dstIndex } = a.payload;\n    if (srcColID === dstColID && srcIndex === dstIndex)\n      return ps;\n    const cardID = ps.columns[srcColID].items[srcIndex];\n    const ns = produce(ps, s => {\n      s.columns[srcColID].items.splice(srcIndex, 1);\n      s.cards[cardID].moved = epochms;\n      s.columns[srcColID].edited = epochms;\n      s.columns[dstColID].edited = epochms;\n      s.columns[dstColID].items.splice(dstIndex, 0, cardID);\n    });\n    new EditSet()\n      .edit(c.cards, ns.cards[cardID], ps.cards[cardID])\n      .edit(c.columns, ns.columns[srcColID], ps.columns[srcColID])\n      .edit(c.columns, ns.columns[dstColID], ps.columns[dstColID])\n      .commit();\n    return ns;\n  },\n  [reorderCard]: (ps, a) => {\n    const { colID, srcIndex, dstIndex } = a.payload;\n    if (srcIndex === dstIndex)\n      return ps;\n    const epochms = new Date().getTime();\n    const cardID = ps.columns[colID].items[srcIndex];\n    const ns = produce(ps, s => {\n      s.columns[colID].edited = epochms;\n      s.columns[colID].items.splice(srcIndex, 1);\n      s.cards[cardID].moved = epochms;\n      s.columns[colID].items.splice(dstIndex, 0, cardID);\n    });\n    new EditSet()\n      .edit(c.columns, ns.columns[colID], ps.columns[colID])\n      .edit(c.cards, ns.cards[cardID], ps.cards[cardID])\n      .commit();\n    return ns;\n  },\n  [addCard]: (ps, a) => {\n    const { content, colID } = a.payload;\n    const id = generateID();\n    const epochms = new Date().getTime();\n    const card = { id, content, type: KANBAN_CARD_TYPE,\n      created: epochms,  edited: epochms, moved: epochms };\n    const ns = produce(ps, s => {\n      s.cards[id] = card;\n      // Add to top of column\n      s.columns[colID].items.unshift(id);\n      s.columns[colID].edited = epochms;\n    });\n    new EditSet()\n      .add(c.cards, card)\n      .edit(c.columns, ns.columns[colID], ps.columns[colID])\n      .commit();\n    eventCardChanged(id, card);\n    return ns;\n  },\n  [deleteColumn]: (ps, a) => {\n    const colID = a.payload;\n    const ms = new Date().getTime();\n    const tabIdx = ps.tabOrder.map(tabID => ps.tabs[tabID].columns.indexOf(colID) !== -1).indexOf(true);\n    const ns = produce(ps, s => {\n      if (tabIdx >= 0) s.tabs[s.tabOrder[tabIdx]].edited = ms;\n      s.columns[colID].items.forEach(cardID => delete s.cards[cardID]);\n      Object.values(s.tabs).forEach(tab => deleteInList(tab.columns, colID));\n      delete s.columns[colID];\n    });\n    new EditSet()\n      .editAll(c.tabs, ns.tabs, ps.tabs)\n      .deleteAllByID(c.cards, ps.columns[colID].items, ps.cards)\n      .commit();\n    return ns;\n  },\n  [renameColumn]: (ps, a) => {\n    const { colID, name } = a.payload;\n    if (ps.columns[colID].name === name)\n      return ps;\n    const ns = produce(ps, s => {\n      s.columns[colID].name = name;\n      s.columns[colID].edited = new Date().getTime();\n    });\n    new EditSet()\n      .edit(c.columns, ns.columns[colID], ps.columns[colID])\n      .commit();\n    return ns;\n  },\n  [editCardContent]: (ps, a) => {\n    const { cardID, content } = a.payload;\n    if (ps.cards[cardID].content === content)\n      return ps;\n    const ns = produce(ps, s => {\n      s.cards[cardID].content = content;\n      s.cards[cardID].edited = new Date().getTime();\n    });\n    new EditSet()\n      .edit(c.cards, ns.cards[cardID], ps.cards[cardID])\n      .commit();\n    eventCardChanged(cardID, ns.cards[cardID]);\n    return ns;\n  },\n  [deleteCard]: (ps, a) => {\n    const cardID = a.payload;\n    const ms = new Date().getTime();\n    const colIDs = [];\n    const ns = produce(ps, s => {\n      Object.values(s.columns).forEach(col => {\n        if (deleteInList(col.items, cardID)) {\n          col.edited = ms;\n          colIDs.push(col.id);\n        }\n      });\n      delete s.cards[a.payload];\n    });\n    new EditSet()\n      .delete(c.cards, cardID, ps.cards[cardID])\n      .editAllByID(c.columns, ns.columns, colIDs, ps.columns)\n      .commit();\n    eventCardChanged(cardID, null);\n    return ns;\n  },\n  [addColumn]: (ps, a) => {\n    const { tabID, name } = a.payload;\n    const id = generateID();\n    const epochms = new Date().getTime();\n    const column = { id, items: [], name, created: epochms, edited: epochms };\n    const ns = produce(ps, s => {\n      s.columns[id] = column;\n      s.tabs[tabID].columns.push(id);\n      s.tabs[tabID].edited = epochms;\n    });\n    new EditSet()\n      .add(c.columns, column)\n      .edit(c.tabs, ns.tabs[tabID], ps.tabs[tabID])\n      .commit();\n    return ns;\n  },\n  [editCard]: (ps, a) => {\n    const { card, colID: dstColID } = a.payload;\n    // Assume card is a flat struct\n    if (shallowEqual(ps.cards[card.id], card))\n      return ps;\n    const epochms = new Date().getTime();\n    const srcColID = Object.keys(ps.columns).filter(colID => ps.columns[colID].items.indexOf(card.id) !== -1)[0];\n    const ns = produce(ps, s => {\n      s.cards[card.id] = JSON.parse(JSON.stringify(a.payload.card));\n      s.cards[card.id].edited = epochms;\n      if (srcColID !== dstColID) {\n        deleteInList(s.columns[srcColID].items, card.id);\n        s.columns[dstColID].items.unshift(card.id);\n        s.columns[srcColID].edited = s.columns[dstColID].edited = epochms;\n      }\n    });\n    new EditSet()\n      .edit(c.cards, ns.cards[card.id], ps.cards[card.id])\n      .concatSimple((() => {\n        // Update columns if changed\n        const set = new EditSet();\n        if (srcColID !== dstColID) {\n          set.edit(c.columns, ns.columns[srcColID], ps.columns[srcColID]);\n          set.edit(c.columns, ns.columns[dstColID], ps.columns[dstColID]);\n        }\n        return set;\n      })())\n      .commit();\n    eventCardChanged(card.id, card);\n    return ns;\n  },\n  [deleteTab]: (ps, a) => {\n    const tabIdx = a.payload;\n    const cardIDs = [];\n    const tabID = ps.tabOrder[tabIdx];\n    const ns = produce(ps, s => {\n      const tab = s.tabs[tabID];\n      while (tab.columns.length) {\n        const colID = tab.columns[0];\n        cardIDs.push(...s.columns[colID].items);\n        s.columns[colID].items.forEach(cardID => delete s.cards[cardID]);\n        delete s.columns[colID];\n        tab.columns.shift();\n      }\n      delete s.tabs[tab.id];\n      s.tabOrder.splice(tabIdx, 1);\n    });\n    const tab = ps.tabs[tabID];\n    new EditSet()\n      .deleteAllByID(c.cards, cardIDs, ps.cards)\n      .deleteAllByID(c.columns, tab.columns, ps.columns)\n      .delete(c.tabs, tabID, tab)\n      .param(c.tabOrder, ns.tabOrder, ps.tabOrder)\n      .commit();\n    return ns;\n  },\n  [addTab]: (ps, a) => {\n    const name = a.payload;\n    if (!validTabName(name, ps)) return ps;\n    const id = generateID();\n    const tab = { name, id, columns: [], created: new Date().getTime() };\n    const ns = produce(ps, s => {\n      s.tabs[id] = tab;\n      s.tabOrder.push(id);\n    });\n    new EditSet()\n      .add(c.tabs, tab)\n      .param(c.tabOrder, ns.tabOrder, ps.tabOrder)\n      .commit();\n    return ns;\n  },\n  [renameTab]: (ps, a) => {\n    const { tabID, name } = a.payload;\n    if (ps.tabs[tabID].name === name)\n      return ps;\n    if (!validTabName(name, ps)) return ps;\n    const ns = produce(ps, s => {\n      s.tabs[tabID].name = name;\n      s.tabs[tabID].edited = new Date().getTime();\n    });\n    new EditSet()\n      .edit(c.tabs, ns.tabs[tabID], ps.tabs[tabID])\n      .commit();\n    return ns;\n  },\n  [moveColumn]: (ps, a) => {\n    const [srcIdx, dstIdx, tabIdx] = a.payload;\n    if (srcIdx === dstIdx) return ps;\n    const tabID = ps.tabOrder[tabIdx];\n    const colID = ps.tabs[tabID].columns[srcIdx];\n    const ns = produce(ps, s => {\n      s.tabs[tabID].columns.splice(srcIdx, 1);\n      s.tabs[tabID].columns.splice(dstIdx, 0, colID);\n      s.tabs[tabID].edited = new Date().getTime();\n    });\n    new EditSet()\n      .edit(c.tabs, ns.tabs[tabID], ps.tabs[tabID])\n      .commit();\n    return ns;\n  },\n  [moveTab]: (ps, a) => {\n    const [srcIdx, dstIdx] = a.payload;\n    if (srcIdx === dstIdx) return ps;\n    const tabID = ps.tabOrder[srcIdx];\n    if (dstIdx < 0 || dstIdx >= ps.tabs.length) return ps;\n    const ns = produce(ps, s => {\n      s.tabOrder.splice(srcIdx, 1);\n      s.tabOrder.splice(dstIdx, 0, tabID);\n    });\n    new EditSet()\n      .param(c.tabOrder, ns.tabOrder, ps.tabOrder)\n      .commit();\n    return ns;\n  },\n  [archiveCardsInColumn]: (ps, a) => {\n    // Archived cards are stored in IndexedDB and the Gist\n    const colID = a.payload;\n    if (ps.columns[colID].items.length === 0) return ps;\n    const epochms = new Date().getTime();\n    // Detach cards from column, edit cards\n    const ns = produce(ps, s => {\n      s.columns[colID].items.forEach(cardID => {\n        let card = s.cards[cardID];\n        card.moved = card.edited = card.archived = epochms;\n        card.archivedFromColID = colID;\n      });\n      s.columns[colID].items = [];\n      s.columns[colID].edited = epochms;\n    });\n    new EditSet()\n      .editAllByID(c.cards, ns.cards, ps.columns[colID].items, ps.cards)\n      .edit(c.columns, ns.columns[colID], ps.columns[colID])\n      .commit();\n    return ns;\n  },\n  [archiveCard]: (ps, a) => {\n    // Archived cards are stored in IndexedDB and the Gist\n    const cardID = a.payload;\n    const epochms = new Date().getTime();\n    const colID = Object.keys(ps.columns).filter(colID => ps.columns[colID].items.includes(cardID))[0];\n    // Detach cards from column, edit cards\n    const ns = produce(ps, s => {\n        let card = s.cards[cardID];\n        card.moved = card.edited = card.archived = epochms;\n        card.archivedFromColID = colID;\n        s.columns[colID].items.splice(s.columns[colID].items.indexOf(cardID), 1);\n    });\n    new EditSet()\n      .edit(c.cards, ns.cards[cardID], ps.cards[cardID])\n      .edit(c.columns, ns.columns[colID], ps.columns[colID])\n      .commit();\n    return ns;\n  },\n  [addZettel]: (ps, a) => {\n    const { zettel } = a.payload;\n    const id = zettel.id || generateID();\n    const epochms = new Date().getTime();\n    const fullZettel = {\n      id, type: ZETTEL_NOTE_TYPE,\n      created: epochms,  edited: epochms, moved: epochms,\n      ...zettel\n    };\n    const ns = produce(ps, s => {\n      s.cards[id] = fullZettel;\n    });\n    new EditSet()\n      .add(c.cards, fullZettel)\n      .commit();\n    eventCardChanged(id, zettel);\n    return ns;\n  },\n  [editZettel]: (ps, a) => {\n    const { zettel } = a.payload;\n    if (shallowEqual(ps.cards[zettel.id], zettel)) return ps;\n    const epochms = new Date().getTime();\n    // editZettel will not add new zettels\n    if (Object.keys(ps.cards).indexOf(zettel.id) === -1) return ps;\n    const ns = produce(ps, s => {\n      s.cards[zettel.id] = zettel;\n      s.cards[zettel.id].edited = epochms;\n    });\n    new EditSet()\n      .edit(c.cards, zettel, ps.cards[zettel.id])\n      .commit();\n    eventCardChanged(zettel.id, zettel);\n    return ns;\n  },\n  [deleteZettel]: (ps, a) => {\n    const cardID = a.payload;\n    const ns = produce(ps, s => {\n      deleteInList(s.starredZettels, a.payload);\n      delete s.cards[cardID];\n    });\n    new EditSet\n      .param(c.starredZettels, ns.starredZettels, ps.starredZettels)\n      .delete(c.cards, cardID, ps.cards[cardID])\n      .commit();\n    eventCardChanged(cardID, null);\n    return ns;\n  },\n  [toggleZettelStarred]: (ps, a) => {\n    const cardID = a.payload;\n    const ns = produce(ps, s => {\n      if (!s.starredZettels) s.starredZettels = [];\n      if (s.starredZettels.indexOf(cardID) === -1)\n        s.starredZettels.push(cardID);\n      else\n        deleteInList(s.starredZettels, cardID);\n    });\n    new EditSet()\n      .param(c.starredZettels, ns.starredZettels, ps.starredZettels)\n      .commit();\n    eventCardChanged(cardID, ns.cards[cardID]);\n    return ns;\n  },\n  [sortColByTime]: (ps, a) => {\n    const colID = a.payload;\n    const ns = produce(ps, s => {\n      // This sorts by epoch millisecond time; anything without a time is at the end in the same order\n      // As a bug meant card.time is sometimes a string, we must wrap in new Date(x).getTime() instead of just x\n      s.columns[colID].items.sort(\n        (a, b) => {\n          let aMS = new Date(s.cards[b].time || null).getTime();\n          let bMS = new Date(s.cards[a].time || null).getTime();\n          if (bMS === 0 && aMS === 0) return 0;\n          if (bMS === 0) return 1;\n          if (aMS === 0) return -1;\n          return bMS - aMS;\n        });\n    });\n    new EditSet()\n      .edit(c.columns, ns.columns[colID], ps.columns[colID])\n      .commit();\n    return ns;\n  },\n  [loadZettel.pending]: (ps, a) =>\n    produce(ps, s => s.loadingZettel = true),\n  [loadZettel.fulfilled]: (ps, a) =>\n    produce(ps, s => {\n      s.cards[a.payload.id] = a.payload;\n      delete s.loadingZettel;\n    }),\n  [loadZettel.rejected]: (ps, a) =>\n    produce(ps, s => s.loadingZettel = a.payload),\n});\n// Actions which do not mutate external state and thus cannot be undone\nconst undoBlacklist = [\n  unsafeSetState.type,\n  loadZettel.pending.type,\n  loadZettel.fulfilled.type,\n  loadZettel.rejected.type,\n];\n\n// Undoable reducer\n// Note that if an identical state is produced (via ===) the action is ignored\n// The app depends on this behaviour\nconst undoableReducer = undoable(reducer, {\n  // Keep in sync with editSetBuffer max size\n  limit: UNDO_LIMIT,\n  // So we can listen to UNDO events and call commit(set.invert())\n  neverSkipReducer: true,\n  filter: (action, currentState, previousHistory) => {\n    return undoBlacklist.indexOf(action.type) === -1;\n  }\n});\n\nexport default (s, a) => {\n  if (a.type === ActionTypes.UNDO && !hist.undo.allowed()) {\n    window.snackbar('Cannot undo any further', { variant: 'warning' });\n    return s;\n  }\n\n  if (a.type === ActionTypes.REDO && !hist.redo.allowed()) {\n    window.snackbar('Cannot redo any further', { variant: 'warning' });\n    return s;\n  }\n\n  if (undoBlacklist.indexOf(a.type) !== -1) {\n    // Simulate undoable reducer\n    // We can't use the filter because the filter doesn't let us\n    // selectively stop undo from applying\n    return {...s, present: reducer(s.present, a)};\n  }\n\n  return undoableReducer(s, a);\n};\n","\n// Popover menu (web)\nimport * as React from 'react';\nimport { Menu, MenuItem } from '@material-ui/core';\n\n\nexport default ({ map, children }) => {\n  const [anchorEl, setAnchorEl] = React.useState(null);\n  const handleClose = () => setAnchorEl(null);\n\n  return (\n    <React.Fragment>\n      <Menu\n        anchorEl={anchorEl}\n        keepMounted\n        open={Boolean(anchorEl)}\n        onClose={handleClose}>\n        {Object.entries(map).map(([name, func]) => (\n          <MenuItem key={name}\n            onClick={() => { handleClose(); func() }}>\n            {name}\n          </MenuItem>\n        ))}\n      </Menu>\n      {React.cloneElement(children, {\n        onClick: e => setAnchorEl(e.currentTarget)\n      })}\n    </React.Fragment>\n  );\n}\n","\n/**\n * TabView component\n *\n * <TabView\n *   tabs={[\"one\", \"two\", \"three\"]}\n *   render={i => (<SomeComponent index={i} />)}\n * />\n *\n */\n\nimport * as React from 'react';\nimport { AppBar, Tabs, Tab, IconButton } from '@material-ui/core';\nimport MoreIcon from '@material-ui/icons/MoreVert';\nimport PopoverMenu from './popovermenu';\n\nexport default ({\n  tabs, render, index, setIndex,\n  addTab, renameTab, deleteTab, moveTab,\n  columnsLocked, toggleColumnsLocked\n}) => {\n  const handleChange = (event, newValue) => newValue >= 0 && newValue < tabs.length && setIndex(newValue);\n  const Grow = () => <div style={{ flexGrow: 1 }} />;\n\n  return (\n    <div className='tab-bar-root'>\n      <AppBar className='tab-bar-header' position=\"static\" style={{\n          backgroundColor: \"white\",\n          zIndex: 2, position: 'relative'\n        }}>\n        <Tabs value={index} onChange={handleChange}\n          indicatorColor=\"primary\" textColor=\"primary\">\n          {tabs.map(tab => (\n            <Tab label={tab} key={tab} />\n          ))}\n          <Grow />\n          <PopoverMenu map={{\n            \"Add tab\": () => addTab(),\n            \"Rename tab\": () => renameTab(index),\n            \"Delete tab\": () => deleteTab(index),\n            \"Move tab left\":  () => { moveTab([index, index-1]); handleChange(null, index-1) },\n            \"Move tab right\": () => { moveTab([index, index+1]); handleChange(null, index+1) },\n            [columnsLocked ? \"Unlock columns\" : \"Lock columns\"]: () => toggleColumnsLocked(),\n          }}>\n            <IconButton>\n              <MoreIcon />\n            </IconButton>\n          </PopoverMenu>\n        </Tabs>\n      </AppBar>\n      {tabs.map((tab, i) => (\n        index === i && (\n          <div className='tab-bar-content' key={i}>\n            {render(i)}\n          </div>\n        )\n      ))}\n    </div>\n  );\n}\n","\nimport { configureStore } from '@reduxjs/toolkit';\nimport { ActionCreators as UndoActionCreators } from 'redux-undo';\nimport * as core from './reducer';\nimport { objectMap } from './common';\nimport { loadState } from './backends';\nimport thunk from 'redux-thunk';\n\nconst store = configureStore({\n  // DEBUG:\n  // reducer: (s, a) => { console.log(a); core.default(s, a) },\n  reducer: core.default,\n  middleware: [thunk],\n});\n\n// Load state. Ignore lazy loading for now.\nloadState(true).then(state => {\n  store.dispatch(core.unsafeSetState(state));\n});\n\n// Undo/redo keyboard shortcuts if supported\ntry {\n  document.addEventListener('keyup', e => {\n    const ignored = ['input', 'textarea'];\n    if (ignored.indexOf(document.activeElement.tagName.toLowerCase()) !== -1) return;\n    if (e.ctrlKey && e.which === 90 && !e.shiftKey)\n      store.dispatch(UndoActionCreators.undo());\n    else if ((e.ctrlKey && e.shiftKey && e.which === 90) || (e.ctrlKey && e.which === 89))\n      store.dispatch(UndoActionCreators.redo());\n  });\n} catch (e) {}\n\nexport default store;\n\n// produce global selectors\nexport const globalSelectors = {\n  boards: state => state.present\n}\nexport const selectors = {\n  boards: objectMap(core.selectors, localSelector => state => localSelector(globalSelectors.boards(state)))\n};\n","\nimport * as React from 'react';\nimport { parseWikilinks } from '../common';\nimport { MarkdownBase } from './markdown-base';\n\n// Dynamic import via webpack code splitting and React.lazy\nconst KaTeXMarkdown = React.lazy(() => import('./markdown-katex'));\n\n// Takes either a cards prop or a source prop\n// Parses wikilinks if the cards prop is present\n// Parses $$math$$ and syntax highlights ```js\\ncode\\n``` if present, lazy loading the relevant libraries\nexport default props => {\n  // Parse wikilinks if available\n  let source = props.cards ? parseWikilinks(props.source, props.cards) : props.source;\n  // Parse LaTeX formulae if present\n  // As KaTeX is 250kB minified we dynamically import it only if we need to\n  if (source.indexOf(\"$$\") === -1) {\n    return (\n      <MarkdownBase {...props} source={source} />\n    );\n  } else {\n    return (\n      <React.Suspense fallback={<span>Loading...</span>}>\n        <KaTeXMarkdown {...props} source={source} />\n      </React.Suspense>\n    );\n  }\n};\n","\n// This textarea automatically resizes to the height of its contents\n// It still supports min/max-height and a scrollbar appears past the limit\n// Modified from https://www.impressivewebs.com/textarea-auto-resize/\n// We don't use Material-UI's <TextField multiline /> as it doesn't support CSS max-height\n\nimport * as React from 'react';\nimport { useEventListener } from '../common';\n\n// You must supply an input ref, and can supply className etc.\nexport default React.forwardRef(({ value, setValue, className, offset = 5, ...props }, ref) => {\n  const hiddenDivRef = React.useRef(null);\n  const inputRef = ref;\n\n  // Update the height every time the value changes\n  // It is assumed the textarea's width is constant\n  const resize = () => {\n    const hiddenDiv = hiddenDivRef.current;\n    const input = inputRef.current;\n    if (!hiddenDiv || !input) return;\n    window.swap = () => {\n      hiddenDiv.style.display = window.swapped ? 'none' : 'block';\n      input.style.display = window.swapped ? 'block' : 'none';\n      window.swapped = !window.swapped;\n    }\n\n    // Set the div's contents to the same value and calculate the new height\n    // The <br> fixes the way the textarea grows if line-height isn't included\n    hiddenDiv.innerText = inputRef.current.value;\n    hiddenDiv.innerHTML += '<br style=\"line-height: 3px;\">';\n\n    // Briefly make the hidden div block but invisible to read the height\n    let height = 0;\n    hiddenDiv.style.visibility = 'hidden';\n    hiddenDiv.style.display = 'block';\n    input.style.display = 'none';\n    height = hiddenDiv.offsetHeight;\n    hiddenDiv.style.visibility = 'visible';\n    hiddenDiv.style.display = 'none';\n    input.style.display = 'block';\n    input.style.height = height + offset + 'px';\n  };\n  window.resize=resize;\n  React.useEffect(resize, [value, inputRef]);\n  useEventListener(window, 'resize', resize);\n\n  return (\n    <React.Fragment>\n      <div ref={hiddenDivRef} className={'autoresize-div ' + (className ? className : '')}\n        style={{ padding: 2 }}></div>\n      <textarea {...props} onChange={e => setValue(e.target.value)} value={value}\n        className={'custom-textarea autoresize ' + (className ? className : '')} ref={inputRef} />\n    </React.Fragment>\n  );\n});\n","\nimport * as React from 'react';\nimport { Textcomplete } from '@textcomplete/core';\nimport { TextareaEditor } from '@textcomplete/textarea';\nimport AutoresizeTextarea from './autoresize-textarea';\nimport { selectors } from '../store';\nimport { useSelector } from 'react-redux';\nimport { searchCards, linkName, generateID } from '../common';\n\n// If addNote is a function an 'Add note' option will appear\n// It inserts a link to a note with a generated ID, and invokes\n// addNote on the generated ID.\nexport default ({ value, setValue, addNote, className, ...props }) => {\n\n  const inputRef = React.useRef(null);\n  const cards = useSelector(selectors.boards.cards);\n\n  const maxCount = 10;\n\n  React.useEffect(() => {\n    const editor = new TextareaEditor(inputRef.current);\n    const strategy = {\n      // String -> Bool -- whether to proceed to matching phase\n      context: beforeCursor => beforeCursor.indexOf('[[') >= 0,\n      match: /\\[\\[([^\\]]+)$/, // captures the X in \"abc [[X\"\n      // term is captured substring; can use async (t, cb) => cb(await something(term));\n      // This returns a list of card IDs followed by '0' for the addNote option\n      // The Add note option is always displayed\n      search: (term, callback /*, match*/) => callback([\n        ...searchCards(term, cards).slice(0, maxCount - 1),\n        ...(addNote ? [0] : [])\n      ]),\n      cache: true,\n      // these take the input to the search callback\n      template: cardID => cardID === 0 ? \"<em>Add note</em>\" : linkName(cards[cardID]),\n      replace: cardID => {\n        if (cardID === 0 && addNote) {\n          const id = generateID();\n          // run addNote after replacing text\n          window.setTimeout(() => addNote(id), 0);\n          return `[[${id}]]`;\n        } else {\n          return `[[${cardID}]]`;\n        }\n      },\n    }\n    const options = {\n      dropdown: {\n        rotate: true, // this means vertical wrapping under up/down arrows\n        maxCount,\n      }\n    };\n    const textcomplete = new Textcomplete(editor, [strategy], options);\n    // cleanup\n    return () => {\n      textcomplete.destroy();\n      delete window['__addNote']\n    }\n    // eslint-disable-next-line\n  }, []); // passing dependencies breaks it\n\n  // This textarea automatically resizes to the height of its contents\n  // It still supports min/max-height and a scrollbar appears past the limit\n  return (\n    <AutoresizeTextarea {...props} ref={inputRef} value={value} setValue={setValue}\n      className={className} />\n  );\n};\n","\nimport * as React from 'react';\nimport Markdown from '../../components/markdown';\nimport { ClickAwayListener, InputLabel } from '@material-ui/core';\nimport NotesIcon from '@material-ui/icons/Notes';\nimport { IndicatorBuilder, AttributeHeader } from '.';\nimport { selectors } from '../../store';\nimport AutocompleteEditor from '../../components/autocomplete-editor';\nimport { useSelector } from 'react-redux';\nimport { abbreviatedDescription } from '../../common';\n\nexport const Edit = ({ card, setCard }) => {\n  const [editingDescription, setEditingDescription] = React.useState(false);\n  const setDescription = description => setCard({...card,\n      description: description.length ? description : undefined});\n  const cards = useSelector(selectors.boards.cards);\n\n  if (!editingDescription && typeof card.description !== 'string')\n    return (\n      <AttributeHeader onClick={() => setEditingDescription(true)}>\n        Add description\n      </AttributeHeader>\n    );\n\n  const handleKeyDown = e => {\n    if (editingDescription) {\n      // Escape\n      if (e.which === 27) {\n        setEditingDescription(false);\n        // Don't escape the edit modal dialog\n        e.stopPropagation();\n      }\n    } else {\n      // Space and Enter while focused enable editing mode\n      if (document.activeElement === e.target) {\n        if ([32, 13].indexOf(e.which) !== -1) {\n          // Add a timeout to prevent the space/enter from being typed\n          setTimeout(() => setEditingDescription(true), 0);\n        }\n      }\n    }\n  };\n\n  return !editingDescription ? (\n    <div style={{marginTop: 8, overflow: 'auto'}}\n      >\n      <InputLabel className=\"custom-label\"\n        onClick={() => setEditingDescription(true)}>\n        Description</InputLabel>\n      <Markdown source={card.description} cards={cards}\n        tabIndex='0' onKeyDown={handleKeyDown}\n        className=\"markdown-selectable\"\n        onDoubleClick={() => setEditingDescription(true)} />\n    </div>\n  ) : (\n    <React.Fragment>\n      <InputLabel className=\"custom-label\">Description</InputLabel>\n      <ClickAwayListener onClickAway={() => setEditingDescription(false)} mouseEvent=\"onMouseDown\">\n        <div onKeyDown={handleKeyDown}>\n          <AutocompleteEditor value={card.description} setValue={setDescription}\n            className='descriptionEditor' offset={20} autoFocus />\n        </div>\n      </ClickAwayListener>\n    </React.Fragment>\n  );\n};\n\nexport const Indicator = ({ card }) => {\n  if (card.description) {\n    const title = abbreviatedDescription(card);\n    return <IndicatorBuilder label={null} title={title} icon={<NotesIcon />} />;\n  } else return null;\n};\n","\nimport * as React from 'react';\nimport { IconButton, InputLabel } from '@material-ui/core';\nimport AccessTimeIcon from '@material-ui/icons/AccessTime';\nimport { MuiPickersUtilsProvider, DateTimePicker } from '@material-ui/pickers';\nimport DateFnsUtils from '@date-io/date-fns';\nimport { format, startOfToday } from 'date-fns';\nimport { enAU } from 'date-fns/locale';\nimport { prettyPrintDate, timeUrgencyClassName } from '../../common';\nimport { IndicatorBuilder, AttributeHeader } from '.';\nimport CloseIcon from '@material-ui/icons/Close';\n\nenAU.weekStart = 1;\n\nexport const Edit = ({ card, setCard }) => {\n  const setDateTime = time => setCard({...card, time});\n\n  return card.time ? (\n    <div style={{marginTop: 10}}>\n      <InputLabel className=\"custom-label\">Date &amp; time</InputLabel>\n      <MuiPickersUtilsProvider utils={DateFnsUtils} locale={enAU}>\n        <DateTimePicker\n          value={new Date(card.time)}\n          onChange={newDate => setDateTime(newDate.getTime())}\n          showTodayButton\n          format=\"MMMM do hh:mm aaa\" />\n      </MuiPickersUtilsProvider>\n      <IconButton size=\"small\" style={{ marginLeft: 10 }}\n        onClick={() => setDateTime(null)}>\n        <CloseIcon />\n      </IconButton>\n    </div>\n  ) : (\n    <AttributeHeader onClick={() => setDateTime(startOfToday().getTime())}>\n      Add date &amp; time\n    </AttributeHeader>\n  );\n};\n\nexport const Indicator = ({ card }) => {\n  if (card.time) {\n    return <IndicatorBuilder\n      icon={<AccessTimeIcon />}\n      label={prettyPrintDate(card.time)}\n      title={format(new Date(card.time), \"dd/MM/yyyy hh:mmaaa\")}\n      className={timeUrgencyClassName(new Date(card.time).getTime())}\n    />\n  } else return null;\n};\n","\nimport * as React from 'react';\nimport { TextField, InputLabel, IconButton } from '@material-ui/core';\nimport HourglassEmptyIcon from '@material-ui/icons/HourglassEmpty';\nimport { IndicatorBuilder, AttributeHeader } from '.';\nimport CloseIcon from '@material-ui/icons/Close';\n\nexport const Edit = ({ card, setCard }) => {\n  const [durationStr, setDurationStr] = React.useState(card.duration ? prettySeconds(card.duration) : \"\");\n  const autoFocusRef = React.useRef(null);\n  const setDuration = str => {\n    const duration = unprettySeconds(str);\n    setDurationStr(str);\n    if (typeof duration === \"number\") {\n      setCard({ ...card, duration });\n    }\n  }\n\n  const resetDuration = () => setCard({...card, duration: null});\n  const addDuration = () => {\n    setDuration('1h');\n    setTimeout(() => {\n      try {\n        autoFocusRef.current.focus();\n      } catch (e) {}\n    }, 0);\n  };\n\n  if (!card.duration) {\n    return (\n      <AttributeHeader onClick={addDuration}>\n        Add duration\n      </AttributeHeader>\n    );\n  }\n\n  // returns true iff the string is non-empty but in incorrect format (correct format is stuff like \"1h30m\")\n  const invalid = str => str !== \"\" && str !== null && unprettySeconds(str) === null;\n\n  return (\n    <div style={{marginTop: 10}}>\n      <InputLabel className=\"custom-label\">Duration</InputLabel>\n      <TextField\n        style={{width: 201, marginTop: 4}}\n        ref={autoFocusRef}\n        margin=\"dense\" fullWidth\n        value={durationStr}\n        error={invalid(durationStr)}\n        helperText={invalid(durationStr) ? \"Invalid format. Examples: 2d 1h 30m, 5m\" : null}\n        onChange={e => setDuration(e.target.value)} />\n      <IconButton size=\"small\" style={{ marginLeft: 10 }}\n        onClick={resetDuration}>\n        <CloseIcon />\n      </IconButton>\n    </div>\n  )\n};\n\n// Pretty print seconds in short form like 3600->1h, 6300->1h45m (no days or seconds)\nconst prettySeconds = s => {\n  if (typeof (s) === 'string') return s;\n  const days = Math.floor(s / 86400);\n  const hours = Math.floor((s % 86400) / 3600);\n  const minutes = Math.floor((s % 3600) / 60);\n  if (days === 0 && hours === 0 && minutes === 0) return '0m';\n  const str = (days ? days + 'd ' : '') + (hours ? hours + 'h ' : '') + (minutes ? minutes + 'm' : '');\n  return str.trim();\n};\n\n// Inverse of prettySeconds; used so the input field can be edited in pretty form\nlet unprettySeconds = s => {\n  if (typeof s === \"number\") return s;\n  // this parses it to [x, '0d','1h', '30m'] if possible, or [x, undefined, '1h',undefined]\n  // or [x, undefined, undefined,'30m']\n  // if only one is present, where x is irrelevant\n  let groups = (/^(\\d+d|\\d*\\.\\d+d)?\\s*(\\d+h|\\d*\\.\\d+h)?\\s*(\\d+m|\\d*\\.\\d+m)?$/m).exec(s);\n\n  // check there are 4 matches where at least one of the latter 3 are defined\n  if (!groups || groups.length !== 4 || !groups.slice(1).filter(x=>x).length)\n    return null;\n  else groups = groups.slice(1);\n\n  const pf = k => parseFloat(k.substring(0, k.length-1)); // \"1.5h\" -> 1.5\n  return 86400*pf(groups[0] || '0d') + 3600*pf(groups[1] || '0h') + 60*pf(groups[2] || '0m');\n};\n\nexport const Indicator = ({ card }) => {\n  if (card.duration) {\n    const label = prettySeconds(card.duration);\n    const title = `Duration: ${label}`;\n    const icon = <HourglassEmptyIcon />;\n    return <IndicatorBuilder label={label} title={title} icon={icon} />;\n  } else return null;\n};\n","\nimport * as React from 'react';\nimport { TextField, InputLabel, IconButton } from '@material-ui/core';\nimport { IndicatorBuilder, AttributeHeader } from '.';\nimport LocationOnIcon from '@material-ui/icons/LocationOn';\nimport CloseIcon from '@material-ui/icons/Close';\n\nexport const Edit = ({ card, setCard }) => {\n  const autoFocusRef = React.useRef(null);\n  const [location, _setLocation] = React.useState(card.location || \"\");\n  const setLocation = str => {\n    _setLocation(str);\n    if (typeof location === \"string\") {\n      setCard({ ...card, location: str });\n    }\n  }\n\n  const resetLocation = () => setCard({...card, location: null});\n  const addLocation = () => {\n    setLocation('home');\n    setTimeout(() => {\n      try {\n        autoFocusRef.current.focus();\n      } catch (e) {}\n    }, 0);\n  };\n\n  if (!card.location) {\n    return (\n      <AttributeHeader onClick={addLocation}>\n        Add location\n      </AttributeHeader>\n    );\n  }\n\n  return (\n    <div style={{marginTop: 10}}>\n      <InputLabel className=\"custom-label\">Location</InputLabel>\n      <TextField\n        style={{width: 201, marginTop: 4}}\n        ref={autoFocusRef}\n        margin=\"dense\" fullWidth\n        value={location}\n        onChange={e => setLocation(e.target.value)} />\n      <IconButton size=\"small\" style={{ marginLeft: 10 }}\n        onClick={resetLocation}>\n        <CloseIcon />\n      </IconButton>\n    </div>\n  )\n};\n\nexport const Indicator = ({ card }) => {\n  if (card.location) {\n      return <IndicatorBuilder label={card.location} title={`Location: ${card.location}`} icon={<LocationOnIcon />} />;\n  } else return null;\n};\n","\nimport * as React from 'react';\nimport { Chip, Button } from '@material-ui/core';\n\nimport * as Description from './description';\nimport * as DateTime from './datetime';\nimport * as Duration from './duration';\nimport * as Location from './location';\n\nexport const AttributeIndicators = ({ card }) => (\n  <React.Fragment>\n    <Description.Indicator card={card} />\n    <DateTime.Indicator card={card} />\n    <Duration.Indicator card={card} />\n    <Location.Indicator card={card} />\n  </React.Fragment>\n);\n\nexport const AttributeEditingFields = ({ card, setCard }) => (\n  <React.Fragment>\n    <Description.Edit card={card} setCard={setCard} />\n    <DateTime.Edit card={card} setCard={setCard} />\n    <Duration.Edit card={card} setCard={setCard} />\n    <Location.Edit card={card} setCard={setCard} />\n  </React.Fragment>\n);\n\nexport const IndicatorBuilder = ({ icon, label, title, className }) =>\n  <Chip size='small' icon={icon}\n    label={label}\n    title={title}\n    classes={label && label.length ? null : { label: 'attribute-label' }}\n    className={'attribute-indicator ' + (className || \"\")}\n    variant='outlined' />;\n\nexport const AttributeHeader = props =>\n  <div className='attribute-header'>\n    <Button variant='outlined' color='primary' size='small' {...props} />\n  </div>;\n","\nimport * as React from 'react';\nimport { Button, Dialog, DialogActions, DialogContent, DialogContentText, DialogTitle,\n         TextField, InputLabel, Select, MenuItem,\n         ListSubheader } from '@material-ui/core';\nimport * as core from '../reducer';\nimport { globalSelectors as sel, selectors } from '../store';\nimport { useDispatch, useSelector } from 'react-redux';\nimport { AttributeEditingFields } from '../kanban/attributes';\nimport { ReloadProtect, useEventListener, useFlag } from '../common';\nimport { MarkdownBase } from './markdown-base';\n\nconst useCtrlEnter = callback =>\n  useEventListener(document, 'keydown', e =>\n    e.ctrlKey && e.which === 13 && callback());\n\nexport const ConfirmDialog = ({ open, respond, title, subtitle, labels = [\"Cancel\", \"OK\"] }) => {\n  useFlag('dialog');\n  useCtrlEnter(() => open && respond(true));\n  return (\n    <Dialog open={open} onClose={() => respond(null)}>\n      <DialogTitle>{title}</DialogTitle>\n      <DialogContent>\n        <DialogContentText>\n          {subtitle}\n        </DialogContentText>\n      </DialogContent>\n      <DialogActions>\n        <Button onClick={() => respond(false)} color=\"primary\">\n          {labels[0]}\n        </Button>\n        <Button onClick={() => respond(true)} color=\"primary\" variant=\"contained\" autoFocus>\n          {labels[1]}\n        </Button>\n      </DialogActions>\n    </Dialog>\n  );\n}\n\nexport const PromptDialog = ({\n  open, respond, title, subtitle, labels = [\"Cancel\", \"OK\"],\n  label, inputType = \"text\", placeholder = \"\", buttons = null\n}) => {\n  useFlag('dialog');\n  const [value, setValue] = React.useState(placeholder);\n  useCtrlEnter(() => open && respond(value));\n  return (\n    <Dialog open={open} onClose={() => respond(null)}>\n      <DialogTitle>{title}</DialogTitle>\n      <DialogContent>\n        {typeof subtitle === \"string\" && (\n          <DialogContentText>\n            {subtitle}\n          </DialogContentText>\n        )}\n        <TextField autoFocus margin=\"dense\" fullWidth\n          label={label} type={inputType} value={value} onChange={e => setValue(e.target.value)} />\n      </DialogContent>\n      <DialogActions>\n        {buttons}\n        <Button onClick={() => respond(false)} color=\"primary\">\n          {labels[0]}\n        </Button>\n        <Button onClick={() => respond(value)} color=\"primary\" variant=\"contained\">\n          {labels[1]}\n        </Button>\n      </DialogActions>\n    </Dialog>\n  );\n}\n\nexport const CardEditDialog = ({ respond, card }) => {\n  useFlag('dialog');\n  const dispatch = useDispatch();\n\n  const currentColID = useSelector(state => Object.values(sel.boards(state).columns)\n      .filter(col => col.items.indexOf(card.id) !== -1)[0].id);\n\n  const [colID, setColID] = React.useState(currentColID);\n  const [newCard, setCard] = React.useState(card);\n  const setContent = content => setCard({...newCard, content});\n\n  const columns = useSelector(selectors.boards.columns);\n  const tabs = useSelector(selectors.boards.tabs);\n\n  const done = () => {\n    respond();\n    setContent(card.content);\n  }\n  // save and then delete so you can undo the delete without losing your unsaved draft of a card\n  const deleteCard = () => {\n    dispatch(core.editCard({ card: newCard, colID }));\n    dispatch(core.deleteCard(card.id));\n    done();\n  }\n  const archive = () => {\n    dispatch(core.editCard({ card: newCard, colID }));\n    dispatch(core.deleteCard(card.id));\n    done();\n  }\n  const editCard = () => {\n    dispatch(core.editCard({ card: newCard, colID }));\n    done();\n  }\n\n  useCtrlEnter(editCard);\n\n  return (\n    <Dialog open onClose={() => done(null)} fullWidth maxWidth='md'\n      disableBackdropClick={JSON.stringify(newCard) !== JSON.stringify(card)}>\n      <ReloadProtect shouldProtect={JSON.stringify(newCard) !== JSON.stringify(card)} />\n      <DialogTitle>Edit card</DialogTitle>\n      <DialogContent>\n        <InputLabel id=\"kanban/card-column\" className=\"custom-label\">Column</InputLabel>\n        <Select labelId=\"kanban/card-column\" value={colID} onChange={e => setColID(e.target.value)}>\n          {Object.values(tabs).flatMap(tab => ([\n            // the subheader can be clicked so we add the following CSS hack (per mui#18200)\n            // .MuiListSubheader-root { pointer-events: none; }\n            <ListSubheader key={tab.id}>{tab.name}</ListSubheader>,\n            ...tab.columns.map(colID =>\n              <MenuItem value={colID} key={colID}>{columns[colID].name}</MenuItem>\n            )\n          ]))}\n        </Select>\n        <InputLabel id=\"kanban/card-title\" className=\"custom-label\">Title</InputLabel>\n        <TextField margin=\"dense\" autoFocus fullWidth\n          multiline rowsMax={6} value={newCard.content} onChange={e => setContent(e.target.value)} />\n        <AttributeEditingFields card={newCard} setCard={setCard} />\n      </DialogContent>\n      <DialogActions style={{ flexDirection: \"row-reverse\" }}>\n        <Button onClick={editCard} color=\"primary\" variant=\"contained\">OK</Button>\n        <div style={{ flexGrow: 1 }} />\n        <Button onClick={done} color=\"primary\">Cancel</Button>\n        <Button onClick={archive} color=\"primary\">Archive</Button>\n        <Button onClick={deleteCard}>Delete</Button>\n      </DialogActions>\n    </Dialog>\n  );\n}\n\nexport const AboutDialog = ({ open, respond }) => {\n  useFlag('dialog');\n  useCtrlEnter(() => open && respond());\n  return (\n    <Dialog open={open} onClose={respond} fullWidth>\n      <DialogTitle>About Mirror</DialogTitle>\n      <DialogContent>\n        <DialogContentText>\n          A free and open source personal task management and note taking app.<br/>\n\n          Made by Oliver Balfour. &copy; 2020-2021.<br/>\n\n          App icon is <a href=\"https://thenounproject.com/term/mirror/340140/\">Mirror</a>&nbsp;\n          by Lastspark from <a href=\"http://thenounproject.com/\">The Noun Project</a>.\n        </DialogContentText>\n      </DialogContent>\n      <DialogActions>\n        <Button onClick={respond} color=\"primary\" variant=\"contained\" autoFocus>\n          OK\n        </Button>\n      </DialogActions>\n    </Dialog>\n  );\n}\n\nexport const GitHubLoginDialog = ({ open, respond }) => {\n  useFlag('dialog');\n  const [token, setToken] = React.useState(\"\");\n  const [gistID, setGistID] = React.useState(\"\");\n  const [username, setUsername] = React.useState(\"\");\n  const done = () => respond(token, gistID, username);\n  useCtrlEnter(() => open && done());\n  return (\n    <Dialog open={open} onClose={respond} fullWidth>\n      <DialogTitle>Log in via GitHub</DialogTitle>\n      <DialogContent>\n        <DialogContentText>\n          <MarkdownBase source={`To log in via GitHub for synchronisation,\n            [create a new token](https://github.com/settings/tokens/new) with\n            the \\`gist\\` permission and save it somewhere safe. Then, go to\n            [gist.github.com](https://gist.github.com) and create a new Gist\n            with any title and add one file, \\`main.md\\`, with any contents.\n            Then click \"Create secret gist\" and copy the gist ID from the URL.\n            Enter your token, gist ID and username below.`} />\n        </DialogContentText>\n        <InputLabel className=\"custom-label\">GitHub Username</InputLabel>\n        <TextField margin=\"dense\" fullWidth\n          value={username} onChange={e => setUsername(e.target.value)}\n          autoComplete=\"username\" />\n        <InputLabel className=\"custom-label\">Gist ID</InputLabel>\n        <TextField margin=\"dense\" fullWidth\n          value={gistID} onChange={e => setGistID(e.target.value)}\n          autoComplete=\"off\" />\n        <InputLabel className=\"custom-label\">GitHub access token</InputLabel>\n        <TextField margin=\"dense\" autoFocus fullWidth\n          value={token} onChange={e => setToken(e.target.value)}\n          type=\"password\" autoComplete=\"current-password\" />\n      </DialogContent>\n      <DialogActions>\n        <Button onClick={() => respond(false)} color=\"primary\">\n          Cancel\n        </Button>\n        <Button onClick={() => done()} color=\"primary\" variant=\"contained\">\n          Log in\n        </Button>\n      </DialogActions>\n    </Dialog>\n  );\n}\n","\n/**\n * MenuBar component\n *\n * <MenuBar active={0} setActive={...} />\n *  (active is index of current screen)\n *\n */\n\nimport React from 'react';\nimport { useDispatch } from 'react-redux';\nimport * as core from '../reducer';\nimport { loggedIn, logOut, forcePush, forcePull } from '../backends/github';\nimport { AppBar, Toolbar, IconButton, Tabs, Tab } from '@material-ui/core';\nimport MoreIcon from '@material-ui/icons/MoreVert';\nimport DeveloperBoardIcon from '@material-ui/icons/DeveloperBoard';\nimport NotesIcon from '@material-ui/icons/Notes';\nimport PopoverMenu from './popovermenu';\nimport { UndoRedo } from '../components';\nimport { AboutDialog, GitHubLoginDialog } from './dialogs';\nimport { config, postLogIn } from '../backends/github';\n\nconst noop = () => '';\nconst emailAddress = 'leolalor1+mirrorsupport'+noop()+'@googlemail'+noop()+'.com';\n\nexport default ({ active, setActive }) => {\n  const [aboutOpen, setAboutOpen] = React.useState(false);\n  const [GHOpen, setGHOpen] = React.useState(false);\n  const dispatch = useDispatch();\n\n  const githubItem = () => loggedIn()\n    ? { \"Log out of GitHub\": logOut,\n        \"Force push to GitHub\": forcePush,\n        \"Force pull from GitHub\": forcePull }\n    : { \"Log in via GitHub\": () => setGHOpen(true) };\n\n  const toggleTheme = () =>\n    localStorage.theme === \"dark\"\n      ? window.setTheme(\"light\")\n      : window.setTheme(\"dark\");\n\n  const menuItems = {\n    \"Submit feedback\": () => window.open(`mailto:${emailAddress}`, '_blank'),\n    \"About\": () => setAboutOpen(true),\n    ...githubItem(),\n    \"Clear saved state\": () => window.prompt(\"Delete all saved state? Pressing undo will fix this. Type YES to confirm\", \"NO\") === \"YES\" && window.deleteAllState(),\n    \"Import state\": () => window.importIDBState(),\n    \"Export state\": () => window.exportIDBState(),\n    \"Enable notifications\": () => Notification.requestPermission().then(permission => {\n      if (permission === \"granted\")\n        new Notification(\"You'll now see notifications about event deadlines here\");\n    }),\n    \"Toggle light/dark theme\": () => toggleTheme(),\n  };\n\n  return (\n    <React.Fragment>\n      <AppBar color=\"primary\" className='menubar'>\n        <Toolbar style={{ minHeight: 0 }}>\n          <Tabs\n            value={active} onChange={(e, val) => setActive(val)}\n            TabIndicatorProps={{ style: { backgroundColor: 'white' } }}\n          >\n            <Tab label={<div><DeveloperBoardIcon style={{verticalAlign: 'middle'}} /> Boards</div>}  />\n            <Tab label={<div><NotesIcon style={{verticalAlign: 'middle'}} /> Notes</div>}  />\n          </Tabs>\n          <div style={{ flexGrow: 1 }} />\n          <UndoRedo />\n          <PopoverMenu map={menuItems}>\n            <IconButton edge=\"end\" color=\"inherit\">\n              <MoreIcon />\n            </IconButton>\n          </PopoverMenu>\n        </Toolbar>\n      </AppBar>\n      {aboutOpen && <AboutDialog open respond={() => setAboutOpen(false)} />}\n      {GHOpen &&\n        <GitHubLoginDialog open respond={(token, gist_id, username) => {\n          setGHOpen(false);\n          if (token !== false) {\n            config.token = token;\n            config.gist_id = gist_id;\n            config.username = username;\n            postLogIn().then(state => dispatch(core.overwriteState(state)));\n          }\n        }} />\n      }\n    </React.Fragment>\n  );\n}\n","\nimport * as React from 'react';\nimport { useDispatch } from 'react-redux';\nimport { IconButton } from '@material-ui/core';\nimport UndoIcon from '@material-ui/icons/Undo';\nimport RedoIcon from '@material-ui/icons/Redo';\nimport { ActionCreators } from 'redux-undo'\n\nexport default () => {\n  const dispatch = useDispatch();\n  return (\n    <React.Fragment>\n      <IconButton\n        onClick={() => dispatch(ActionCreators.undo())}\n        color=\"inherit\" edge=\"end\">\n        <UndoIcon />\n      </IconButton>\n      <IconButton\n        onClick={() => dispatch(ActionCreators.redo())}\n        color=\"inherit\" edge=\"end\">\n        <RedoIcon />\n      </IconButton>\n    </React.Fragment>\n  );\n};\n","\nimport React from 'react';\n\nexport default props =>\n  <div className=\"loading-screen-container\">\n    <span className=\"loading-screen-contents\">\n      Loading...\n    </span>\n  </div>;\n","\nimport * as React from 'react';\nimport { useDispatch } from 'react-redux';\nimport * as core from '../reducer';\n\nimport { IconButton } from '@material-ui/core';\nimport MoreVertIcon from '@material-ui/icons/MoreVert';\nimport AddIcon from '@material-ui/icons/Add';\nimport DragIndicatorIcon from '@material-ui/icons/DragIndicator';\nimport { PopoverMenu, ConfirmDialog, PromptDialog } from '../components';\n\n// header name, add button, chips for each addon (WIP limit, EBS time estimate, etc)\nexport default ({ col, add, locked, handleProps }) => {\n  const dispatch = useDispatch();\n\n  const [confirmOpen, setConfirmOpen] = React.useState(false);\n  const confirmRespond = res => {\n    setConfirmOpen(false);\n    if (res) dispatch(core.deleteColumn(col.id))\n  }\n\n  const [promptOpen, setPromptOpen] = React.useState(false);\n  const promptRespond = res => {\n    setPromptOpen(false);\n    if (typeof res === \"string\" && res.length)\n      dispatch(core.renameColumn({ colID: col.id, name: res }));\n  }\n\n  const archiveAll = () => dispatch(core.archiveCardsInColumn(col.id));\n\n  const dateTimeAttributeUsed = col.items.filter(card => ['string','number'].indexOf(typeof card.time) !== -1).length > 0;\n  const sortByDue = () => dispatch(core.sortColByTime(col.id));\n\n  return (\n    <div>\n      <div className='columnHeaderContainer'>\n        {!locked && (\n          <IconButton size='small' {...handleProps}>\n            <DragIndicatorIcon />\n          </IconButton>\n        )}\n        <div className='columnHeaderText'>\n          {col.name}\n        </div>\n        <div style={{ flexGrow: 1 }} />\n        <div>\n          {/*\n            // TODO: column powerup API with Chip indicators\n            <Chip size='small' label=\"0/6\" />\n            <Chip size='small' label=\"3h\" />\n          */}\n          <IconButton size='small' onClick={() => add()}>\n            <AddIcon />\n          </IconButton>\n          <PopoverMenu map={{\n            ...(dateTimeAttributeUsed ? {\n              \"Sort by due\": () => sortByDue(),\n            } : {}),\n            \"Archive all\": () => archiveAll(),\n            ...(locked ? {} : {\n              \"Rename\": () => setPromptOpen(true),\n              \"Delete\": () => setConfirmOpen(true),\n            })\n          }}>\n            <IconButton size='small'>\n              <MoreVertIcon />\n            </IconButton>\n          </PopoverMenu>\n        </div>\n      </div>\n      <hr className='columnHeaderRule' />\n      {confirmOpen && (\n        <ConfirmDialog open respond={confirmRespond}\n          title=\"Delete this column?\" subtitle=\"Don't worry, this action can be undone.\" />\n      )}\n      {promptOpen && (\n        <PromptDialog open respond={promptRespond}\n          title={`Rename column \"${col.name}\"`} subtitle=\"Don't worry, this action can be undone.\"\n          label=\"Name\" placeholder={col.name} />\n      )}\n    </div>\n  );\n};\n","\nimport * as React from 'react';\nimport { useSelector } from 'react-redux';\nimport { selectors } from '../store';\nimport { Draggable } from 'react-beautiful-dnd';\nimport { Markdown } from '../components';\nimport { AttributeIndicators } from './attributes';\n\nexport default React.memo(({ card, index, setEditingCard }) => {\n  const cards = useSelector(selectors.boards.cards);\n  if (!card) return null;\n  const { id, content } = card;\n\n  return (\n    <React.Fragment>\n      <Draggable draggableId={id} index={index}>\n        {(provided, snapshot) => (\n          <div ref={provided.innerRef}\n            {...provided.draggableProps}\n            {...provided.dragHandleProps}\n            className={'card ' + (snapshot.isDragging ? \" draggingCard\" : \"\")}\n            style={provided.draggableProps.style}\n            onClick={() => setEditingCard(id)}>\n            <Markdown source={content} cards={cards} className='compact' />\n            <AttributeIndicators card={card} />\n          </div>\n        )}\n      </Draggable>\n    </React.Fragment>\n  );\n});\n","\nimport * as React from 'react';\nimport { useDispatch } from 'react-redux';\nimport * as core from '../reducer';\nimport { Button, IconButton, ButtonGroup, TextField,\n  ClickAwayListener } from '@material-ui/core';\nimport AddIcon from '@material-ui/icons/Add';\nimport DeleteIcon from '@material-ui/icons/Delete';\nimport { Droppable, Draggable } from 'react-beautiful-dnd';\nimport { mergeRefs, useEventListener, flagSet } from '../common';\nimport ColumnHeader from './column-header';\nimport Card from './card';\n\nexport default React.memo(({ col, index, setEditingCard, locked }) => {\n  const { id, items } = col;\n\n  const [editingNew, setEditingNew] = React.useState(false);\n  const [editingValue, setEditingValue] = React.useState(\"\");\n  const dispatch = useDispatch();\n  const addCard = () => {\n    if (editingValue.length)\n      dispatch(core.addCard({\n        content: editingValue,\n        colID: id\n      }));\n    setEditingValue(\"\");\n    setEditingNew(false);\n  };\n  const addButton = () => {\n    if (editingNew)\n      setEditingValue(\"\");\n    else\n      // scroll so that the add card section at the top is visible\n      scrollContainerRef.current.scrollTop = 0;\n    setEditingNew(!editingNew);\n  };\n  const scrollContainerRef = React.useRef(null);\n  const internals = (\n    <Droppable droppableId={id} className='card-droppable' type=\"card\" ignoreContainerClipping>\n      {(provided, snapshot) => (\n        <React.Fragment>\n          <div\n            className={'column-internals' + (snapshot.isDraggingOver ? ' dragging-over' : '')}\n            ref={mergeRefs(provided.innerRef, scrollContainerRef)}\n          >\n            {editingNew && (\n              <EditingCard value={editingValue} setValue={setEditingValue}\n                add={addCard} cancel={() => { setEditingValue(\"\"); setEditingNew(false) }} />\n            )}\n            {items.map((card, index) => card ? <Card card={card} index={index} key={card.id}\n              setEditingCard={setEditingCard} /> : null)}\n          </div>\n          {provided.placeholder}\n        </React.Fragment>\n      )}\n    </Droppable>\n  );\n\n  return (\n    <Draggable draggableId={id} index={index} isDragDisabled={locked}>\n      {(provided, snapshot) => (\n        <div ref={provided.innerRef}\n          {...provided.draggableProps}\n          className={\"columnContainer\" + (snapshot.isDragging ? \" draggingColumn\" : \"\")}\n          style={provided.draggableProps.style}>\n          <div className=\"column\">\n            <div>\n              <ColumnHeader col={col} add={addButton} locked={locked} handleProps={provided.dragHandleProps} />\n            </div>\n            <div className='column-internals-container'>\n              {internals}\n            </div>\n          </div>\n        </div>\n      )}\n    </Draggable>\n  );\n});\n\nconst EditingCard = ({ value, setValue, add, cancel }) => {\n  // Pressing ESC cancels editing a card, and Ctrl+Enter adds it\n  useEventListener(document, 'keydown', e => {\n    if (e.which === 27) cancel();\n    else if (e.ctrlKey && e.which === 13 && !flagSet('dialog')) add();\n  });\n  return (\n    // Clicking away while empty cancels editing a card\n    <ClickAwayListener onClickAway={() => !value.length && cancel()}>\n      <div className='new-card-sheet'>\n        <TextField\n          label=\"New card\"\n          multiline\n          autoFocus\n          rowsMax={6}\n          value={value}\n          onChange={e => setValue(e.target.value)}\n          variant=\"filled\"\n          style={{ width: \"100%\" }} />\n        <ButtonGroup variant=\"contained\" size='small' className='editingCardButtons'>\n          <Button style={{flexGrow: 1}} variant='contained' onClick={add}>\n            Done\n          </Button>\n          <Button onClick={cancel}><DeleteIcon style={{color: '#555'}} /></Button>\n        </ButtonGroup>\n      </div>\n    </ClickAwayListener>\n  );\n};\n\nexport const AddColumn = ({ add, hide }) => {\n  return (\n    <div className={'addColumnContainer columnContainer ' + (hide ? ' hidden' : '')}>\n      <div className='addColumn column'>\n        <IconButton onClick={add} variant='outlined'>\n          <AddIcon />\n        </IconButton>\n      </div>\n    </div>\n  );\n}\n","\nimport * as React from 'react';\nimport { useSelector, useDispatch } from 'react-redux';\nimport * as core from '../reducer';\nimport { selectors } from '../store';\nimport { DragDropContext, Droppable } from 'react-beautiful-dnd';\nimport { PromptDialog, CardEditDialog } from '../components';\nimport { useHashLocation, encURI } from '../common';\nimport Column, { AddColumn } from './column';\nimport './index.scss';\n\nexport default ({ tabInfo, columnsLocked }) => {\n  const tab = tabInfo.index;\n  const tabObj = tabInfo.tab;\n  const dispatch = useDispatch();\n\n  const tabOrder = useSelector(selectors.boards.tabOrder);\n  const columns = useSelector(selectors.boards.getColumnsInTabs)[tabOrder[tab]];\n  const tabs = useSelector(selectors.boards.tabs);\n  const cards = useSelector(selectors.boards.cards);\n  const colIDs = tabs[tabOrder[tab]].columns;\n\n  // dispatch move card action\n  const onDragEnd = res => {\n    if (!res.destination) return;\n    if (res.type === \"card\") {\n      dispatch(core.moveCard([\n        res.source.droppableId, res.destination.droppableId,\n        res.source.index, res.destination.index\n      ]));\n    } else if (res.type === \"column\") {\n      dispatch(core.moveColumn([\n        res.source.index, res.destination.index, tab\n      ]));\n    }\n  };\n\n  const [promptOpen, setPromptOpen] = React.useState(false);\n  const promptRespond = name => {\n    setPromptOpen(false);\n    if (typeof name === \"string\" && name.length)\n      dispatch(core.addColumn({ tabID: tabObj.id, name }));\n  }\n\n  const [loc, setLoc] = useHashLocation();\n  // editing card if URL is /board/CARD_ID/edit\n  const editingCard = loc.split(\"/\")[4] === \"edit\" ? loc.split(\"/\")[3] : null;\n\n  const cardsByTab = useSelector(selectors.boards.cardsByTab);\n  const tabIDfromCardID = id => Object.keys(cardsByTab).filter(tabID => cardsByTab[tabID].indexOf(id) !== -1);\n  const setEditingCard = id => id\n    ? setLoc(`/boards/${encURI(tabs[tabIDfromCardID(id)].name)}/${id}/edit`)\n    : setLoc(`/boards/${loc.split(\"/\")[2]}`);\n\n  return (\n    <div className='boardview-root'>\n      <DragDropContext onDragEnd={onDragEnd}>\n        <Droppable droppableId=\"default\" className='column-droppable' direction=\"horizontal\" type=\"column\">\n          {(provided, snapshot) => (\n            <React.Fragment>\n              <div className='root' ref={provided.innerRef}>\n                {colIDs.map((colID, i) => <Column col={columns[i]} key={colID} index={i}\n                  setEditingCard={setEditingCard} locked={columnsLocked} />)}\n                {!columnsLocked && <AddColumn add={() => setPromptOpen(true)} hide={snapshot.isDraggingOver || snapshot.draggingFromThisWith} />}\n                {!colIDs.length && columnsLocked && (\n                  <div className=\"loading-screen-container\">\n                    <span className=\"loading-screen-contents\">\n                      <em>Choose \"Unlock columns\" in the top right menu to add a column</em>\n                    </span>\n                  </div>\n                )}\n              </div>\n              {provided.placeholder}\n            </React.Fragment>\n          )}\n        </Droppable>\n      </DragDropContext>\n      {promptOpen && (\n        <PromptDialog open respond={promptRespond}\n          title=\"Add column\" label=\"Name\" />\n      )}\n      {editingCard && Object.prototype.hasOwnProperty.call(cards, editingCard) && (\n        <CardEditDialog respond={() => setEditingCard(null)} card={cards[editingCard]} />\n      )}\n    </div>\n  );\n}\n","\nimport * as React from 'react';\nimport { useSelector, useDispatch } from 'react-redux';\nimport { TabView } from '../components';\nimport BoardView from './boardview';\nimport * as core from '../reducer';\nimport { selectors } from '../store';\nimport { ConfirmDialog, PromptDialog } from '../components';\nimport { useHashLocation, useTitle, encURI } from '../common';\n\nexport default ({ active }) => {\n  const dispatch = useDispatch();\n  const [loc, setLoc] = useHashLocation();\n  // {id:{name, id, columns (ids)},...}\n  const tabs = useSelector(selectors.boards.tabs);\n  const tabOrder = useSelector(selectors.boards.tabOrder);\n  let currentTab = tabOrder.map(tabID => encURI(tabs[tabID].name) === loc.split(\"/\")[2]).indexOf(true);\n  const setCurrentTab = num => setLoc(\"/boards/\"+encURI(tabs[tabOrder[num]].name));\n  useTitle(() => active && currentTab >= 0 && tabs[tabOrder[currentTab]].name + \" | Mirror\");\n  if (currentTab >= 0) window.__lastCurrentTab = currentTab;\n  if (currentTab < 0) currentTab = window.__lastCurrentTab || 0;\n  const [columnsLocked, _setColumnsLocked] = React.useState(localStorage.columnsLocked === \"false\");\n  const setColumnsLocked = x => { localStorage.columnsLocked = JSON.stringify(!x); _setColumnsLocked(x) }\n\n  const [confirmOpen, setConfirmOpen] = React.useState(false);\n  const confirmRespond = res => {\n    setConfirmOpen(false);\n    if (res) {\n      dispatch(core.deleteTab(currentTab));\n      setCurrentTab(Math.max(0,currentTab-1));\n    }\n  }\n\n  const [addPromptOpen, setAddPromptOpen] = React.useState(false);\n  const addPromptRespond = res => {\n    setAddPromptOpen(false);\n    if (typeof res === \"string\" && res.length)\n      dispatch(core.addTab(res));\n  }\n\n  const [renamePromptOpen, setRenamePromptOpen] = React.useState(false);\n  const renamePromptRespond = res => {\n    setRenamePromptOpen(false);\n    if (typeof res === \"string\" && res.length)\n      dispatch(core.renameTab({ tabID: tabOrder[currentTab], name: res }));\n    setLoc(\"/boards/\"+encURI(res));\n  }\n\n  const tabName = tabs[tabOrder[currentTab]].name;\n\n  return (\n    <React.Fragment>\n      <TabView\n        tabs={tabOrder.map(tabID => tabs[tabID].name)}\n        render={i =>\n          <BoardView key={i}\n            tabInfo={{ tab: tabs[tabOrder[i]], index: i }}\n            columnsLocked={columnsLocked}\n          />\n        }\n        addTab={() => setAddPromptOpen(true)}\n        renameTab={() => setRenamePromptOpen(true)}\n        deleteTab={() => Object.values(tabs).length > 1 ? setConfirmOpen(true) : alert(\"Cannot delete only tab\")}\n        moveTab={data => dispatch(core.moveTab(data))}\n        index={currentTab} setIndex={setCurrentTab}\n        columnsLocked={columnsLocked}\n        toggleColumnsLocked={() => setColumnsLocked(!columnsLocked)}\n      />\n      {confirmOpen && (\n        <ConfirmDialog open respond={confirmRespond}\n          title=\"Delete this tab?\" subtitle=\"Don't worry, this action can be undone.\" />\n      )}\n      {addPromptOpen && (\n        <PromptDialog open respond={addPromptRespond} title=\"Add tab\" label=\"Name\" />\n      )}\n      {renamePromptOpen && (\n        <PromptDialog open respond={renamePromptRespond}\n          title={`Rename tab ${tabName}`} label=\"Name\"\n          placeholder={tabName} />\n      )}\n    </React.Fragment>\n  );\n}\n","\nimport * as React from 'react';\nimport { useHashLocation, useTitle, generateID, ReloadProtect,\n  useEventListener } from '../common';\nimport { selectors } from '../store';\nimport { useSelector, useDispatch } from 'react-redux';\nimport { Markdown, AutocompleteEditor } from '../components';\nimport {\n  TextField, Button, ButtonGroup,\n  // Drawer, List, Divider, ListItem, ListItemText\n} from '@material-ui/core';\nimport EditIcon from '@material-ui/icons/Edit';\nimport DeleteIcon from '@material-ui/icons/Delete';\nimport AddIcon from '@material-ui/icons/Add';\nimport SearchIcon from '@material-ui/icons/Search';\nimport StarIcon from '@material-ui/icons/Star';\nimport StarBorderIcon from '@material-ui/icons/StarBorder';\nimport * as core from '../reducer';\nimport './index.scss';\n\nexport default ({ active }) => {\n  const [loc] = useHashLocation();\n  const dispatch = useDispatch();\n  const cards = useSelector(selectors.boards.cards);\n  const loadingZettel = useSelector(selectors.boards.loadingZettel);\n\n  const currentCardID = loc.split('/')[2] || 'main'; //#/notes/ID\n  // const setCurrentCardID = id => setLoc(`/notes/${id}`);\n\n  if (!Object.prototype.hasOwnProperty.call(cards, currentCardID)) {\n    // If card either does not exist, or is not loaded into memory\n    // but is in IndexedDB (assuming sync with remote server is complete)\n    dispatch(core.loadZettel(currentCardID));\n    return <ZettelLoadingView />;\n  }\n\n  if (loadingZettel === true)\n    return <ZettelLoadingView />;\n\n  if (loadingZettel === currentCardID)\n    return <ZettelFailedLoadingView id={currentCardID} />;\n\n  return <ZettelView\n    active={active} dispatch={dispatch} cards={cards}\n    currentCardID={currentCardID} />\n}\n\nfunction ZettelLoadingView () {\n  return (\n    <span>Loading Zettel...</span>\n  );\n}\n\nfunction ZettelFailedLoadingView () {\n  return (\n    <span>Failed to load Zettel. Either synchronisation failed or it does not exist.</span>\n  );\n}\n\nfunction ZettelView ({\n  active, dispatch, cards, currentCardID\n}) {\n  const [loc, setLoc] = useHashLocation();\n  const editing = loc.split('/')[3] === 'edit'; //#/notes/ID/edit\n  const starred = useSelector(selectors.boards.starredZettels);\n  const card = cards[currentCardID];\n  const [newCard, setNewCard] = React.useState({ ...card }); // assuming no deep nesting\n  useTitle(() => active && newCard.content + \" | Mirror\");\n  const setCard = part => setNewCard({ ...newCard, ...part });\n  // Ctrl+Enter to save zettels\n  useEventListener(document, 'keydown', e => {\n    if (editing && e.which === 13 && e.ctrlKey) {\n      saveZettel(newCard);\n    }\n  });\n\n  if (typeof card !== 'object') return null;\n\n  const setEditing = yes => yes\n    ? setLoc(`/notes/${currentCardID}/edit`)\n    : setLoc(`/notes/${currentCardID}`);\n  const cancelEditing = () => {\n    setEditing(false);\n    setNewCard({...card});\n  }\n\n  const deleteZettel = () => {\n    dispatch(core.deleteCard(currentCardID));\n    setLoc('/notes/main');\n  }\n  const saveZettel = zettel => {\n    dispatch(core.editZettel({ zettel }));\n    setEditing(false);\n  }\n  const starZettel = () =>\n    dispatch(core.toggleZettelStarred(currentCardID));\n\n  // update editing field on card change\n  if (card.id !== newCard.id) {\n    // We want to save the card if the 'Add note' button was pressed\n    // The only time a card is not saved is if you press cancel or delete\n    dispatch(core.editZettel({ zettel: newCard }));\n    setNewCard({ ...card });\n  }\n\n  const addZettel = id => {\n    // create a new card and navigate to editing it\n    dispatch(core.addZettel({ zettel: { content: 'New note', description: '...', id } }));\n    setLoc(`/notes/${id}/edit`);\n  };\n\n  const addNewNote = id => {\n    dispatch(core.editZettel({ zettel: newCard }));\n    addZettel(id);\n  }\n\n  const ZettelButtons = () => (\n    <ButtonGroup variant='contained' color='primary'>\n      {!editing && (\n        <Button onClick={() => setEditing(true)} title=\"Edit note\">\n          <EditIcon />\n        </Button>\n      )}\n      {!editing && (\n        <Button onClick={() => addZettel(generateID())} title=\"Add note\">\n          <AddIcon />\n        </Button>\n      )}\n      <Button onClick={() => alert('TODO')} title=\"Search notes\">\n        <SearchIcon />\n      </Button>\n      {starred.indexOf(card.id) === -1 ? (\n        <Button onClick={starZettel} title=\"Star this note\">\n          <StarBorderIcon />\n        </Button>\n      ) : (\n        <Button onClick={starZettel} title=\"Unstar this note\">\n          <StarIcon />\n        </Button>\n      )}\n      {card.id !== 'main' && (\n        <Button onClick={deleteZettel} title=\"Delete note\">\n          <DeleteIcon />\n        </Button>\n      )}\n    </ButtonGroup>\n  );\n\n  // TODO: drawer\n  // Responsive: https://material-ui.com/components/drawers/#responsive-drawer\n  // Search bar: https://material-ui.com/components/text-fields/#icons\n  //   or https://material-ui.com/components/app-bar/#app-bar-with-a-primary-search-field\n  // Starred cards\n  // All notes button (navigate to #/notes/all and show a list of notes without contents)\n  // const Drawer = () => (\n  //   <Drawer\n  //     className='zettelDrawer'\n  //     variant=\"permanent\"\n  //     classes={{\n  //       paper: 'zettelDrawerPaper',\n  //     }}\n  //   >\n  //     <div className='zettelDrawerContainer'>\n  //       <List>\n  //         {['Inbox', 'Starred', 'Send email', 'Drafts'].map((text, index) => (\n  //           <ListItem button key={text}>\n  //             <ListItemText primary={text} />\n  //           </ListItem>\n  //         ))}\n  //       </List>\n  //       <Divider />\n  //       <List>\n  //         {['All mail', 'Trash', 'Spam'].map((text, index) => (\n  //           <ListItem button key={text}>\n  //             <ListItemText primary={text} />\n  //           </ListItem>\n  //         ))}\n  //       </List>\n  //     </div>\n  //   </Drawer>\n  // );\n\n  return (\n    <React.Fragment>\n      <ReloadProtect shouldProtect={JSON.stringify(newCard) !== JSON.stringify(card)} />\n      <div className='zettelContainer'>\n        <div className='zettelButtons' id='zettel-buttons-container'>\n          <ZettelButtons />\n        </div>\n        <div className='zettelColumns'>\n          {editing && (\n            <div className={'zettel' + (editing ? ' editing-pane' : '')}>\n              <TextField margin=\"dense\" autoFocus fullWidth className=\"zettelEditingTitle\"\n                multiline rowsMax={3} value={newCard.content || ''} onChange={e => setCard({ content: e.target.value })} />\n              <div className=\"zettelEditingContent\">\n                <AutocompleteEditor value={newCard.description || ''} setValue={description => setCard({ description })}\n                  addNote={addNewNote} className=\"zettelEditingInput\" />\n              </div>\n              <div className='zettelEditingButtons'>\n                <Button onClick={() => saveZettel(newCard)} color=\"primary\" variant=\"contained\">Save</Button>\n                <Button onClick={cancelEditing} color=\"primary\">Cancel</Button>\n              </div>\n            </div>\n          )}\n          <div className={'zettel' + (editing ? ' currently-editing' : '')}>\n            <div className='zettelTitle'>\n              {(editing ? newCard.content : card.content) || ''}\n            </div>\n            <Markdown source={(editing ? newCard.description : card.description) || ''} cards={cards} />\n          </div>\n        </div>\n      </div>\n    </React.Fragment>\n  );\n}\n","\n/**\n * app.js\n * Main JSX source\n */\n\nimport React from 'react';\nimport { Provider, useSelector, useDispatch } from 'react-redux';\nimport * as core from './reducer';\nimport { synchroniseState, loggedIn } from './backends/github';\nimport { useHashLocation, useInterval, Hidden, ThemeProvider } from './common';\nimport { SnackbarProvider, useSnackbar } from 'notistack';\n\nimport { MenuBar, LoadingScreen } from './components';\nimport Kanban from './kanban';\nimport Zettelkasten from './zettelkasten';\nimport store, { globalSelectors as sel } from './store';\n\nconst baseTabNames = [\"boards\", \"notes\"];\n// Get the nth segment of a slash separated list\nconst getURLPart = (str, n) =>\n  str.split(\"/\").filter(s=>s.length)[n < 0 ? str.length + n : n];\nconst getScreen = loc =>\n  Math.max(baseTabNames.indexOf(getURLPart(loc, 0)), 0);\nconst getScreenNames = () => [\"/boards/\", \"/notes/main\"];\n\nconst ComponentsContainer = ({ active, setActive }) => {\n  return (\n    <React.Fragment>\n      <Hidden show={active === 0} className='app-section'>\n        <Kanban active={active === 0} />\n      </Hidden>\n      <Hidden show={active === 1} className='app-section'>\n        <Zettelkasten active={active === 1} />\n      </Hidden>\n    </React.Fragment>\n  );\n};\n\nconst Root = () => {\n  const dispatch = useDispatch();\n  // Update state cache every little while to support concurrent changes across devices\n  // It usually takes up to 30 seconds for the revisions to become available so\n  // more frequent querying is pointless\n  useInterval(() => {\n    if (loggedIn()) {\n      synchroniseState().then(diff => dispatch(core.overwriteState(diff)));\n    }\n  }, 15000);\n  const [loc, setLoc] = useHashLocation();\n  const [tabURLs, setTabURLs] = React.useState([]);\n  const [loading, setLoading] = React.useState(true);\n  const { enqueueSnackbar } = useSnackbar();\n  window.snackbar = enqueueSnackbar;\n  // BUG: for some reason the intial state is not the loading state\n  // in our createReducer shim and the prevState at first is the empty undoable state\n  // The below `state.present === undefined` is a temporary workaround\n  // useSelector(console.log);\n  const currentlyLoading = useSelector(state => state.present === undefined || sel.boards(state).loading);\n  if (loading && !currentlyLoading) {\n    setTabURLs(getScreenNames());\n    setLoading(false);\n  }\n  if (currentlyLoading) return <LoadingScreen />;\n  const setTabURL = (newURL, i, move) => {\n    let newTabURLs = tabURLs.slice(0);\n    newTabURLs[i] = newURL;\n    setTabURLs(newTabURLs);\n    if (move) setLoc(newURL);\n  };\n  const active = getScreen(loc);\n  const setActive = n => {\n    if (n === active) {\n      // Return to the base page of this tab\n      setTabURL(getScreenNames()[active], active, true);\n    } else {\n      // Save the current URL as the return URL for this tab\n      setTabURL(loc, active);\n      // Set the location to the saved URL for the new tab\n      setLoc(tabURLs[n]);\n    }\n  }\n\n  return (\n    <div id=\"jsx-root\">\n      <ComponentsContainer active={active} setActive={setActive} />\n      <MenuBar active={active} setActive={setActive} />\n    </div>\n  );\n}\n\nexport default () =>\n  <ThemeProvider id='theme-root'>  {/* Provides window.setTheme('light'|'dark') global function */}\n    <Provider store={store}>\n      <SnackbarProvider maxSnack={3} autoHideDuration={3000}\n        classes={{ containerRoot: 'snackbar-root' }}>\n        <Root />\n      </SnackbarProvider>\n    </Provider>\n  </ThemeProvider>\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' },\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then(registration => {\n        registration.unregister();\n      })\n      .catch(error => {\n        console.error(error.message);\n      });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport Application from './app.js';\nimport * as serviceWorker from './serviceWorker';\nimport './index.scss';\n\nReactDOM.render(\n  <Application/>,\n  document.getElementById('root')\n);\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://create-react-app.dev/docs/making-a-progressive-web-app/\nserviceWorker.unregister();\n","\nexport const linkName = card => {\n  if (!card) return 'unknown';\n  const firstLine = card.content.split('\\n')[0];\n  if (firstLine.length > 40) return firstLine.substring(0,37) + '...';\n  return firstLine;\n};\n\nexport const abbreviatedDescription = card => {\n  if (!card) return '';\n  // If it's a string, use it. If it's a card, use description with fallback on title. Otherwise, unknown.\n  const text = card ? (typeof card === 'string' ? card : (card.description || card.content)) : 'unknown';\n  const limit = 500; // crop after this with ellisis\n  const title = text.split(\"\\n\\n\").join(\"\\n\").substring(0, limit)\n    + (text.length > limit ? \"...\" : \"\");\n  return title;\n};\n\nexport const parseWikilinks = (source, cards, prefix = '#/notes/') => {\n  const regex = /(\\[\\[[A-Za-z0-9_-]+\\]\\])/gm; // assumes card IDs are alphanumeric + dash + underscore\n  let m;\n  while ((m = regex.exec(source)) !== null) {\n    if (m.index === regex.lastIndex) regex.lastIndex++;\n    // m.index is the index in 'source'\n    const parseable = (source.substring(0, m.index).match(/`/gm) || []).length % 2 === 0;\n    if (!parseable) continue;\n\n    // m[1] is the actual match\n    let cardID = m[1].substring(2, m[1].length - 2);\n\n    // replace [[CARD_ID]] with [CARD_NAME](#/notes/CARD_ID)\n    let before = source.substring(0, m.index),\n        name = linkName(cards[cardID]),\n        link = prefix + cardID,\n        after = source.substring(m.index + m[1].length, source.length);\n    source = before + `[${name}](${link})` + after;\n  }\n  return source;\n};\n\n// regex must have /g flag\nconst countRegexOccurrences = (str, re) =>\n  ((str || '').match(re) || []).length;\n\n// Parse LaTeX math formulae using KaTeX\nexport const parseLaTeX = (string, katex) => {\n  if (string.indexOf(\"$$\") === -1) return string;\n\n  const blockRegex = /<p>\\$\\$([^\\n]+)\\$\\$<\\/p>/m;\n  const inlineRegex =   /\\$\\$([^\\n]+)\\$\\$/m;\n\n  const render = (str, displayMode) => katex.renderToString(str, { throwOnError: false, displayMode });\n\n  const fmapRegexMatch = (str, displayMode) => {\n    // Only replace after the previous match to avoid infinite loops\n    let lastIndex = 0;\n    let regex = displayMode ? blockRegex : inlineRegex;\n    let m = str.match(regex);\n\n    // Limit to 100 equations\n    for (let i = 0; i < 100 && lastIndex < str.length && m; i++) {\n      // Skip <code> or <pre> blocks\n      const proceed = countRegexOccurrences(str.substring(0, lastIndex + m.index), /<(code|pre)[^>]*>/g)\n                  === countRegexOccurrences(str.substring(0, lastIndex + m.index), /<\\/(code|pre)>/g);\n\n      if (proceed) {\n        str = str.substring(0, m.index + lastIndex)\n            + render(m[1], displayMode)\n            + str.substring(m.index + lastIndex + m[0].length, str.length);\n      }\n\n      lastIndex += m.index + m[0].length;\n      m = str.substring(lastIndex, str.length).match(regex);\n    }\n\n    return str;\n  };\n\n  return fmapRegexMatch(fmapRegexMatch(string, true), false);\n};\n\nexport const encURI = x => encodeURIComponent(x.toLowerCase().replace(/ /g, '-'));\n","\nimport * as React from 'react';\nimport DOMPurify from 'dompurify';\nimport { ThemeProvider as MUIThemeProvider, createMuiTheme } from '@material-ui/core/styles';\n\n// Source: https://www.davedrinks.coffee/how-do-i-use-two-react-refs/\nexport const mergeRefs = (...refs) => {\n  const filteredRefs = refs.filter(Boolean);\n  if (!filteredRefs.length) return null;\n  if (filteredRefs.length === 0) return filteredRefs[0];\n  return inst => {\n    for (const ref of filteredRefs) {\n      if (typeof ref === 'function') {\n        ref(inst);\n      } else if (ref) {\n        ref.current = inst;\n      }\n    }\n  };\n};\n\n// Web: returns the current hash location (excluding the '#' symbol)\n// Based on https://codesandbox.io/s/wouter-hash-based-hook-5fp9g\nconst currentLoc = () => window.location.hash.replace(\"#\", \"\") || \"/\";\nexport const useHashLocation = () => {\n  const [loc, setLoc] = React.useState(currentLoc());\n  React.useEffect(() => {\n    const handler = () => setLoc(currentLoc());\n    window.addEventListener(\"hashchange\", handler);\n    return () => window.removeEventListener(\"hashchange\", handler);\n  }, []);\n  const navigate = React.useCallback(to => window.location.hash = to, []);\n  // const navigateNoHistory = React.useCallback(to => {\n  //   window.history.replaceState(undefined, undefined, \"#\"+to);\n  //   setLoc(to); // because handler does not detect replaceState\n  // }, []);\n  // Disable no history navigation as it breaks currentLoc\n  return [loc, navigate, navigate/*NoHistory*/];\n};\n\n// You can supply a title, a function that produces a title each render, or null\n// In every case the title is reset to its original value afterwards\nlet __useTitleInUse = 0;\nexport const useTitle = title => {\n  if (typeof title === \"function\") {\n    const result = title();\n    if (result)\n      document.title = result;\n  }\n  React.useEffect(() => {\n    const original = document.title;\n    __useTitleInUse++;\n    if (typeof title === \"string\")\n      document.title = title;\n    return () => !(__useTitleInUse--) && (document.title = original);\n  });\n}\n\nexport const useInterval = (f, ms) => {\n  React.useEffect(() => {\n    const id = setInterval(f, ms);\n    return () => clearInterval(id);\n  }, [f, ms]);\n}\n\nexport const useEventListener = (elem, event, callback) => {\n  React.useEffect(() => {\n    elem.addEventListener(event, callback);\n    return () => elem.removeEventListener(event, callback);\n  });\n}\n\n// Non atomic boolean flags scoped to a component's mount lifecycle\nexport const flagSet = name => window['__flag_'+name];\nexport const useFlag = name => {\n  React.useEffect(() => {\n    const flagName = '__flag_'+name;\n    window[flagName] = true;\n    return () => window[flagName] = false;\n  });\n}\n\n// Note: ReloadProtect does not prevent hash changes. Be warned!\nexport const ReloadProtect = ({ shouldProtect = true }) => {\n  React.useEffect(() => {\n    // componentDidMount\n    if (shouldProtect)\n      window.onbeforeunload = e => \"Are you sure you want to quit?\";\n    // componentWillUnmount\n    return () => window.onbeforeunload = null;\n  });\n  return null;\n}\n\nexport const Hidden = ({ children, show, ...props }) =>\n  <div style={show ? {} : { display: \"none\" }} {...props}>\n    {children}\n  </div>;\n\nexport const RawHTMLElement = ({ source, ...props }) => {\n  const ref = React.useRef(null);\n  React.useEffect(() => {\n    ref.current.appendChild(source);\n  });\n  return <span ref={ref} {...props} />\n}\n\n// DOMPurify reduces XSS risk\nexport const RawHTMLString = ({ source, purify = true, ...props }) =>\n  <span dangerouslySetInnerHTML={{\n      __html: purify\n        ? DOMPurify.sanitize(source, { ADD_ATTR: ['target'] })\n        : source\n    }} {...props}\n  />;\n\n// <ErrorBoundary fallback={<p>failed</p>}>\n//   <ComponentWhichCanThrow />\n// </ErrorBoundary>\nexport class ErrorBoundary extends React.Component {\n  state = { hasError: false, error: null };\n  static getDerivedStateFromError(error) {\n    return {\n      hasError: true,\n      error\n    };\n  }\n  render() {\n    if (this.state.hasError) {\n      return this.props.fallback;\n    }\n    return this.props.children;\n  }\n}\n\n// useGlobal hook can be used as follows:\n// In a component:\n//   useGlobal('setTheme', function (args) {...});\n// Anywhere else in the app:\n//   window.setTheme(args);\n// It allows an imperative API which despite being against\n// React's design principles is often very useful.\n// Note that this should only be called once per name and the lifecycle\n// of the component should always exceed that of the users\nexport function useGlobal(name, value) {\n  React.useEffect(() => {\n    window[name] = value;\n    return () => delete window[name];\n  });\n}\n\n// <ThemeProvider mode=\"dark\">\n//   <App />\n// </ThemeProvider>\n// Provides a container with a class on the child element, eg \"div.theme-dark\"\nexport class ThemeProvider extends React.Component {\n  state = { theme: localStorage.theme || \"light\" };\n  constructor (props) {\n    super(props);\n    this.themes = {\n      dark: createMuiTheme({\n        palette: {\n          type: \"dark\",\n          primary:   { main: \"#90caf9\" },\n          secondary: { main: \"#f48fb1\" },\n          error:     { main: \"#f44336\" },\n          warning:   { main: \"#ff9800\" },\n          info:      { main: \"#2196f3\" },\n          success:   { main: \"#4caf50\" },\n        }\n      }),\n      light: createMuiTheme({ palette: { type: \"light\" } })\n    }\n  }\n  componentDidMount () {\n    window.setTheme = theme => this.setState({ theme }, () => localStorage.theme = theme);\n  }\n  render () {\n    document.documentElement.className = 'theme-' + this.state.theme;\n    return (\n      <MUIThemeProvider theme={this.themes[this.state.theme]}>\n        {this.props.children}\n      </MUIThemeProvider>\n    );\n  }\n}\n","\nimport * as fn from 'date-fns';\n\nexport const simpleDate = date => fn.format(date, \"yyyyMMdd-hhmmss\");\n\nlet __lastGeneratedID = null;\nexport const generateID = () => {\n  const timeString = simpleDate(new Date());\n  let newID = timeString;\n  // if we generate multiple IDs in one second, we add \"-n\" where n is 1,2,...\n  // the only time this causes collisions is if you add a card, refresh, add a card within 1s\n  if (__lastGeneratedID !== null && __lastGeneratedID.substring(0, timeString.length) === newID) {\n    if (__lastGeneratedID.length === timeString.length) newID += \"-1\";\n    else newID += '-' + (parseInt(__lastGeneratedID.substring(timeString.length + 1, __lastGeneratedID.length)) + 1)\n  }\n  __lastGeneratedID = newID;\n  return newID;\n}\n\n/**\n * Returns a heavily abbreviated pretty printed date using date-fns\n * - Only includes time if within a week and not midnight\n * - Only includes minutes if nonzero\n * - Replaces date with \"Tomorrow\", \"Next Fri\" or \"Last Wed\", etc.\n */\nexport const prettyPrintDate = epochMilliseconds => {\n  const date = new Date(epochMilliseconds);\n  const now = new Date();\n\n  const getDate = date => {\n    const diff = fn.differenceInCalendarDays(date, now);\n    const weekDiff = fn.differenceInCalendarWeeks(date, now, { weekStartsOn: 1 });\n    const yearDiff = fn.differenceInCalendarYears(date, now);\n    // 0 is Monday\n    let dayOfWeek = now.getDay() - 1;\n    // JavaScript's modulo is broken for negatives, so we must use an if statement\n    if (dayOfWeek < 0) dayOfWeek += 7;\n\n    // Relative dates are quite ambiguous in English\n    // If today is Wednesday 23 September 2020, then the following mappings are adhered to:\n\n    // 15/9/19: Sun 15 Sep 2019\n    // 15/9/20: Tue 15 Sep\n    // 16/9/20: Last Wed\n    // 21/9/20: Last Mon\n    // 22/9/20: Yesterday\n    // 23/9/20: Today\n    // 24/9/20: Tomorrow\n    // 25/9/20: Fri\n    // 27/9/20: Sun\n    // 28/9/20: Next Mon\n    // 7/10/20: Wed Week\n\n    if (diff ===  0) return \"Today\";\n    if (diff === -1) return \"Yesterday\";\n    if (diff ===  1) return \"Tomorrow\";\n\n    const day = fn.format(date, \"EEE\"); // eg Mon, Thu\n\n    // If it's this calendar week,\n    // or during the weekend it is a weekday the next week\n    if ((weekDiff === 0 && diff >= 0)\n     || (dayOfWeek >= 5 && diff >= 0 && (dayOfWeek + diff) - 7 < 5)) return day;\n\n    if (diff >= -7 && diff <   0) return `Last ${day}`;\n    if (diff >   0 && diff <=  7) return `Next ${day}`;\n    if (diff >   7 && diff <= 14) return `${day} Week`;\n\n    if (yearDiff === 0)\n      return fn.format(date, \"EEE do MMM\"); // eg: Thu 17th Sep\n    else\n      return fn.format(date, \"EEE do MMM yyyy\"); // eg: Fri 17th Sep 2021 if it's not 2021\n  }\n\n  const getTime = date => {\n    // ignore time if midnight\n    if (date.getHours() === 0 && date.getMinutes() === 0) return null;\n    // No minutes; eg 4PM\n    if (date.getMinutes() === 0) return fn.format(date, \"haaa\");\n    return fn.format(date, \"h:mmaaa\");\n  }\n\n  const time = getTime(date);\n  return getDate(date) + (time ? \" \" + time : \"\");\n};\n\nexport const timeUrgencyClassName = ms => {\n  const remaining = (ms - new Date().getTime()) / 1000;\n  if (remaining < 0) return 'urgency-overdue';\n  if (remaining < 7200) return 'urgency-two-hours';\n  if (remaining < 86400) return 'urgency-day';\n  if (remaining < 86400*7) return 'urgency-week';\n  if (remaining < 86400*7*2) return 'urgency-fortnight';\n  return null;\n}\n","\nexport * from './string';\nexport * from './react';\nexport * from './time';\n\n// Source: https://stackoverflow.com/a/14810722/4642943\n// returns a new object with the values at each key mapped using mapFn(value)\nexport const objectMap = (object, mapFn) =>\n  Object.keys(object).reduce(function(result, key) {\n    result[key] = mapFn(object[key])\n    return result\n  }, {});\n\n// Source: https://stackoverflow.com/a/52323412/4642943\nexport const shallowEqual = (obj1, obj2) =>\n  Object.keys(obj1).length === Object.keys(obj2).length &&\n  Object.keys(obj1).every(key => obj1[key] === obj2[key]);\n\nexport const deleteInList = (list, elem) => {\n  let index = list.indexOf(elem);\n  if (index !== -1) list.splice(index, 1); // undesired behaviour when splicing at (-1, 1)\n  return index !== -1;\n};\n\n// Deep copy synchronously via structured clone algorithm\n// Source: https://twitter.com/DasSurma/status/955484341358022657\nexport const structuredClone = obj => {\n  const oldState = window.history.state;\n  window.history.replaceState(obj, window.title);\n  const copy = window.history.state;\n  window.history.replaceState(oldState, window.title);\n  return copy;\n};\n\n// Deep merge two objects\nexport const isObject = item => item && typeof item === 'object' && !Array.isArray(item);\nexport function deepMerge (target, source) {\n  if (isObject(target) && isObject(source))\n    for (const key in source)\n      if (isObject(source[key]) && isObject(target[key]))\n        deepMerge(target[key], source[key]);\n      else\n        target[key] = source[key];\n  return target;\n}\n\n// Web: Download content as filename with specificed MIME type\nexport const downloadData = (content, filename, type) => {\n  if(!type) type = 'application/octet-stream';\n  const a = document.createElement('a');\n  const blob = new Blob([content], { type });\n  a.href = window.URL.createObjectURL(blob);\n  a.download = filename;\n  a.click();\n}\n\n// Simple card search; searches titles then descriptions then IDs for case insensitive exact matches\nexport const searchCards = (term, cards, limit=10, allowArchived=false) => {\n  let cardIDs = Object.keys(cards);\n  if (!allowArchived) {\n    cardIDs = cardIDs.filter(cardID => !cards[cardID].archived);\n  }\n  let matches = [];\n  let tl = term.toLowerCase();\n  for (const cardID of cardIDs) {\n    if (cards[cardID].content.toLowerCase().includes(tl)) {\n      matches.push(cardID);\n      if (matches.length === limit) return matches;\n    }\n  }\n  for (const cardID of cardIDs) {\n    if (cards[cardID].description && cards[cardID].description.toLowerCase().includes(tl)) {\n      matches.push(cardID);\n      if (matches.length === limit) return matches;\n    }\n  }\n  for (const cardID of cardIDs) {\n    if (cardID.toLowerCase().includes(tl)) {\n      matches.push(cardID);\n      if (matches.length === limit) return matches;\n    }\n  }\n  return matches;\n}\n\n// @reduxjs/toolkit's createReducer uses Immer internally which is great\n// until you need to access the mutated piece of state directly to send it\n// to the backend, when Immer only supplies a Proxy instead of an Object\n// This variant has opt-in Immer support (you can call produce if desired)\nexport function createReducer (initialState, actionMap) {\n  return (prevState = initialState, action) => {\n    if (Object.prototype.hasOwnProperty.call(actionMap, action.type)) {\n      const nextState = actionMap[action.type](prevState, action);\n      if (!nextState)\n        console.error(`Invalid state produced by createReducer for ${action.type}: ${nextState}`);\n      return nextState;\n    }\n  }\n}\n\nexport function pushNotification (message) {\n  if (Notification.permission === 'granted') {\n    new Notification(message);\n    return true;\n  }\n  return false;\n}\n","\nimport * as React from 'react';\nimport marked from 'marked';\nimport { RawHTMLString, ErrorBoundary } from '../common';\n\nconst PrismMarked = React.lazy(() => import('./markdown-prism'));\n\n// Open external links in new tabs\n// Source: https://forum.freecodecamp.org/t/links-rendered-by-marked-js-open-in-new-tab-markdown-previewer-project/197250/5\nconst renderer = {\n  link (href, title, text) {\n    const link = marked.Renderer.prototype.link.call(this, href, title, text);\n    if (href.startsWith('http')) {\n      return link.replace(\"<a\",\"<a rel='noopener' target='_blank'\");\n    } else {\n      return link;\n    }\n  }\n};\nmarked.use({ renderer });\n\nexport const MarkdownBase = ({ source, postprocess = x => x, ...props }) => {\n  try {\n    // The RawHTMLString component internally uses DOMPurify to reduce the risk of XSS\n    const RawMarkdown = React.memo(() =>\n      <RawHTMLString source={postprocess(marked(source, { gfm: true }))}\n        {...props} className={'markdown ' + (props.className ? props.className : '')}\n      />\n    );\n    if (source.match(/```\\w+/m) !== null) {\n      return (\n        <ErrorBoundary fallback={<RawMarkdown />}>\n          <React.Suspense fallback={<span>Loading...</span>}>\n            <PrismMarked source={source} postprocess={postprocess} {...props} />\n          </React.Suspense>\n        </ErrorBoundary>\n      );\n    } else {\n      return <RawMarkdown />;\n    }\n  } catch (e) {\n    return (\n      <span>\n        Sorry, an error occurred.\n        <br />\n        Try editing the note to ensure any LaTeX math equations and the Markdown syntax are valid.\n        <br />\n        Error: {e.toString()}\n      </span>\n    );\n  }\n}\n"],"sourceRoot":""}