{"version":3,"sources":["common/string.js","common/react.js","common/time.js","common/index.js","backends/indexeddb.js","backends/github.js","backends/edit-set.js","backends/index.js","ducks/kanban.js","components/popovermenu.js","components/tabview.js","store.js","components/markdown.js","components/autocomplete-editor.js","kanban/attributes/description.js","kanban/attributes/datetime.js","kanban/attributes/duration.js","kanban/attributes/index.js","components/dialogs.js","components/menubar.js","components/undoredo.js","components/loading-screen.js","kanban/column-header.js","kanban/card.js","kanban/column.js","kanban/boardview.js","kanban/index.js","zettelkasten/index.js","app.js","serviceWorker.js","index.js","components/markdown-base.js"],"names":["linkName","card","firstLine","content","split","length","substring","abbreviatedDescription","text","description","join","parseWikilinks","source","cards","m","prefix","regex","exec","index","lastIndex","parseable","match","cardID","before","name","link","after","countRegexOccurrences","str","re","parseLaTeX","string","katex","indexOf","blockRegex","inlineRegex","render","displayMode","renderToString","throwOnError","fmapRegexMatch","i","mergeRefs","refs","filteredRefs","filter","Boolean","inst","ref","current","currentLoc","window","location","hash","replace","useHashLocation","React","loc","setLoc","handler","addEventListener","removeEventListener","navigate","to","__useTitleInUse","useTitle","title","result","document","original","useInterval","f","ms","id","setInterval","clearInterval","ReloadProtect","shouldProtect","onbeforeunload","e","Hidden","children","show","style","display","RawHTMLString","purify","props","dangerouslySetInnerHTML","__html","DOMPurify","sanitize","__lastGeneratedID","generateID","date","timeString","Date","fn","newID","parseInt","prettyPrintDate","epochMilliseconds","now","time","getHours","getMinutes","getTime","diff","weekDiff","weekStartsOn","yearDiff","dayOfWeek","getDay","day","getDate","timeUrgencyClassName","remaining","objectMap","object","mapFn","Object","keys","reduce","key","shallowEqual","obj1","obj2","every","deleteInList","list","elem","splice","structuredClone","obj","oldState","history","state","replaceState","copy","isObject","item","Array","isArray","deepMerge","target","searchCards","term","limit","matches","tl","toLowerCase","includes","push","createReducer","initialState","actionMap","prevState","action","prototype","hasOwnProperty","call","type","nextState","console","error","loadState","a","initial","generateInitialState","saveState","loadLegacyLocalStorageState","loadIDBState","getAllInNamespace","namespace","whitelist","promises","chunks","get","then","Promise","all","columns","tabs","standaloneNamespaces","colID","items","localStorage","JSON","parse","kanban","loading","set","shallowNamespaces","load","commit","editSet","edit","del","value","deleteAllState","map","res","startsWith","__idb","getAll","x","__octokit","getOctokit","Octokit","auth","config","token","sha","loggedIn","gh","update","request","gist_id","files","compileEditSet","catch","updateLatestSHA","filename","getEditFilename","serializeObject","stringify","getFilename","getObjectPath","parts","specialKeys","frontmatter","serialized","deserializeObject","markdown","start","trim","forEach","leftPaddedValue","trimStart","getLatestSHA","latest","status","hasLoggedInBefore","log","synchroniseState","idb","getAllModifiedFiles","getDiffObject","EditSet","param","add","deserialize","endpoint","username","fetch","per_page","commits","data","version","getNewCommitSHAs","SHA","SHAs","page_no","page","getGistRevision","response","revision","file","path","ptr","slice","layer","logOut","confirm","reload","this","inv","old","other","j","ids","getEditID","objectDict","oldDict","arrayOfIDs","delete","hist","editSetHistory","past","shift","future","undo","allowed","pop","unshift","invert","redo","namespaceNames","ghb","local","editSetBuffer","timer","waitingOn","resolve","reject","concat","setTimeout","json","alert","unsafeSetState","createAction","overwriteState","transferCard","reorderCard","addCard","editCardContent","editCard","deleteCard","addColumn","deleteColumn","renameColumn","moveColumn","archiveCardsInColumn","sortColByTime","addTab","deleteTab","renameTab","moveTab","addZettel","editZettel","deleteZettel","toggleZettelStarred","loadZettel","createAsyncThunk","thunkAPI","rejectWithValue","selectors","getColumnsInTabs","tab","col","tabOrder","archivedCards","values","activeCards","starredZettels","cardsByTab","flatMap","loadingZettel","reducer","ps","payload","ns","ActionTypes","UNDO","REDO","epochms","srcColID","dstColID","srcIndex","dstIndex","produce","s","moved","edited","c","created","tabIdx","editAll","deleteAllByID","colIDs","editAllByID","tabID","column","concatSimple","cardIDs","namd","srcIdx","dstIdx","archived","archivedFromColID","zettel","fullZettel","sort","b","aMS","bMS","pending","fulfilled","rejected","undoBlacklist","undoableReducer","undoable","neverSkipReducer","currentState","previousHistory","anchorEl","setAnchorEl","handleClose","Menu","keepMounted","open","onClose","entries","func","MenuItem","onClick","currentTarget","TabPanel","hidden","height","setIndex","handleChange","event","newValue","Grow","flexGrow","flex","AppBar","position","backgroundColor","zIndex","Tabs","onChange","indicatorColor","textColor","Tab","label","IconButton","store","configureStore","present","dispatch","activeElement","tagName","ctrlKey","which","shiftKey","UndoActionCreators","globalSelectors","boards","localSelector","KaTeXMarkdown","fallback","setValue","autoFocus","addNote","rows","rowsMax","inputRef","useSelector","editor","TextareaEditor","strategy","context","beforeCursor","search","callback","cache","template","textcomplete","Textcomplete","dropdown","rotate","maxCount","destroy","TextField","margin","fullWidth","variant","multiline","inputProps","Edit","setCard","editingDescription","setEditingDescription","handleKeyDown","stopPropagation","InputLabel","className","ClickAwayListener","onClickAway","width","onKeyDown","undefined","marginTop","overflow","tabIndex","onDoubleClick","Indicator","icon","enAU","weekStart","setDateTime","utils","DateFnsUtils","locale","DateTimePicker","newDate","showTodayButton","format","size","marginLeft","startOfToday","duration","prettySeconds","durationStr","setDurationStr","autoFocusRef","setDuration","unprettySeconds","focus","invalid","helperText","days","Math","floor","hours","minutes","groups","pf","k","parseFloat","IndicatorBuilder","Chip","classes","AttributeHeader","Button","color","ConfirmDialog","respond","subtitle","labels","Dialog","DialogTitle","DialogContent","DialogContentText","DialogActions","PromptDialog","inputType","placeholder","buttons","done","CardEditDialog","useDispatch","currentColID","sel","setColID","newCard","setContent","maxWidth","disableBackdropClick","Select","labelId","ListSubheader","duck","AboutDialog","href","GitHubLoginDialog","setToken","gistID","setGistID","setUsername","autoComplete","active","setActive","useState","aboutOpen","setAboutOpen","GHOpen","setGHOpen","menuItems","prompt","Fragment","top","bottom","Toolbar","minHeight","val","TabIndicatorProps","verticalAlign","edge","postLogIn","ActionCreators","menu","confirmOpen","setConfirmOpen","promptOpen","setPromptOpen","dateTimeAttributeUsed","setEditingCard","draggableId","provided","snapshot","innerRef","draggableProps","dragHandleProps","isDragging","editingNew","setEditingNew","editingValue","setEditingValue","addButton","scrollContainerRef","scrollTop","menuButton","internals","droppableId","ignoreContainerClipping","isDraggingOver","cancel","EditingCard","cb","ButtonGroup","AddColumn","hide","tabInfo","tabObj","editingCard","tabIDfromCardID","onDragEnd","destination","direction","draggingFromThisWith","currentTab","setCurrentTab","num","addPromptOpen","setAddPromptOpen","renamePromptOpen","setRenamePromptOpen","max","currentCardID","ZettelLoadingView","ZettelFailedLoadingView","ZettelView","starred","setNewCard","part","editing","setEditing","yes","starZettel","baseTabNames","ComponentsContainer","Root","tabURLs","setTabURLs","setLoading","currentlyLoading","setTabURL","newURL","move","newTabURLs","n","getScreen","hostname","ReactDOM","getElementById","navigator","serviceWorker","ready","registration","unregister","message","PrismMarked","MarkdownBase","postprocess","marked","gfm","toString"],"mappings":"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","file":"static/js/main.17dc57c2.chunk.js","sourcesContent":["\nexport const linkName = card => {\n  if (!card) return 'unknown';\n  const firstLine = card.content.split('\\n')[0];\n  if (firstLine.length > 40) return firstLine.substring(0,37) + '...';\n  return firstLine;\n};\n\nexport const abbreviatedDescription = card => {\n  if (!card) return '';\n  // If it's a string, use it. If it's a card, use description with fallback on title. Otherwise, unknown.\n  const text = card ? (typeof card === 'string' ? card : (card.description || card.content)) : 'unknown';\n  const limit = 500; // crop after this with ellisis\n  const title = text.split(\"\\n\\n\").join(\"\\n\").substring(0, limit)\n    + (text.length > limit ? \"...\" : \"\");\n  return title;\n};\n\nexport const parseWikilinks = (source, cards, prefix = '#/notes/') => {\n  const regex = /(\\[\\[[A-Za-z0-9_-]+\\]\\])/gm; // assumes card IDs are alphanumeric + dash + underscore\n  let m;\n  while ((m = regex.exec(source)) !== null) {\n    if (m.index === regex.lastIndex) regex.lastIndex++;\n    // m.index is the index in 'source'\n    const parseable = (source.substring(0, m.index).match(/`/gm) || []).length % 2 === 0;\n    if (!parseable) continue;\n\n    // m[1] is the actual match\n    let cardID = m[1].substring(2, m[1].length - 2);\n\n    // replace [[CARD_ID]] with [CARD_NAME](#/notes/CARD_ID)\n    let before = source.substring(0, m.index),\n        name = linkName(cards[cardID]),\n        link = prefix + cardID,\n        after = source.substring(m.index + m[1].length, source.length);\n    source = before + `[${name}](${link})` + after;\n  }\n  return source;\n};\n\n// regex must have /g flag\nconst countRegexOccurrences = (str, re) =>\n  ((str || '').match(re) || []).length;\n\n// Parse LaTeX math formulae using KaTeX\nexport const parseLaTeX = (string, katex) => {\n  if (string.indexOf(\"$$\") === -1) return string;\n\n  const blockRegex = /<p>\\$\\$([^\\n]+)\\$\\$<\\/p>/m;\n  const inlineRegex =   /\\$\\$([^\\n]+)\\$\\$/m;\n\n  const render = (str, displayMode) => katex.renderToString(str, { throwOnError: false, displayMode });\n\n  const fmapRegexMatch = (str, displayMode) => {\n    // Only replace after the previous match to avoid infinite loops\n    let lastIndex = 0;\n    let regex = displayMode ? blockRegex : inlineRegex;\n    let m = str.match(regex);\n\n    // Limit to 100 equations\n    for (let i = 0; i < 100 && lastIndex < str.length && m; i++) {\n      // Skip <code> or <pre> blocks\n      const proceed = countRegexOccurrences(str.substring(0, lastIndex + m.index), /<(code|pre)[^>]*>/g)\n                  === countRegexOccurrences(str.substring(0, lastIndex + m.index), /<\\/(code|pre)>/g);\n\n      if (proceed) {\n        str = str.substring(0, m.index + lastIndex)\n            + render(m[1], displayMode)\n            + str.substring(m.index + lastIndex + m[0].length, str.length);\n      }\n\n      lastIndex += m.index + m[0].length;\n      m = str.substring(lastIndex, str.length).match(regex);\n    }\n\n    return str;\n  };\n\n  return fmapRegexMatch(fmapRegexMatch(string, true), false);\n};\n","\nimport * as React from 'react';\nimport DOMPurify from 'dompurify';\n\n// Source: https://www.davedrinks.coffee/how-do-i-use-two-react-refs/\nexport const mergeRefs = (...refs) => {\n  const filteredRefs = refs.filter(Boolean);\n  if (!filteredRefs.length) return null;\n  if (filteredRefs.length === 0) return filteredRefs[0];\n  return inst => {\n    for (const ref of filteredRefs) {\n      if (typeof ref === 'function') {\n        ref(inst);\n      } else if (ref) {\n        ref.current = inst;\n      }\n    }\n  };\n};\n\n// Web: returns the current hash location (excluding the '#' symbol)\n// Based on https://codesandbox.io/s/wouter-hash-based-hook-5fp9g\nconst currentLoc = () => window.location.hash.replace(\"#\", \"\") || \"/\";\nexport const useHashLocation = () => {\n  const [loc, setLoc] = React.useState(currentLoc());\n  React.useEffect(() => {\n    const handler = () => setLoc(currentLoc());\n    window.addEventListener(\"hashchange\", handler);\n    return () => window.removeEventListener(\"hashchange\", handler);\n  }, []);\n  const navigate = React.useCallback(to => window.location.hash = to, []);\n  // const navigateNoHistory = React.useCallback(to => {\n  //   window.history.replaceState(undefined, undefined, \"#\"+to);\n  //   setLoc(to); // because handler does not detect replaceState\n  // }, []);\n  // Disable no history navigation as it breaks currentLoc\n  return [loc, navigate, navigate/*NoHistory*/];\n};\n\n// You can supply a title, a function that produces a title each render, or null\n// In every case the title is reset to its original value afterwards\nlet __useTitleInUse = 0;\nexport const useTitle = title => {\n  if (typeof title === \"function\") {\n    const result = title();\n    if (result)\n      document.title = result;\n  }\n  React.useEffect(() => {\n    const original = document.title;\n    __useTitleInUse++;\n    if (typeof title === \"string\")\n      document.title = title;\n    return () => !(__useTitleInUse--) && (document.title = original);\n  });\n}\n\nexport const useInterval = (f, ms) => {\n  React.useEffect(() => {\n    const id = setInterval(f, ms);\n    return () => clearInterval(id);\n  }, [f, ms]);\n}\n\n// Note: ReloadProtect does not prevent hash changes. Be warned!\nexport const ReloadProtect = ({ shouldProtect = true }) => {\n  React.useEffect(() => {\n    // componentDidMount\n    if (shouldProtect)\n      window.onbeforeunload = e => \"Are you sure you want to quit?\";\n    // componentWillUnmount\n    return () => window.onbeforeunload = null;\n  });\n  return null;\n}\n\nexport const Hidden = ({ children, show }) =>\n  <div style={show ? {} : { display: \"none\" }}>\n    {children}\n  </div>;\n\nexport const RawHTMLElement = ({ source, ...props }) => {\n  const ref = React.useRef(null);\n  React.useEffect(() => {\n    ref.current.appendChild(source);\n  });\n  return <span ref={ref} {...props} />\n}\n\n// DOMPurify reduces XSS risk\nexport const RawHTMLString = ({ source, purify = true, ...props }) =>\n  <span dangerouslySetInnerHTML={{ __html: purify ? DOMPurify.sanitize(source) : source }} {...props} />;\n","\nimport * as fn from 'date-fns';\n\nexport const simpleDate = date => fn.format(date, \"yyyyMMdd-hhmmss\");\n\nlet __lastGeneratedID = null;\nexport const generateID = () => {\n  const timeString = simpleDate(new Date());\n  let newID = timeString;\n  // if we generate multiple IDs in one second, we add \"-n\" where n is 1,2,...\n  // the only time this causes collisions is if you add a card, refresh, add a card within 1s\n  if (__lastGeneratedID !== null && __lastGeneratedID.substring(0, timeString.length) === newID) {\n    if (__lastGeneratedID.length === timeString.length) newID += \"-1\";\n    else newID += '-' + (parseInt(__lastGeneratedID.substring(timeString.length + 1, __lastGeneratedID.length)) + 1)\n  }\n  __lastGeneratedID = newID;\n  return newID;\n}\n\n/**\n * Returns a heavily abbreviated pretty printed date using date-fns\n * - Only includes time if within a week and not midnight\n * - Only includes minutes if nonzero\n * - Replaces date with \"Tomorrow\", \"Next Fri\" or \"Last Wed\", etc.\n */\nexport const prettyPrintDate = epochMilliseconds => {\n  const date = new Date(epochMilliseconds);\n  const now = new Date();\n\n  const getDate = date => {\n    const diff = fn.differenceInCalendarDays(date, now);\n    const weekDiff = fn.differenceInCalendarWeeks(date, now, { weekStartsOn: 1 });\n    const yearDiff = fn.differenceInCalendarYears(date, now);\n    // 0 is Monday\n    let dayOfWeek = now.getDay() - 1;\n    // JavaScript's modulo is broken for negatives, so we must use an if statement\n    if (dayOfWeek < 0) dayOfWeek += 7;\n\n    // Relative dates are quite ambiguous in English\n    // If today is Wednesday 23 September 2020, then the following mappings are adhered to:\n\n    // 15/9/19: Sun 15 Sep 2019\n    // 15/9/20: Tue 15 Sep\n    // 16/9/20: Last Wed\n    // 21/9/20: Last Mon\n    // 22/9/20: Yesterday\n    // 23/9/20: Today\n    // 24/9/20: Tomorrow\n    // 25/9/20: Fri\n    // 27/9/20: Sun\n    // 28/9/20: Next Mon\n    // 7/10/20: Wed Week\n\n    if (diff ===  0) return \"Today\";\n    if (diff === -1) return \"Yesterday\";\n    if (diff ===  1) return \"Tomorrow\";\n\n    const day = fn.format(date, \"EEE\"); // eg Mon, Thu\n\n    // If it's this calendar week,\n    // or during the weekend it is a weekday the next week\n    if ((weekDiff === 0 && diff >= 0)\n     || (dayOfWeek >= 5 && diff >= 0 && diff < 5)) return day;\n\n    if (diff >= -7 && diff <   0) return `Last ${day}`;\n    if (diff >   0 && diff <=  7) return `Next ${day}`;\n    if (diff >   7 && diff <= 14) return `${day} Week`;\n\n    if (yearDiff === 0)\n      return fn.format(date, \"EEE do MMM\"); // eg: Thu 17th Sep\n    else\n      return fn.format(date, \"EEE do MMM yyyy\"); // eg: Fri 17th Sep 2021 if it's not 2021\n  }\n\n  const getTime = date => {\n    // ignore time if midnight\n    if (date.getHours() === 0 && date.getMinutes() === 0) return null;\n    // No minutes; eg 4PM\n    if (date.getMinutes() === 0) return fn.format(date, \"haaa\");\n    return fn.format(date, \"h:mmaaa\");\n  }\n\n  const time = getTime(date);\n  return getDate(date) + (time ? \" \" + time : \"\");\n};\n\nexport const timeUrgencyClassName = ms => {\n  const remaining = (ms - new Date().getTime()) / 1000;\n  if (remaining < 0) return 'urgency-overdue';\n  if (remaining < 7200) return 'urgency-two-hours';\n  if (remaining < 86400) return 'urgency-day';\n  if (remaining < 86400*7) return 'urgency-week';\n  if (remaining < 86400*7*2) return 'urgency-fortnight';\n  return null;\n}\n","\nexport { linkName, abbreviatedDescription, parseWikilinks, parseLaTeX } from './string';\nexport { mergeRefs, useHashLocation, useTitle, useInterval, ReloadProtect, Hidden, RawHTMLElement, RawHTMLString } from './react';\nexport { prettyPrintDate, generateID, timeUrgencyClassName } from './time';\n\n// Source: https://stackoverflow.com/a/14810722/4642943\n// returns a new object with the values at each key mapped using mapFn(value)\nexport const objectMap = (object, mapFn) =>\n  Object.keys(object).reduce(function(result, key) {\n    result[key] = mapFn(object[key])\n    return result\n  }, {});\n\n// Source: https://stackoverflow.com/a/52323412/4642943\nexport const shallowEqual = (obj1, obj2) =>\n  Object.keys(obj1).length === Object.keys(obj2).length &&\n  Object.keys(obj1).every(key => obj1[key] === obj2[key]);\n\nexport const deleteInList = (list, elem) => {\n  let index = list.indexOf(elem);\n  if (index !== -1) list.splice(index, 1); // undesired behaviour when splicing at (-1, 1)\n  return index !== -1;\n};\n\n// Deep copy synchronously via structured clone algorithm\n// Source: https://twitter.com/DasSurma/status/955484341358022657\nexport const structuredClone = obj => {\n  const oldState = window.history.state;\n  window.history.replaceState(obj, window.title);\n  const copy = window.history.state;\n  window.history.replaceState(oldState, window.title);\n  return copy;\n};\n\n// Deep merge two objects\nexport const isObject = item => item && typeof item === 'object' && !Array.isArray(item);\nexport function deepMerge (target, source) {\n  if (isObject(target) && isObject(source))\n    for (const key in source)\n      if (isObject(source[key]) && isObject(target[key]))\n        deepMerge(target[key], source[key]);\n      else\n        target[key] = source[key];\n  return target;\n}\n\n// Web: Download content as filename with specificed MIME type\nexport const downloadData = (content, filename, type) => {\n  if(!type) type = 'application/octet-stream';\n  const a = document.createElement('a');\n  const blob = new Blob([content], { type });\n  a.href = window.URL.createObjectURL(blob);\n  a.download = filename;\n  a.click();\n}\n\n// Simple card search; searches titles then descriptions then IDs for case insensitive exact matches\nexport const searchCards = (term, cards, limit=10) => {\n  let matches = [];\n  let tl = term.toLowerCase();\n  for (const cardID in cards) {\n    if (cards[cardID].content.toLowerCase().includes(tl)) {\n      matches.push(cardID);\n      if (matches.length === limit) return matches;\n    }\n  }\n  for (const cardID in cards) {\n    if (cards[cardID].description && cards[cardID].description.toLowerCase().includes(tl)) {\n      matches.push(cardID);\n      if (matches.length === limit) return matches;\n    }\n  }\n  for (const cardID in cards) {\n    if (cardID.toLowerCase().includes(tl)) {\n      matches.push(cardID);\n      if (matches.length === limit) return matches;\n    }\n  }\n  return matches;\n}\n\n// @reduxjs/toolkit's createReducer uses Immer internally which is great\n// until you need to access the mutated piece of state directly to send it\n// to the backend, when Immer only supplies a Proxy instead of an Object\n// This variant has opt-in Immer support (you can call produce if desired)\nexport function createReducer (initialState, actionMap) {\n  return (prevState = initialState, action) => {\n    if (Object.prototype.hasOwnProperty.call(actionMap, action.type)) {\n      const nextState = actionMap[action.type](prevState, action);\n      if (!nextState)\n        console.error(`Invalid state produced by createReducer for ${action.type}: ${nextState}`);\n      return nextState;\n    }\n  }\n}\n","\n/**\n * IndexedDB backend for offline use and caching (98% browser support via caniuse)\n *\n * Cards, columns and tabs are stored individually indexed with \"mirror.namespace.id\"\n * eg you could get card ID 12345 via get(\"mirror.cards.12345\").then(card => doStuff())\n */\n\n// IndexedDB wrapper with a simple async key-value storage API\nimport { get, set, keys, del } from 'idb-keyval';\nimport { generateInitialState, standaloneNamespaces, shallowNamespaces } from './index';\n\nexport async function loadState () {\n  const initial = async () => {\n    const state = await generateInitialState();\n    await saveState(state);\n    return state;\n  };\n  const idbKeys = await keys();\n  if (!idbKeys.length) {\n    const state = loadLegacyLocalStorageState();\n    if (state) {\n      await saveState(state);\n      return state;\n    }\n    return await initial();\n  }\n  try {\n    return await loadIDBState();\n  } catch (e) {\n    console.error(e);\n    return await initial();\n  }\n}\n\nconst getAllInNamespace = async (state, namespace, whitelist = null) => {\n  let promises = [];\n  for (let key of await keys()) {\n    let chunks = key.split('.');\n    if (chunks[1] === namespace) {\n      let id = chunks[2];\n      if (whitelist && whitelist.indexOf(id) === -1) continue;\n      promises.push(\n        get(key).then(key => state[namespace][id] = key)\n      );\n    }\n  }\n  await Promise.all(promises);\n  return state;\n}\n\nasync function loadIDBState () {\n  const state = {\n    cards: {},\n    columns: {},\n    tabs: {},\n  };\n  for (let key of standaloneNamespaces) {\n    state[key] = await get(`mirror.${key}`) || [];\n  }\n  let promises = [\n    getAllInNamespace(state, 'tabs'),\n    getAllInNamespace(state, 'columns').then(() => {\n      // Only load cards in the Kanban boards and the main Zettelkasten note\n      let whitelist = ['main'];\n      for (let colID in state.columns) {\n        whitelist.push(...state.columns[colID].items);\n      }\n      return getAllInNamespace(state, 'cards', whitelist);\n    })\n  ];\n  await Promise.all(promises);\n  return state;\n}\n\nfunction loadLegacyLocalStorageState () {\n  try {\n    if (Object.prototype.hasOwnProperty.call(localStorage, 'kanban')) {\n      const result = JSON.parse(localStorage.kanban);\n      delete localStorage.kanban;\n      return result;\n    }\n  } catch (e) {\n    console.error(e);\n    return null;\n  }\n}\n\nexport async function saveState (state) {\n  try {\n    if (!state || state.loading) return;\n    await set('mirror.starredZettels', []);\n    for (let key of standaloneNamespaces) {\n      await set(`mirror.${key}`, state[key]);\n    }\n    let promises = [];\n    for (let namespace of shallowNamespaces) {\n      for (let id in state[namespace]) {\n        promises.push(\n          set(`mirror.${namespace}.${id}`, state[namespace][id])\n        );\n      }\n    }\n    return await Promise.all(promises);\n  } catch (e) {\n    console.error(e);\n  }\n}\n\nexport async function load (namespace, id = null) {\n  try {\n    if (!id) { // eg tabOrder\n      return await get('mirror.'+namespace);\n    } else { // eg cards\n      return await get('mirror.'+namespace+'.'+id);\n    }\n  } catch (e) {\n    return null;\n  }\n}\n\nexport async function commit (editSet) {\n  const promises = [];\n  for (let edit of editSet.set) {\n    switch (edit.type) {\n      case 'add':\n      case 'edit':\n        promises.push(set(`mirror.${edit.namespace}.${edit.object.id}`, edit.object));\n        break;\n      case 'delete':\n        promises.push(del(`mirror.${edit.namespace}.${edit.id}`));\n        break;\n      case 'param':\n        promises.push(set(`mirror.${edit.namespace}`, edit.value));\n        break;\n      default:\n    }\n  }\n  return await Promise.all(promises);\n}\n\n// For manual intervention of corrupted state\nwindow.deleteAllState = async () => {\n  let res = await Promise.all((await keys()).map(key => del(key)));\n  for (let i = localStorage.length - 1; i >= 0; i--) {\n    const key = localStorage.key(i);\n    if (key.startsWith('__GITHUB')) {\n      delete localStorage[key];\n    }\n  }\n  return res;\n};\n\nwindow.__idb = { get, set, keys, del };\nwindow.__idb.getAll = async () => Promise.all(\n  (await window.__idb.keys()).map(async x => [x, await window.__idb.get(x)])\n);\n","\n/**\n * GitHub Gist backend for synchronisation between clients\n *\n * Any discrepancies in the exported functions are due to API\n * limitations\n */\n\nimport { standaloneNamespaces, shallowNamespaces, EditSet } from './';\nimport * as idb from './indexeddb';\n\n// GitHub API client dynamic import (memoised)\nlet __octokit = null;\nconst __getOctokit = () => import(\"@octokit/core\").then(({ Octokit }) =>\n  new Octokit({\n    auth: config.token,\n  })\n);\nconst getOctokit = async () => {\n  if (__octokit) return __octokit;\n  return __octokit = await __getOctokit();\n}\n\nexport const config = {\n  sha: {\n    get latest() { return localStorage['__GITHUB_GIST_LATEST_SHA']; },\n    set latest(x) { localStorage['__GITHUB_GIST_LATEST_SHA'] = x; },\n    get current() { return localStorage['__GITHUB_GIST_CURRENT_SHA']; },\n    set current(x) { localStorage['__GITHUB_GIST_CURRENT_SHA'] = x; },\n  },\n  // This is fairly insecure, especially given there are possible XSS vulnerabilities\n  // See https://stackoverflow.com/a/58467408/4642943 for alternatives\n  // once security becomes a bigger concern.\n  get token() { return localStorage['__GITHUB_TOKEN']; },\n  set token(x) { localStorage['__GITHUB_TOKEN'] = x; },\n  get username() { return localStorage['__GITHUB_USERNAME']; },\n  set username(x) { localStorage['__GITHUB_USERNAME'] = x; },\n  get gist_id() { return localStorage['__GITHUB_GIST_ID']; },\n  set gist_id(x) { localStorage['__GITHUB_GIST_ID'] = x; },\n};\n\nexport function loggedIn () {\n  return Boolean(config.token);\n}\n\nexport async function commit (editSet) {\n  if (editSet.set.length === 0) return [];\n  // If this fails it is due to authentication failure\n  // TODO: handle this case in a user-friendly way\n  const gh = await getOctokit();\n  const update = set =>\n    gh.request('PATCH /gists/{gist_id}', {\n      gist_id: config.gist_id,\n      description: \"Mirror synchronisation (https://oliverbalfour.github.io/Mirror/)\",\n      files: compileEditSet(set)\n    })\n  // If one of the actions failed, the whole request fails\n  // To minimise collateral damage we repeat each action individually\n  await update(editSet).catch(async e => {\n    console.error(e);\n    return await Promise.all(\n      editSet.set.map(edit => update({ set: [edit] }))\n    ).catch(console.error)\n  });\n  await updateLatestSHA();\n}\n\nfunction compileEditSet (editSet) {\n  // Produces the file modifications object\n  // https://developer.github.com/v3/gists/#update-a-gist\n  const files = {};\n  for (let edit of editSet.set) {\n    const filename = getEditFilename(edit);\n    switch (edit.type) {\n      case 'delete':\n        files[filename] = null;\n        break;\n      case 'add':\n      case 'edit':\n      {\n        const content = serializeObject(edit.object);\n        files[filename] = { filename, content };\n        break;\n      }\n      case 'param':\n        files[filename] = { filename, content: JSON.stringify(edit.value) }\n        break;\n      default:\n    }\n  }\n  return files;\n}\n\nfunction getEditFilename (edit) {\n  return getFilename(edit.namespace, edit.object ? edit.object.id : null);\n}\nfunction getFilename (namespace, id = null) {\n  if (namespace === 'cards')\n    return `${id}.md`;\n  else if (id)\n    return `${namespace}.${id}.md`;\n  else\n    return `${namespace}.md`;\n}\n\nfunction getObjectPath (filename) {\n  const parts = filename.split('.');\n  if (parts.length === 2) {\n    if (standaloneNamespaces.indexOf(parts[0]) === -1) {\n      return ['cards', parts[0]];\n    } else {\n      return [parts[0]];\n    }\n  } else {\n    return [parts[0], parts[1]];\n  }\n}\n\nfunction serializeObject (object) {\n  // Cards are serialized to markdown with YAML frontmatter\n  // where the values are JSON serialized\n  // Columns and tabs contain just the frontmatter component\n  const specialKeys = ['description'];\n  let frontmatter = [];\n  for (let key in object) {\n    if (specialKeys.indexOf(key) === -1) {\n      const value = key === 'time' ? new Date(object[key]).getTime() : JSON.stringify(object[key]);\n      frontmatter.push(`${key}: ${value}`);\n    }\n  }\n  let serialized = `---\\n${frontmatter.join('\\n')}\\n---\\n`;\n  if (object.description) serialized += object.description;\n  return serialized;\n}\n\nfunction deserializeObject (markdown) {\n  const object = {};\n  const [start , frontmatter, description] = markdown.split('---');\n  if (!frontmatter) return JSON.parse(start);\n  frontmatter.split('\\n').filter(str => str.trim().length).forEach(str => {\n    const [key, ...leftPaddedValues] = str.split(':');\n    const leftPaddedValue = leftPaddedValues.join(':');\n    // Need to be careful with these objects; if someone edits a GitHub Gist\n    // file to include \"hasOwnProperty: 0\" it could cause a crash\n    object[key] = JSON.parse(leftPaddedValue.trimStart());\n  });\n  if (description.trim().length)\n    object.description = description.trim();\n  return object;\n}\n\n// Call when first logged in\n// This will update the IndexedDB cache/GitHub Gist\n// and return a state object asynchronously\nexport async function postLogIn () {\n  // If there is a file called `__logged_in` then the gist has been used\n  // on another computer and so the remote state is used to patch local state.\n  // If the file does not exist, we patch the remote state with the local.\n  // Patch meaning write one state over another without deleting existing state,\n  // that is not overwritten.\n\n    // SHA must be set prior to calling `get`\n  config.sha.latest = await getLatestSHA();\n  const hasLoggedInBefore = (await get('__logged_in', false)).status !== 404;\n\n  console.log('Logging in. Has ' + (hasLoggedInBefore ? '' : 'not ') + 'logged in before.');\n\n  let state = {};\n  if (hasLoggedInBefore) {\n    state = await synchroniseState();\n    console.log('Finished loading and caching remote state.');\n  } else {\n    await set('__logged_in', 'true');\n    await saveState(await idb.loadState());\n    console.log('Finished writing local state to remote.');\n  }\n  return state;\n}\n\n// Call on app initialisation and periodically thereafter\nexport const synchroniseState = async () => {\n  config.sha.latest = await getLatestSHA();\n  if (config.sha.latest === config.sha.current) {\n    console.log('No state updates required');\n    return {};\n  }\n  const files = await getAllModifiedFiles();\n  const diff = getDiffObject(files);\n  await idb.saveState(diff);\n  console.log(`Updated local state: ${(config.sha.current || 'none').substring(0, 10)}..${config.sha.latest.substring(0, 10)}`);\n  config.sha.current = config.sha.latest;\n  return diff;\n}\n\n// Save initial state, or save state after logging in\nexport const saveState = async state => {\n  const set = new EditSet();\n  for (let namespace of standaloneNamespaces) {\n    set.param(namespace, state[namespace], null);\n  }\n  for (let namespace of shallowNamespaces) {\n    for (let id in state[namespace]) {\n      set.add(namespace, state[namespace][id]);\n    }\n  }\n  // commit(set) rather than set.commit() as we don't want to\n  // touch the undo stack\n  commit(set);\n};\n\nasync function get (filename, deserialize = true) {\n  // There is an undocumented endpoint for accessing raw files here:\n  // https://gist.githubusercontent.com/:user/:id/raw/:sha/:filename\n  const endpoint = \"https://gist.githubusercontent.com/\"\n  + `${config.username}/${config.gist_id}/raw/${config.sha.latest}/${filename}`;\n  const res = await fetch(endpoint);\n  if (deserialize)\n    return deserializeObject(res.text());\n  else\n    return res;\n}\n\n// Warning: this will change the remote latest commit SHA\n// but not update it locally. Call updateLatestSHA if needed.\nasync function set (filename, content) {\n  const files = { [filename]: { filename, content } };\n  const gh = await getOctokit();\n  await gh.request('PATCH /gists/{gist_id}', {\n    gist_id: config.gist_id,\n    files\n  })\n}\n\nexport async function load (namespace, id = null) {\n  try {\n    return await get(getFilename(namespace, id));\n  } catch (e) {\n    return null;\n  }\n}\n\nexport async function getLatestSHA () {\n  const gh = await getOctokit();\n  const commits = await gh.request('GET /gists/{gist_id}/commits', {\n    gist_id: config.gist_id,\n    per_page: 1,\n  });\n  return commits.data[0].version;\n}\n\nasync function updateLatestSHA () {\n  // Sets the latest and current SHAs to the latest SHA on the remote\n  // Use with caution; only for internal use\n  config.sha.current = config.sha.latest = await getLatestSHA();\n}\n\n// Returns a list of commits in order of newest to oldest since the last known commit\nexport async function getNewCommitSHAs () {\n  const gh = await getOctokit();\n  const SHA = config.sha.current;\n  const SHAs = [];\n  let page_no = 1;\n  while (page_no < 100) {\n    const commits = (await gh.request('GET /gists/{gist_id}/commits', {\n      gist_id: config.gist_id,\n      per_page: 100,\n      page: page_no,\n    })).data;\n    if (commits.length === 0) break;\n    for (let commit of commits) {\n      const { version } = commit;\n      if (SHA === version) break;\n      SHAs.push(version);\n    }\n    page_no++;\n  }\n  return SHAs;\n}\n\nasync function getGistRevision (sha) {\n  // https://api.github.com/gists/:id/:sha has a files field\n  const gh = await getOctokit();\n  const response = await gh.request('GET /gists/{gist_id}/{sha}', {\n    gist_id: config.gist_id,\n    sha\n  });\n  // Returns a dict where filenames are the keys, and the values are objects\n  // with a \"content\" field\n  return response.data.files;\n}\n\n// Returns a dict with key = filename, value = contents\n// Assumes no truncation, does not handle errors\nasync function getAllModifiedFiles () {\n  const SHAs = await getNewCommitSHAs();\n  const files = {};\n  let i = SHAs.length;\n  while (i --> 0) {\n    const revision = await getGistRevision(SHAs[i]);\n    for (let file in revision) {\n      if (file === '__logged_in') continue;\n      files[file] = revision[file].content;\n    }\n  }\n  return files;\n}\n\nfunction getDiffObject (files) {\n  const diff = {};\n  for (let filename in files) {\n    const object = deserializeObject(files[filename]);\n    // The object may be stored in a deep hierarchy\n    const path = getObjectPath(filename);\n    let ptr = diff;\n    for (let layer of path.slice(0, -1)) {\n      ptr[layer] = ptr[layer] || {};\n      ptr = ptr[layer];\n    }\n    ptr[path[path.length - 1]] = object;\n  }\n  return diff;\n}\n\nexport function logOut () {\n  const confirmed = window.confirm('Are you sure you want to log out? All your state will be saved locally and on GitHub, but it will no longer synchronise.');\n  if (!confirmed) return;\n  for (let i = localStorage.length - 1; i >= 0; i--) {\n    const key = localStorage.key(i);\n    if (key.startsWith('__GITHUB')) {\n      delete localStorage[key];\n    }\n  }\n  window.location.reload();\n}\n","\nimport { shallowEqual } from '../common';\n\nexport default class EditSet {\n  constructor () {\n    this.set = [];\n    this.inv = [];\n  }\n  add (namespace, object) {\n    this.set.push({ type: 'add', namespace, object });\n    this.inv.push({ type: 'delete', namespace, id: object.id });\n    return this;\n  }\n  edit (namespace, object, old) {\n    this.set.push({ type: 'edit', namespace, object });\n    this.inv.push({ type: 'edit', namespace, object: old });\n    return this;\n  }\n  delete (namespace, id, old) {\n    this.set.push({ type: 'delete', namespace, id });\n    this.inv.push({ type: 'add', namespace, object: old });\n    return this;\n  }\n  param (namespace, value, old) {\n    // Params are always present, this updates a param\n    this.set.push({ type: 'param', namespace, value });\n    this.inv.push({ type: 'param', namespace, value: old });\n    return this;\n  }\n  concat (other) {\n    // Cancel out inverse operations (remove both operations)\n    for (let i = other.inv.length - 1; i >= 0; i--) {\n      for (let j = this.set.length - 1; j >= 0; j--) {\n        if (shallowEqual(other.inv[i], this.set[j])) {\n          other.inv.splice(i, 1);\n          other.set.splice(i, 1);\n          this.inv.splice(j, 1);\n          this.set.splice(j, 1);\n        }\n      }\n    }\n    // Combine the sets\n    this.set.push(...other.set);\n    this.inv.push(...other.inv);\n    // Prune duplicates (later edits should override earlier ones)\n    const ids = [];\n    for (let i = this.set.length - 1; i >= 0; i--) {\n      const id = getEditID(this.set[i]);\n      if (ids.indexOf(id) !== -1) {\n        this.set.splice(i, 1);\n      } else {\n        ids.push(id);\n      }\n    }\n    return this;\n  }\n  concatSimple (other) {\n    this.set.push(...other.set);\n    this.inv.push(...other.inv);\n    return this;\n  }\n  editAll (namespace, objectDict, oldDict) {\n    for (let id in objectDict) {\n      this.edit(namespace, objectDict[id], oldDict[id]);\n    }\n    return this;\n  }\n  editAllByID (namespace, objectDict, arrayOfIDs, oldDict) {\n    for (let id of arrayOfIDs) {\n      this.edit(namespace, objectDict[id], oldDict[id]);\n    }\n    return this;\n  }\n  deleteAllByID (namespace, arrayOfIDs, oldDict) {\n    for (let id of arrayOfIDs) {\n      this.delete(namespace, id, oldDict[id]);\n    }\n    return this;\n  }\n  invert () {\n    const other = new EditSet();\n    other.set = this.inv;\n    other.inv = this.set;\n    return other;\n  }\n}\n\nconst getEditID = edit => {\n  switch (edit.type) {\n    case 'add':\n    case 'edit':\n      return edit.object.id;\n    case 'delete':\n      return edit.id;\n    case 'param':\n      return edit.namespace;\n    default:\n  }\n}\n","\nimport * as ghb from './github';\nimport * as idb from './indexeddb';\n\nimport EditSet from './edit-set';\nexport const UNDO_LIMIT = 20;\nEditSet.prototype.commit = function () {\n  commit(this);\n  hist.editSetHistory.past.push(this);\n  if (hist.editSetHistory.past.length > UNDO_LIMIT)\n    hist.editSetHistory.past.shift();\n  // Clear the future for any state mutating actions\n  hist.editSetHistory.future = [];\n}\nconst hist = {\n  editSetHistory: {\n    past: [],    // [oldest edit,  ..., 1 edit ago]\n    future: [],  // [1 edit ahead, ..., n edits ahead]\n  },\n  undo: {\n    allowed: () => hist.editSetHistory.past.length > 0,\n    commit: () => {\n      const set = hist.editSetHistory.past.pop();\n      hist.editSetHistory.future.unshift(set);\n      if (hist.editSetHistory.future.length > UNDO_LIMIT)\n        hist.editSetHistory.future.pop();\n      commit(set.invert());\n    },\n  },\n  redo: {\n    allowed: () => hist.editSetHistory.future.length > 0,\n    commit: () => {\n      const set = hist.editSetHistory.future.shift();\n      hist.editSetHistory.past.push(set);\n      if (hist.editSetHistory.past.length > UNDO_LIMIT)\n        hist.editSetHistory.past.shift();\n      commit(set);\n    }\n  }\n}\nexport { EditSet, hist };\n\nexport const namespaceNames = {\n  cards: 'cards',\n  columns: 'columns',\n  tabs: 'tabs',\n  tabOrder: 'tabOrder',\n  starredZettels: 'starredZettels',\n}\n\n// Namespaces that are not objects but not necessarily primitives\nexport const standaloneNamespaces = [\n  'tabOrder',\n  'starredZettels',\n];\n\n// Namespaces that are dictionaries of depth one\nexport const shallowNamespaces = [\n  'cards',\n  'columns',\n  'tabs',\n];\n\nexport async function loadState () {\n  // Return only the IndexedDB state\n  // And load any new mutations to this state in the background\n  // TODO: load state async and have loading status indicator rather than blocking\n  // this needs to update IndexedDB and give the user an indication of when it's done\n  let state = await idb.loadState();\n  if (ghb.loggedIn()) {\n    state = { ...state, ...await ghb.synchroniseState() };\n  }\n  return state;\n}\n\nexport async function saveState (state) {\n  return await Promise.all([idb.saveState(state), ghb.saveState(state)]);\n}\n\n// Load tabOrder: await load('tabOrder')\n// Load card: await load('cards', cardID)\nexport async function load (namespace, id = null) {\n  const local = await idb.load(namespace, id);\n  if (local) return local;\n  return ghb.load(namespace, id);\n}\n\n// To avoid data races, we rate limit edits to 5s intervals where extra\n// edits are concat'd onto the buffer\n// Data races could occur when quickly undoing an edit if the packets arrive in\n// the wrong order.\nlet editSetBuffer = new EditSet();\nlet timer = null;\nlet waitingOn = [];\nconst commit = editSet => new Promise((resolve, reject) => {\n  const promises = [\n    idb.commit(editSet)\n  ];\n  if (ghb.loggedIn()) {\n    if (!timer) {\n      promises.push(ghb.commit(editSet));\n      timer = setTimeout(() => {\n        ghb.commit(editSetBuffer);\n        timer = null;\n        editSetBuffer = new EditSet();\n        waitingOn.forEach(f => f());\n        waitingOn = [];\n      }, 5000);\n      Promise.all(promises).then(resolve);\n    } else {\n      editSetBuffer.concat(editSet);\n      waitingOn.push(resolve);\n    }\n  } else {\n    Promise.all(promises).then(resolve);\n  }\n});\n\nexport const generateInitialState = () =>\n  fetch(\"./initial-state.json\")\n    .then(res => res.json())\n    .catch(e => alert(\"Could not load initial state. Perhaps you forgot a trailing slash in the URL? Error: \" + e));\n","\n/**\n * Kanban boards core Redux logic\n *\n * State is normalised as { tabs, columns, cards }\n *  where each tab has several columns which contain cards\n *  each has a unique ID as a key in the respective object\n */\n\nimport { createAction, createAsyncThunk } from '@reduxjs/toolkit';\nimport undoable, { ActionTypes } from 'redux-undo';\nimport produce from 'immer';\nimport { generateID, objectMap, deleteInList, createReducer, shallowEqual,\n  structuredClone, deepMerge } from '../common';\nimport { EditSet, load, namespaceNames as c, hist, UNDO_LIMIT } from '../backends';\n\n// Action creators\n\nexport const unsafeSetState = createAction('mirror/SET_STATE');  // Used for async initial state\n// TODO: how should overwriteState be treated by undo/redo?\n// Used to overwrite local data with updates from remote\nexport const overwriteState = createAction('mirror/OVERWRITE_STATE');\n\nexport const transferCard = createAction('kanban/TRANSFER_CARD');\nexport const reorderCard = createAction('kanban/REORDER_CARD');\nexport const addCard = createAction('kanban/ADD_CARD'); // takes { content, colID }\nexport const editCardContent = createAction('kanban/EDIT_CARD_CONTENT');//takes {content, cardID}\nexport const editCard = createAction('kanban/EDIT_CARD'); // takes a card object; allows editing all of a card's params\nexport const deleteCard = createAction('kanban/DELETE_CARD');//takes cardID\n\nexport const moveCard = ([srcColID, dstColID, srcIndex, dstIndex]) =>\n  srcColID === dstColID\n    ? reorderCard({ colID: srcColID, srcIndex, dstIndex })\n    : transferCard({ srcColID, dstColID, srcIndex, dstIndex });\n\nexport const addColumn = createAction('kanban/ADD_COLUMN'); // takes { name, tabID }\nexport const deleteColumn = createAction('kanban/DELETE_COLUMN'); // takes string column ID\nexport const renameColumn = createAction('kanban/RENAME_COLUMN'); // takes { colID, name }\nexport const moveColumn = createAction('kanban/MOVE_COLUMN'); // takes [srcIdx, dstIdx, tabIdx]\nexport const archiveCardsInColumn = createAction('kanban/ARCHIVE_ALL_COLUMN'); // takes colID\nexport const sortColByTime = createAction('kanban/SORT_COLUMN_BY_CARD_TIME_ATTRIBUTE');\n\nexport const addTab = createAction('kanban/ADD_TAB'); // takes name\nexport const deleteTab = createAction('kanban/DELETE_TAB'); // takes tabIdx\nexport const renameTab = createAction('kanban/RENAME_TAB'); // takes { tabID, name }\nexport const moveTab = createAction('kanban/MOVE_TAB'); // takes [srcIdx, dstIdx]\n\nexport const addZettel = createAction('zettelkasten/ADD_ZETTEL'); // takes { zettel: {...} }\nexport const editZettel = createAction('zettelkasten/EDIT_ZETTEL'); // takes { zettel }\nexport const deleteZettel = createAction('zettelkasten/DELETE_ZETTEL'); // takes zettelID\nexport const toggleZettelStarred = createAction('zettelkasten/TOGGLE_STARRED'); // takes zettelID\n\n// createAsyncThunk a normal action creator creator you dispatch as usual with .pending,\n// .fulfilled and .rejected action types for handling by a reducer\nexport const loadZettel = createAsyncThunk(\n  'zettelkasten/LOAD_ZETTEL', async (cardID, thunkAPI) => {\n    const card = await load('cards', cardID);\n    if (!card) {\n      // Reject if the card couldn't be loaded\n      return thunkAPI.rejectWithValue(cardID);\n    } else {\n      return card;\n    }\n  }\n);\n\n// Selectors\n\nexport const selectors = {\n  // Map[TabID, Column], Column :: { id, items: List[Card] }, not List[CardID]\n  getColumnsInTabs: state =>\n    objectMap(state.tabs, tab =>\n      tab.columns.map(colID => state.columns[colID]).map(col => ({\n        ...col, items: col.items.map(card => state.cards[card])\n      }))),\n  columns: state => state.columns,\n  tabs: state => state.tabs,\n  tabOrder: state => state.tabOrder,\n  cards: state => state.cards,\n  archivedCards: state => Object.values(state.cards).filter(card => Object.keys(card).indexOf(\"archived\") !== -1),\n  activeCards:   state => Object.values(state.cards).filter(card => Object.keys(card).indexOf(\"archived\") === -1),\n  starredZettels: state => state.starredZettels ? state.starredZettels : [],\n  // gets { [tabID]: list_of_cardIDs }\n  cardsByTab: state => objectMap(state.tabs, tab =>\n    tab.columns.flatMap(colID => state.columns[colID].items)),\n  loadingZettel: state => state.loadingZettel,\n};\n\n// Reducers\n\nexport const\n  KANBAN_CARD_TYPE = 0,\n  ZETTEL_NOTE_TYPE = 1;\n\nconst loadingState = {\n  loading: true\n};\n\n// Use our version of createReducer that does not enable Immer by default\n// Note that these reducers are not pure, they commit changes to IndexedDB\n// and the GitHub Gist API. As the app cannot function without these features,\n// these side effects have to happen somewhere, and none of the features\n// impure reducers break are relevant or would work anyway, the rule of pure\n// reducers is intentionally broken.\n// Note: ps is previous state, s is draft state, ns is next state, a is action\nconst reducer = createReducer(loadingState, {\n  // Only used for updating the initial state from the loading state\n  // Makes no changes to the remote (pure functional reducer)\n  [unsafeSetState]: (ps, a) => a.payload,\n  // Update the state, for loading remote state on top of existing state\n  // This does not copy everything into memory, it only overwrites existing state keys\n  [overwriteState]: (ps, a) => {\n    if (JSON.stringify(a.payload) === \"{}\") return ps;\n    const ns = structuredClone(ps);\n    deepMerge(ns, a.payload);\n    return ns;\n  },\n  // Invert the edit sets for IndexedDB and GitHub\n  // Every other action clears the redo stack if present\n  [ActionTypes.UNDO]: (ps, a) => {\n    hist.undo.commit();\n    return ps;\n  },\n  [ActionTypes.REDO]: (ps, a) => {\n    hist.redo.commit();\n    return ps;\n  },\n  [transferCard]: (ps, a) => {\n    const epochms = new Date().getTime();\n    const { srcColID, dstColID, srcIndex, dstIndex } = a.payload;\n    if (srcColID === dstColID && srcIndex === dstIndex)\n      return ps;\n    const cardID = ps.columns[srcColID].items[srcIndex];\n    const ns = produce(ps, s => {\n      s.columns[srcColID].items.splice(srcIndex, 1);\n      s.cards[cardID].moved = epochms;\n      s.columns[srcColID].edited = epochms;\n      s.columns[dstColID].edited = epochms;\n      s.columns[dstColID].items.splice(dstIndex, 0, cardID);\n    });\n    new EditSet()\n      .edit(c.cards, ns.cards[cardID], ps.cards[cardID])\n      .edit(c.columns, ns.columns[srcColID], ps.columns[srcColID])\n      .edit(c.columns, ns.columns[dstColID], ps.columns[dstColID])\n      .commit();\n    return ns;\n  },\n  [reorderCard]: (ps, a) => {\n    const { colID, srcIndex, dstIndex } = a.payload;\n    if (srcIndex === dstIndex)\n      return ps;\n    const epochms = new Date().getTime();\n    const cardID = ps.columns[colID].items[srcIndex];\n    const ns = produce(ps, s => {\n      s.columns[colID].edited = epochms;\n      s.columns[colID].items.splice(srcIndex, 1);\n      s.cards[cardID].moved = epochms;\n      s.columns[colID].items.splice(dstIndex, 0, cardID);\n    });\n    new EditSet()\n      .edit(c.columns, ns.columns[colID], ps.columns[colID])\n      .edit(c.cards, ns.cards[cardID], ps.cards[cardID])\n      .commit();\n    return ns;\n  },\n  [addCard]: (ps, a) => {\n    const { content, colID } = a.payload;\n    const id = generateID();\n    const epochms = new Date().getTime();\n    const card = { id, content, type: KANBAN_CARD_TYPE,\n      created: epochms,  edited: epochms, moved: epochms };\n    const ns = produce(ps, s => {\n      s.cards[id] = card;\n      // Add to top of column\n      s.columns[colID].items.unshift(id);\n      s.columns[colID].edited = epochms;\n    });\n    new EditSet()\n      .add(c.cards, card)\n      .edit(c.columns, ns.columns[colID], ps.columns[colID])\n      .commit();\n    return ns;\n  },\n  [deleteColumn]: (ps, a) => {\n    const colID = a.payload;\n    const ms = new Date().getTime();\n    const tabIdx = Object.values(ps.tabs).map(tab => tab.columns.indexOf(a.payload) !== -1).indexOf(true);\n    const ns = produce(ps, s => {\n      if (tabIdx >= 0) s.tabs[s.tabOrder[tabIdx]].edited = ms;\n      s.columns[colID].items.forEach(cardID => delete s.cards[cardID]);\n      Object.values(s.tabs).forEach(tab => deleteInList(tab.columns, colID));\n      delete s.columns[colID];\n    });\n    new EditSet()\n      .editAll(c.tabs, ns.tabs, ps.tabs)\n      .deleteAllByID(c.cards, ps.columns[colID].items, ps.cards)\n      .commit();\n    return ns;\n  },\n  [renameColumn]: (ps, a) => {\n    const { colID, name } = a.payload;\n    if (ps.columns[colID].name === name)\n      return ps;\n    const ns = produce(ps, s => {\n      s.columns[colID].name = name;\n      s.columns[colID].edited = new Date().getTime();\n    });\n    new EditSet()\n      .edit(c.columns, ns.columns[colID], ps.columns[colID])\n      .commit();\n    return ns;\n  },\n  [editCardContent]: (ps, a) => {\n    const { cardID, content } = a.payload;\n    if (ps.cards[cardID].content === content)\n      return ps;\n    const ns = produce(ps, s => {\n      s.cards[cardID].content = content;\n      s.cards[cardID].edited = new Date().getTime();\n    });\n    new EditSet()\n      .edit(c.cards, ns.cards[cardID], ps.cards[cardID])\n      .commit();\n    return ns;\n  },\n  [deleteCard]: (ps, a) => {\n    const cardID = a.payload;\n    const ms = new Date().getTime();\n    const colIDs = [];\n    const ns = produce(ps, s => {\n      Object.values(s.columns).forEach(col => {\n        if (deleteInList(col.items, cardID)) {\n          col.edited = ms;\n          colIDs.push(col.id);\n        }\n      });\n      delete s.cards[a.payload];\n    });\n    new EditSet()\n      .delete(c.cards, cardID, ps.cards[cardID])\n      .editAllByID(c.columns, ns.columns, colIDs, ps.columns)\n      .commit();\n    return ns;\n  },\n  [addColumn]: (ps, a) => {\n    const { tabID, name } = a.payload;\n    const id = generateID();\n    const epochms = new Date().getTime();\n    const column = { id, items: [], name, created: epochms, edited: epochms };\n    const ns = produce(ps, s => {\n      s.columns[id] = column;\n      s.tabs[tabID].columns.push(id);\n      s.tabs[tabID].edited = epochms;\n    });\n    new EditSet()\n      .add(c.columns, column)\n      .edit(c.tabs, ns.tabs[tabID], ps.tabs[tabID])\n      .commit();\n    return ns;\n  },\n  [editCard]: (ps, a) => {\n    const { card, colID: dstColID } = a.payload;\n    // Assume card is a flat struct\n    if (shallowEqual(ps.cards[card.id], card))\n      return ps;\n    const epochms = new Date().getTime();\n    const srcColID = Object.keys(ps.columns).filter(colID => ps.columns[colID].items.indexOf(card.id) !== -1)[0];\n    const ns = produce(ps, s => {\n      s.cards[card.id] = JSON.parse(JSON.stringify(a.payload.card));\n      s.cards[card.id].edited = epochms;\n      if (srcColID !== dstColID) {\n        deleteInList(s.columns[srcColID].items, card.id);\n        s.columns[dstColID].items.unshift(card.id);\n        s.columns[srcColID].edited = s.columns[dstColID].edited = epochms;\n      }\n    });\n    new EditSet()\n      .edit(c.cards, ns.cards[card.id], ps.cards[card.id])\n      .concatSimple((() => {\n        // Update columns if changed\n        const set = new EditSet();\n        if (srcColID !== dstColID) {\n          set.edit(c.columns, ns.columns[srcColID], ps.columns[srcColID]);\n          set.edit(c.columns, ns.columns[dstColID], ps.columns[dstColID]);\n        }\n        return set;\n      })())\n      .commit();\n    return ns;\n  },\n  [deleteTab]: (ps, a) => {\n    const tabIdx = a.payload;\n    const cardIDs = [];\n    const tab = ps.tabs[ps.tabOrder[tabIdx]];\n    const ns = produce(ps, s => {\n      while (tab.columns.length) {\n        const colID = tab.columns[0];\n        cardIDs.push(...s.columns[colID].items);\n        s.columns[colID].items.forEach(cardID => delete s.cards[cardID]);\n        delete s.columns[colID];\n        tab.columns.shift();\n      }\n      delete s.tabs[tab.id];\n      s.tabOrder.splice(tabIdx, 1);\n    });\n    new EditSet()\n      .deleteAllByID(c.cards, cardIDs, ps.cards)\n      .deleteAllByID(c.columns, tab.columns, ps.columns)\n      .delete(c.tabs, tab.id, tab)\n      .param(c.tabOrder, ns.tabOrder, ps.tabOrder)\n      .commit();\n    return ns;\n  },\n  [addTab]: (ps, a) => {\n    const id = generateID();\n    const name = a.payload;\n    const tab = { name, id, columns: [], created: new Date().getTime() };\n    const ns = produce(ps, s => {\n      s.tabs[id] = tab;\n      s.tabOrder.push(id);\n    });\n    new EditSet()\n      .add(c.tabs, tab)\n      .param(c.tabOrder, ns.tabOrder, ps.tabOrder)\n      .commit();\n    return ns;\n  },\n  [renameTab]: (ps, a) => {\n    const { tabID, name } = a.payload;\n    if (ps.tabs[tabID].namd === name)\n      return ps;\n    const ns = produce(ps, s => {\n      s.tabs[tabID].name = name;\n      s.tabs[tabID].edited = new Date().getTime();\n    });\n    new EditSet()\n      .edit(c.tabs, ns.tabs[tabID], ps.tabs[tabID])\n      .commit();\n    return ns;\n  },\n  [moveColumn]: (ps, a) => {\n    const [srcIdx, dstIdx, tabIdx] = a.payload;\n    if (srcIdx === dstIdx) return ps;\n    const tabID = ps.tabOrder[tabIdx];\n    const colID = ps.tabs[tabID].columns[srcIdx];\n    const ns = produce(ps, s => {\n      s.tabs[tabID].columns.splice(srcIdx, 1);\n      s.tabs[tabID].columns.splice(dstIdx, 0, colID);\n      s.tabs[tabID].edited = new Date().getTime();\n    });\n    new EditSet()\n      .edit(c.tabs, ns.tabs[tabID], ps.tabs[tabID])\n      .commit();\n    return ns;\n  },\n  [moveTab]: (ps, a) => {\n    const [srcIdx, dstIdx] = a.payload;\n    if (srcIdx === dstIdx) return ps;\n    const tabID = ps.tabOrder[srcIdx];\n    if (dstIdx < 0 || dstIdx >= ps.tabs.length) return ps;\n    const ns = produce(ps, s => {\n      s.tabOrder.splice(srcIdx, 1);\n      s.tabOrder.splice(dstIdx, 0, tabID);\n    });\n    new EditSet()\n      .param(c.tabOrder, ns.tabOrder, ps.tabOrder)\n      .commit();\n    return ns;\n  },\n  [archiveCardsInColumn]: (ps, a) => {\n    // Archived cards are stored in IndexedDB and the Gist\n    const colID = a.payload;\n    if (ps.columns[colID].items.length === 0) return ps;\n    const epochms = new Date().getTime();\n    // Detach cards from column, edit cards\n    const ns = produce(ps, s => {\n      s.columns[colID].items.forEach(cardID => {\n        let card = s.cards[cardID];\n        card.moved = card.edited = card.archived = epochms;\n        card.archivedFromColID = colID;\n      });\n      s.columns[colID].items = [];\n      s.columns[colID].edited = epochms;\n    });\n    new EditSet()\n      .editAllByID(c.cards, ns.cards, ps.columns[colID].items, ps.cards)\n      .edit(c.columns, ns.columns[colID], ps.columns[colID])\n      .commit();\n    return ns;\n  },\n  [addZettel]: (ps, a) => {\n    const { zettel } = a.payload;\n    const id = zettel.id || generateID();\n    const epochms = new Date().getTime();\n    const fullZettel = {\n      id, type: ZETTEL_NOTE_TYPE,\n      created: epochms,  edited: epochms, moved: epochms,\n      ...zettel\n    };\n    const ns = produce(ps, s => {\n      s.cards[ns] = fullZettel;\n    });\n    new EditSet()\n      .add(c.cards, fullZettel)\n      .commit();\n    return ns;\n  },\n  [editZettel]: (ps, a) => {\n    const { zettel } = a.payload;\n    if (shallowEqual(ps.cards[zettel.id], zettel)) return ps;\n    const epochms = new Date().getTime();\n    // editZettel will not add new zettels\n    if (Object.keys(ps.cards).indexOf(zettel.id) === -1) return ps;\n    const ns = produce(ps, s => {\n      s.cards[zettel.id] = zettel;\n      s.cards[zettel.id].edited = epochms;\n    });\n    new EditSet()\n      .edit(c.cards, zettel, ps.cards[zettel.id])\n      .commit();\n    return ns;\n  },\n  [deleteZettel]: (ps, a) => {\n    const cardID = a.payload;\n    const ns = produce(ps, s => {\n      deleteInList(s.starredZettels, a.payload);\n      delete s.cards[cardID];\n    });\n    new EditSet\n      .param(c.starredZettels, ns.starredZettels, ps.starredZettels)\n      .delete(c.cards, cardID, ps.cards[cardID])\n      .commit();\n    return ns;\n  },\n  [toggleZettelStarred]: (ps, a) => {\n    const cardID = a.payload;\n    const ns = produce(ps, s => {\n      if (!s.starredZettels) s.starredZettels = [];\n      if (s.starredZettels.indexOf(cardID) === -1)\n        s.starredZettels.push(cardID);\n      else\n        deleteInList(s.starredZettels, cardID);\n    });\n    new EditSet()\n      .param(c.starredZettels, ns.starredZettels, ps.starredZettels)\n      .commit();\n    return ns;\n  },\n  [sortColByTime]: (ps, a) => {\n    const colID = a.payload;\n    const ns = produce(ps, s => {\n      // This sorts by epoch millisecond time; anything without a time is at the end in the same order\n      // As a bug meant card.time is sometimes a string, we must wrap in new Date(x).getTime() instead of just x\n      s.columns[colID].items.sort(\n        (a, b) => {\n          let aMS = new Date(s.cards[b].time || null).getTime();\n          let bMS = new Date(s.cards[a].time || null).getTime();\n          if (bMS === 0 && aMS === 0) return 0;\n          if (bMS === 0) return 1;\n          if (aMS === 0) return -1;\n          return bMS - aMS;\n        });\n    });\n    new EditSet()\n      .edit(c.columns, ns.columns[colID], ps.columns[colID])\n      .commit();\n    return ns;\n  },\n  [loadZettel.pending]: (ps, a) =>\n    produce(ps, s => s.loadingZettel = true),\n  [loadZettel.fulfilled]: (ps, a) =>\n    produce(ps, s => {\n      s.cards[a.payload.id] = a.payload;\n      delete s.loadingZettel;\n    }),\n  [loadZettel.rejected]: (ps, a) =>\n    produce(ps, s => s.loadingZettel = a.payload),\n});\n// Actions which do not mutate external state and thus cannot be undone\nconst undoBlacklist = [\n  unsafeSetState.type,\n  loadZettel.pending.type,\n  loadZettel.fulfilled.type,\n  loadZettel.rejected.type,\n];\n\n// Undoable reducer\n// Note that if an identical state is produced (via ===) the action is ignored\n// The app depends on this behaviour\nconst undoableReducer = undoable(reducer, {\n  // Keep in sync with editSetBuffer max size\n  limit: UNDO_LIMIT,\n  // So we can listen to UNDO events and call commit(set.invert())\n  neverSkipReducer: true,\n  filter: (action, currentState, previousHistory) => {\n    return undoBlacklist.indexOf(action.type) === -1;\n  }\n});\n\nexport default (s, a) => {\n  if (a.type === ActionTypes.UNDO && !hist.undo.allowed())\n    return s;\n\n  if (a.type === ActionTypes.REDO && !hist.redo.allowed())\n    return s;\n\n  if (undoBlacklist.indexOf(a.type) !== -1) {\n    // Simulate undoable reducer\n    // We can't use the filter because the filter doesn't let us\n    // selectively stop undo from applying\n    return {...s, present: reducer(s.present, a)};\n  }\n\n  return undoableReducer(s, a);\n};\n","\n// Popover menu (web)\nimport * as React from 'react';\nimport { Menu, MenuItem } from '@material-ui/core';\n\n\nexport default ({ map, children }) => {\n  const [anchorEl, setAnchorEl] = React.useState(null);\n  const handleClose = () => setAnchorEl(null);\n\n  return (\n    <React.Fragment>\n      <Menu\n        anchorEl={anchorEl}\n        keepMounted\n        open={Boolean(anchorEl)}\n        onClose={handleClose}>\n        {Object.entries(map).map(([name, func]) => (\n          <MenuItem key={name}\n            onClick={() => { handleClose(); func() }}>\n            {name}\n          </MenuItem>\n        ))}\n      </Menu>\n      {React.cloneElement(children, {\n        onClick: e => setAnchorEl(e.currentTarget)\n      })}\n    </React.Fragment>\n  );\n}\n","\n/**\n * TabView component\n *\n * <TabView\n *   tabs={[\"one\", \"two\", \"three\"]}\n *   render={i => (<SomeComponent index={i} />)}\n * />\n *\n */\n\nimport * as React from 'react';\nimport { AppBar, Tabs, Tab, IconButton } from '@material-ui/core';\nimport MoreIcon from '@material-ui/icons/MoreVert';\nimport PopoverMenu from './popovermenu';\n\nconst TabPanel = ({ show, children }) => (\n  <div hidden={!show} style={{ height: 'calc(100% - 48px)' }}>\n    {show && children}\n  </div>\n);\n\nexport default ({\n  tabs, render, index, setIndex,\n  addTab, renameTab, deleteTab, moveTab\n}) => {\n  const handleChange = (event, newValue) => newValue >= 0 && newValue < tabs.length && setIndex(newValue);\n  const Grow = () => <div style={{ flexGrow: 1 }} />;\n\n  return (\n    <div style={{ flex: 1 }}>\n      <AppBar position=\"static\" style={{\n          backgroundColor: \"white\",\n          zIndex: 2, position: 'relative'\n        }}>\n        <Tabs value={index} onChange={handleChange}\n          indicatorColor=\"primary\" textColor=\"primary\">\n          {tabs.map(tab => (\n            <Tab label={tab} key={tab} />\n          ))}\n          <Grow />\n          <PopoverMenu map={{\n            \"Add tab\": () => addTab(),\n            \"Rename tab\": () => renameTab(index),\n            \"Delete tab\": () => deleteTab(index),\n            \"Move tab left\":  () => { moveTab([index, index-1]); handleChange(null, index-1) },\n            \"Move tab right\": () => { moveTab([index, index+1]); handleChange(null, index+1) },\n          }}>\n            <IconButton>\n              <MoreIcon />\n            </IconButton>\n          </PopoverMenu>\n        </Tabs>\n      </AppBar>\n      {tabs.map((tab, i) => (\n        <TabPanel show={index === i} key={tab}>\n          {index === i && render(i)}\n        </TabPanel>\n      ))}\n    </div>\n  );\n}\n","\nimport { configureStore } from '@reduxjs/toolkit';\nimport { ActionCreators as UndoActionCreators } from 'redux-undo';\nimport * as kanban from './ducks/kanban';\nimport { objectMap } from './common';\nimport { loadState } from './backends';\n\nconst store = configureStore({\n  // DEBUG:\n  // reducer: (s, a) => { console.log(a); kanban.default(s, a) },\n  reducer: kanban.default,\n});\n\nloadState().then(state => {\n  store.dispatch(kanban.unsafeSetState(state));\n});\n\n// Undo/redo keyboard shortcuts if supported\ntry {\n  document.addEventListener('keyup', e => {\n    const ignored = ['input', 'textarea'];\n    if (ignored.indexOf(document.activeElement.tagName.toLowerCase()) !== -1) return;\n    if (e.ctrlKey && e.which === 90 && !e.shiftKey)\n      store.dispatch(UndoActionCreators.undo());\n    else if ((e.ctrlKey && e.shiftKey && e.which === 90) || (e.ctrlKey && e.which === 89))\n      store.dispatch(UndoActionCreators.redo());\n  });\n} catch (e) {}\n\nexport default store;\n\n// produce global selectors\nexport const globalSelectors = {\n  boards: state => state.present\n}\nexport const selectors = {\n  boards: objectMap(kanban.selectors, localSelector => state => localSelector(globalSelectors.boards(state)))\n};\n","\nimport * as React from 'react';\nimport { parseWikilinks } from '../common';\nimport { MarkdownBase } from './markdown-base';\n\n// Dynamic import via webpack code splitting and React.lazy\nconst KaTeXMarkdown = React.lazy(() => import('./markdown-katex'));\n\n// Takes either a cards prop or a source prop\n// Parses wikilinks if the cards prop is present\n// Parses $$math$$ and syntax highlights ```js\\ncode\\n``` if present, lazy loading the relevant libraries\nexport default props => {\n  // Parse wikilinks if available\n  let source = props.cards ? parseWikilinks(props.source, props.cards) : props.source;\n  // Parse LaTeX formulae if present\n  // As KaTeX is 250kB minified we dynamically import it only if we need to\n  if (source.indexOf(\"$$\") === -1) {\n    return (\n      <MarkdownBase {...props} source={source} />\n    );\n  } else {\n    return (\n      <React.Suspense fallback={<span>Loading...</span>}>\n        <KaTeXMarkdown {...props} source={source} />\n      </React.Suspense>\n    );\n  }\n};\n","\nimport * as React from 'react';\nimport { TextField } from '@material-ui/core';\nimport { Textcomplete } from '@textcomplete/core';\nimport { TextareaEditor } from '@textcomplete/textarea';\nimport { selectors } from '../store';\nimport { useSelector } from 'react-redux';\nimport { searchCards, linkName, generateID } from '../common';\n\n// If addNote is a function an 'Add note' option will appear\n// It inserts a link to a note with a generated ID, and invokes\n// addNote on the generated ID.\nexport default ({ value, setValue, autoFocus = false, addNote, rows, rowsMax }) => {\n\n  const inputRef = React.useRef(null);\n  const cards = useSelector(selectors.boards.cards);\n\n  React.useEffect(() => {\n    const editor = new TextareaEditor(inputRef.current);\n    const strategy = {\n      // String -> Bool -- whether to proceed to matching phase\n      context: beforeCursor => beforeCursor.indexOf('[[') >= 0,\n      match: /\\[\\[([A-Za-z0-9_ -]+)$/, // captures the X in \"abc [[X\"\n      // term is captured substring; can use async (t, cb) => cb(await something(term));\n      search: (term, callback /*, match*/) => callback([...searchCards(term, cards), 0]),\n      cache: true,\n      // these take the input to the search callback\n      template: cardID => cardID === 0 ? (addNote ? `<em>Add note</em>` : '') : linkName(cards[cardID]),\n      replace: cardID => {\n        if (cardID === 0 && addNote) {\n          const id = generateID();\n          // run addNote after replacing text\n          window.setTimeout(() => addNote(id), 0);\n          return `[[${id}]]`;\n        } else {\n          return `[[${cardID}]]`;\n        }\n      },\n    }\n    const options = {\n      dropdown: {\n        rotate: true, // this means vertical wrapping under up/down arrows\n        maxCount: 10,\n      }\n    };\n    const textcomplete = new Textcomplete(editor, [strategy], options);\n    // cleanup\n    return () => {\n      textcomplete.destroy();\n      delete window['__addNote']\n    }\n    // eslint-disable-next-line\n  }, []); // passing dependencies breaks it\n\n  return (\n    <TextField margin=\"dense\" fullWidth variant=\"outlined\" autoFocus={autoFocus}\n      multiline rows={rows} rowsMax={rowsMax} value={value} onChange={e => setValue(e.target.value)}\n      inputProps={{ ref: inputRef }} />\n  );\n};\n","\nimport * as React from 'react';\nimport Markdown from '../../components/markdown';\nimport { ClickAwayListener, InputLabel } from '@material-ui/core';\nimport NotesIcon from '@material-ui/icons/Notes';\nimport { IndicatorBuilder, AttributeHeader } from '.';\nimport { selectors } from '../../store';\nimport AutocompleteEditor from '../../components/autocomplete-editor';\nimport { useSelector } from 'react-redux';\nimport { abbreviatedDescription } from '../../common';\n\nexport const Edit = ({ card, setCard }) => {\n  const [editingDescription, setEditingDescription] = React.useState(false);\n  const setDescription = description => setCard({...card,\n      description: description.length ? description : undefined});\n  const cards = useSelector(selectors.boards.cards);\n\n  if (!editingDescription && typeof card.description !== 'string')\n    return (\n      <AttributeHeader onClick={() => setEditingDescription(true)}>\n        Add description\n      </AttributeHeader>\n    );\n\n  const handleKeyDown = e => {\n    if (editingDescription) {\n      // Escape\n      if (e.which === 27) {\n        setEditingDescription(false);\n        // Don't escape the edit modal dialog\n        e.stopPropagation();\n      }\n    } else {\n      // Space and Enter while focused enable editing mode\n      if (document.activeElement === e.target) {\n        if ([32, 13].indexOf(e.which) !== -1) {\n          // Add a timeout to prevent the space/enter from being typed\n          setTimeout(() => setEditingDescription(true), 0);\n        }\n      }\n    }\n  };\n\n  return !editingDescription ? (\n    <div style={{marginTop: 8, overflow: 'auto'}}\n      >\n      <InputLabel className=\"custom-label\"\n        onClick={() => setEditingDescription(true)}>\n        Description</InputLabel>\n      <Markdown source={card.description} cards={cards}\n        tabIndex='0' onKeyDown={handleKeyDown}\n        className=\"markdown-selectable markdown\"\n        onDoubleClick={() => setEditingDescription(true)} />\n    </div>\n  ) : (\n    <React.Fragment>\n      <InputLabel className=\"custom-label\">Description</InputLabel>\n      <ClickAwayListener onClickAway={() => setEditingDescription(false)}>\n        <div style={{width:'100%',height:'100%'}}\n          onKeyDown={handleKeyDown}>\n          <AutocompleteEditor value={card.description} setValue={setDescription}\n            autoFocus rows={6} rowsMax={24} />\n        </div>\n      </ClickAwayListener>\n    </React.Fragment>\n  );\n};\n\nexport const Indicator = ({ card }) => {\n  if (card.description) {\n    const title = abbreviatedDescription(card);\n    return <IndicatorBuilder label={null} title={title} icon={<NotesIcon />} />;\n  } else return null;\n};\n","\nimport * as React from 'react';\nimport { IconButton, InputLabel } from '@material-ui/core';\nimport AccessTimeIcon from '@material-ui/icons/AccessTime';\nimport { MuiPickersUtilsProvider, DateTimePicker } from '@material-ui/pickers';\nimport DateFnsUtils from '@date-io/date-fns';\nimport { format, startOfToday } from 'date-fns';\nimport { enAU } from 'date-fns/locale';\nimport { prettyPrintDate, timeUrgencyClassName } from '../../common';\nimport { IndicatorBuilder, AttributeHeader } from '.';\nimport CloseIcon from '@material-ui/icons/Close';\n\nenAU.weekStart = 1;\n\nexport const Edit = ({ card, setCard }) => {\n  const setDateTime = time => setCard({...card, time});\n\n  return card.time ? (\n    <div style={{marginTop: 10}}>\n      <InputLabel className=\"custom-label\">Date &amp; time</InputLabel>\n      <MuiPickersUtilsProvider utils={DateFnsUtils} locale={enAU}>\n        <DateTimePicker\n          value={new Date(card.time)}\n          onChange={newDate => setDateTime(newDate.getTime())}\n          showTodayButton\n          format=\"MMMM do hh:mm aaa\" />\n      </MuiPickersUtilsProvider>\n      <IconButton size=\"small\" style={{ marginLeft: 10 }}\n        onClick={() => setDateTime(null)}>\n        <CloseIcon />\n      </IconButton>\n    </div>\n  ) : (\n    <AttributeHeader onClick={() => setDateTime(startOfToday().getTime())}>\n      Add date &amp; time\n    </AttributeHeader>\n  );\n};\n\nexport const Indicator = ({ card }) => {\n  if (card.time) {\n    return <IndicatorBuilder\n      icon={<AccessTimeIcon />}\n      label={prettyPrintDate(card.time)}\n      title={format(new Date(card.time), \"dd/MM/yyyy hh:mmaaa\")}\n      className={timeUrgencyClassName(new Date(card.time).getTime())}\n    />\n  } else return null;\n};\n","\nimport * as React from 'react';\nimport { TextField, InputLabel, IconButton } from '@material-ui/core';\nimport HourglassEmptyIcon from '@material-ui/icons/HourglassEmpty';\nimport { IndicatorBuilder, AttributeHeader } from '.';\nimport CloseIcon from '@material-ui/icons/Close';\n\nexport const Edit = ({ card, setCard }) => {\n  const [durationStr, setDurationStr] = React.useState(card.duration ? prettySeconds(card.duration) : \"\");\n  const autoFocusRef = React.useRef(null);\n  const setDuration = str => {\n    const duration = unprettySeconds(str);\n    setDurationStr(str);\n    if (typeof duration === \"number\") {\n      setCard({ ...card, duration });\n    }\n  }\n\n  const resetDuration = () => setCard({...card, duration: null});\n  const addDuration = () => {\n    setDuration('1h');\n    setTimeout(() => {\n      try {\n        autoFocusRef.current.focus();\n      } catch (e) {}\n    }, 0);\n  };\n\n  if (!card.duration) {\n    return (\n      <AttributeHeader onClick={addDuration}>\n        Add duration\n      </AttributeHeader>\n    );\n  }\n\n  // returns true iff the string is non-empty but in incorrect format (correct format is stuff like \"1h30m\")\n  const invalid = str => str !== \"\" && str !== null && unprettySeconds(str) === null;\n\n  return (\n    <div style={{marginTop: 10}}>\n      <InputLabel className=\"custom-label\">Duration</InputLabel>\n      <TextField\n        style={{width: 201, marginTop: 4}}\n        ref={autoFocusRef}\n        margin=\"dense\" fullWidth\n        value={durationStr}\n        error={invalid(durationStr)}\n        helperText={invalid(durationStr) ? \"Invalid format. Examples: 2d 1h 30m, 5m\" : null}\n        onChange={e => setDuration(e.target.value)} />\n      <IconButton size=\"small\" style={{ marginLeft: 10 }}\n        onClick={resetDuration}>\n        <CloseIcon />\n      </IconButton>\n    </div>\n  )\n};\n\n// Pretty print seconds in short form like 3600->1h, 6300->1h45m (no days or seconds)\nconst prettySeconds = s => {\n  if (typeof (s) === 'string') return s;\n  const days = Math.floor(s / 86400);\n  const hours = Math.floor((s % 86400) / 3600);\n  const minutes = Math.floor((s % 3600) / 60);\n  if (days === 0 && hours === 0 && minutes === 0) return '0m';\n  const str = (days ? days + 'd ' : '') + (hours ? hours + 'h ' : '') + (minutes ? minutes + 'm' : '');\n  return str.trim();\n};\n\n// Inverse of prettySeconds; used so the input field can be edited in pretty form\nlet unprettySeconds = s => {\n  if (typeof s === \"number\") return s;\n  // this parses it to [x, '0d','1h', '30m'] if possible, or [x, undefined, '1h',undefined]\n  // or [x, undefined, undefined,'30m']\n  // if only one is present, where x is irrelevant\n  let groups = (/^(\\d+d|\\d*\\.\\d+d)?\\s*(\\d+h|\\d*\\.\\d+h)?\\s*(\\d+m|\\d*\\.\\d+m)?$/m).exec(s);\n\n  // check there are 4 matches where at least one of the latter 3 are defined\n  if (!groups || groups.length !== 4 || !groups.slice(1).filter(x=>x).length)\n    return null;\n  else groups = groups.slice(1);\n\n  const pf = k => parseFloat(k.substring(0, k.length-1)); // \"1.5h\" -> 1.5\n  return 86400*pf(groups[0] || '0d') + 3600*pf(groups[1] || '0h') + 60*pf(groups[2] || '0m');\n};\n\nexport const Indicator = ({ card }) => {\n  if (card.duration) {\n    const label = prettySeconds(card.duration);\n    const title = `Duration: ${label}`;\n    const icon = <HourglassEmptyIcon />;\n    return <IndicatorBuilder label={label} title={title} icon={icon} />;\n  } else return null;\n};\n","\nimport * as React from 'react';\nimport { Chip, Button } from '@material-ui/core';\n\nimport * as Description from './description';\nimport * as DateTime from './datetime';\nimport * as Duration from './duration';\nexport { Description, DateTime, Duration };\n\nexport const IndicatorBuilder = ({ icon, label, title, className }) =>\n  <Chip size='small' icon={icon}\n    label={label}\n    title={title}\n    classes={label && label.length ? null : { label: 'attribute-label' }}\n    className={'attribute-indicator ' + (className || \"\")}\n    variant='outlined' />;\n\nexport const AttributeHeader = props =>\n  <div className='attribute-header'>\n    <Button variant='outlined' color='primary' size='small' {...props} />\n  </div>;\n","\nimport * as React from 'react';\nimport { Button, Dialog, DialogActions, DialogContent, DialogContentText, DialogTitle,\n         TextField, InputLabel, Select, MenuItem,\n         ListSubheader } from '@material-ui/core';\nimport * as duck from '../ducks/kanban';\nimport { globalSelectors as sel, selectors } from '../store';\nimport { useDispatch, useSelector } from 'react-redux';\nimport { Description, DateTime, Duration } from '../kanban/attributes';\nimport { ReloadProtect } from '../common';\nimport { MarkdownBase } from './markdown-base';\n\nexport const ConfirmDialog = ({ open, respond, title, subtitle, labels = [\"Cancel\", \"OK\"] }) => {\n  return (\n    <Dialog open={open} onClose={() => respond(null)}>\n      <DialogTitle>{title}</DialogTitle>\n      <DialogContent>\n        <DialogContentText>\n          {subtitle}\n        </DialogContentText>\n      </DialogContent>\n      <DialogActions>\n        <Button onClick={() => respond(false)} color=\"primary\">\n          {labels[0]}\n        </Button>\n        <Button onClick={() => respond(true)} color=\"primary\" variant=\"contained\" autoFocus>\n          {labels[1]}\n        </Button>\n      </DialogActions>\n    </Dialog>\n  );\n}\n\nexport const PromptDialog = ({\n  open, respond, title, subtitle, labels = [\"Cancel\", \"OK\"],\n  label, inputType = \"text\", placeholder = \"\", buttons = null\n}) => {\n  const [value, setValue] = React.useState(placeholder);\n  const done = x => { respond(x); setValue(placeholder) };\n  return (\n    <Dialog open={open} onClose={() => done(null)}>\n      <DialogTitle>{title}</DialogTitle>\n      <DialogContent>\n        {typeof subtitle === \"string\" && (\n          <DialogContentText>\n            {subtitle}\n          </DialogContentText>\n        )}\n        <TextField autoFocus margin=\"dense\" fullWidth\n          label={label} type={inputType} value={value} onChange={e => setValue(e.target.value)} />\n      </DialogContent>\n      <DialogActions>\n        {buttons}\n        <Button onClick={() => done(false)} color=\"primary\">\n          {labels[0]}\n        </Button>\n        <Button onClick={() => done(value)} color=\"primary\" variant=\"contained\">\n          {labels[1]}\n        </Button>\n      </DialogActions>\n    </Dialog>\n  );\n}\n\nexport const CardEditDialog = ({ respond, card }) => {\n  const dispatch = useDispatch();\n\n  const currentColID = useSelector(state => Object.values(sel.boards(state).columns)\n      .filter(col => col.items.indexOf(card.id) !== -1)[0].id);\n\n  const [colID, setColID] = React.useState(currentColID);\n  const [newCard, setCard] = React.useState(card);\n  const setContent = content => setCard({...newCard, content});\n\n  const columns = useSelector(selectors.boards.columns);\n  const tabs = useSelector(selectors.boards.tabs);\n\n  const done = () => {\n    respond();\n    setContent(card.content);\n  }\n  // save and then delete so you can undo the delete without losing your unsaved draft of a card\n  const deleteCard = () => {\n    dispatch(duck.editCard({ card: newCard, colID }));\n    dispatch(duck.deleteCard(card.id));\n    done();\n  }\n  const editCard = () => {\n    dispatch(duck.editCard({ card: newCard, colID }));\n    done();\n  }\n\n  return (\n    <Dialog open onClose={() => done(null)} fullWidth maxWidth='md'\n      disableBackdropClick={JSON.stringify(newCard) !== JSON.stringify(card)}>\n      <ReloadProtect shouldProtect={JSON.stringify(newCard) !== JSON.stringify(card)} />\n      <DialogTitle>Edit card</DialogTitle>\n      <DialogContent>\n        <InputLabel id=\"kanban/card-column\" className=\"custom-label\">Column</InputLabel>\n        <Select labelId=\"kanban/card-column\" value={colID} onChange={e => setColID(e.target.value)}>\n          {Object.values(tabs).flatMap(tab => ([\n            // the subheader can be clicked so we add the following CSS hack (per mui#18200)\n            // .MuiListSubheader-root { pointer-events: none; }\n            <ListSubheader key={tab.id}>{tab.name}</ListSubheader>,\n            ...tab.columns.map(colID =>\n              <MenuItem value={colID} key={colID}>{columns[colID].name}</MenuItem>\n            )\n          ]))}\n        </Select>\n        <InputLabel id=\"kanban/card-title\" className=\"custom-label\">Title</InputLabel>\n        <TextField margin=\"dense\" autoFocus fullWidth\n          multiline rowsMax={3} value={newCard.content} onChange={e => setContent(e.target.value)} />\n        <Description.Edit card={newCard} setCard={setCard} />\n        <DateTime.Edit    card={newCard} setCard={setCard} />\n        <Duration.Edit    card={newCard} setCard={setCard} />\n      </DialogContent>\n      <DialogActions>\n        <Button onClick={deleteCard}>Delete</Button>\n        <Button onClick={done} color=\"primary\">Cancel</Button>\n        <Button onClick={editCard} color=\"primary\" variant=\"contained\">OK</Button>\n      </DialogActions>\n    </Dialog>\n  );\n}\n\nexport const AboutDialog = ({ open, respond }) => {\n  return (\n    <Dialog open={open} onClose={respond} fullWidth>\n      <DialogTitle>About Mirror</DialogTitle>\n      <DialogContent>\n        <DialogContentText>\n          A free and open source personal task management and note taking app.<br/>\n\n          Made by Oliver Balfour. &copy; 2020-2021.<br/>\n\n          App icon is <a href=\"https://thenounproject.com/term/mirror/340140/\">Mirror</a>&nbsp;\n          by Lastspark from <a href=\"http://thenounproject.com/\">The Noun Project</a>.\n        </DialogContentText>\n      </DialogContent>\n      <DialogActions>\n        <Button onClick={respond} color=\"primary\" variant=\"contained\" autoFocus>\n          OK\n        </Button>\n      </DialogActions>\n    </Dialog>\n  );\n}\n\nexport const GitHubLoginDialog = ({ open, respond }) => {\n  const [token, setToken] = React.useState(\"\");\n  const [gistID, setGistID] = React.useState(\"\");\n  const [username, setUsername] = React.useState(\"\");\n  return (\n    <Dialog open={open} onClose={respond} fullWidth>\n      <DialogTitle>Log in via GitHub</DialogTitle>\n      <DialogContent>\n        <DialogContentText>\n          <MarkdownBase source={`To log in via GitHub for synchronisation,\n            [create a new token](https://github.com/settings/tokens/new) with\n            the \\`gist\\` permission and save it somewhere safe. Then, go to\n            [gist.github.com](https://gist.github.com) and create a new Gist\n            with any title and add one file, \\`main.md\\`, with any contents.\n            Then click \"Create secret gist\" and copy the gist ID from the URL.\n            Enter your token, gist ID and username below.`} />\n        </DialogContentText>\n        <InputLabel className=\"custom-label\">GitHub Username</InputLabel>\n        <TextField margin=\"dense\" fullWidth\n          value={username} onChange={e => setUsername(e.target.value)}\n          autoComplete=\"username\" />\n        <InputLabel className=\"custom-label\">Gist ID</InputLabel>\n        <TextField margin=\"dense\" fullWidth\n          value={gistID} onChange={e => setGistID(e.target.value)}\n          autoComplete=\"off\" />\n        <InputLabel className=\"custom-label\">GitHub access token</InputLabel>\n        <TextField margin=\"dense\" autoFocus fullWidth\n          value={token} onChange={e => setToken(e.target.value)}\n          type=\"password\" autoComplete=\"current-password\" />\n      </DialogContent>\n      <DialogActions>\n        <Button onClick={() => respond(false)} color=\"primary\">\n          Cancel\n        </Button>\n        <Button onClick={() => respond(token, gistID, username)} color=\"primary\" variant=\"contained\">\n          Log in\n        </Button>\n      </DialogActions>\n    </Dialog>\n  );\n}\n","\n/**\n * MenuBar component\n *\n * <MenuBar active={0} setActive={...} />\n *  (active is index of current screen)\n *\n */\n\nimport React from 'react';\nimport { useDispatch } from 'react-redux';\nimport * as duck from '../ducks/kanban';\nimport { loggedIn, logOut } from '../backends/github';\nimport { AppBar, Toolbar, IconButton, Tabs, Tab } from '@material-ui/core';\nimport MoreIcon from '@material-ui/icons/MoreVert';\nimport DeveloperBoardIcon from '@material-ui/icons/DeveloperBoard';\nimport NotesIcon from '@material-ui/icons/Notes';\nimport PopoverMenu from './popovermenu';\nimport { UndoRedo } from '../components';\nimport { AboutDialog, GitHubLoginDialog } from './dialogs';\nimport { config, postLogIn } from '../backends/github';\n\nconst noop = () => '';\nconst emailAddress = 'leolalor1+mirrorsupport'+noop()+'@googlemail'+noop()+'.com';\n\nexport default ({ active, setActive }) => {\n  const [aboutOpen, setAboutOpen] = React.useState(false);\n  const [GHOpen, setGHOpen] = React.useState(false);\n  const dispatch = useDispatch();\n\n  const githubItem = () => loggedIn()\n    ? { \"Log out of GitHub\": logOut }\n    : { \"Log in via GitHub\": () => setGHOpen(true) };\n\n  const menuItems = {\n    \"Submit feedback\": () => window.open(`mailto:${emailAddress}`, '_blank'),\n    \"About\": () => setAboutOpen(true),\n    ...githubItem(),\n    \"Clear saved state\": () => window.prompt(\"Delete all saved state? Pressing undo will fix this. Type YES to confirm\", \"NO\") === \"YES\" && window.deleteAllState(),\n  };\n\n  return (\n    <React.Fragment>\n      <AppBar color=\"primary\" style={{ top: 'auto', bottom: 0 }}>\n        <Toolbar style={{ minHeight: 0 }}>\n          <Tabs\n            value={active} onChange={(e, val) => setActive(val)}\n            TabIndicatorProps={{ style: { backgroundColor: 'white' } }}\n          >\n            <Tab label={<div><DeveloperBoardIcon style={{verticalAlign: 'middle'}} /> Boards</div>}  />\n            <Tab label={<div><NotesIcon style={{verticalAlign: 'middle'}} /> Notes</div>}  />\n          </Tabs>\n          <div style={{ flexGrow: 1 }} />\n          <UndoRedo />\n          <PopoverMenu map={menuItems}>\n            <IconButton edge=\"end\" color=\"inherit\">\n              <MoreIcon />\n            </IconButton>\n          </PopoverMenu>\n        </Toolbar>\n      </AppBar>\n      <AboutDialog open={aboutOpen} respond={() => setAboutOpen(false)} />\n      <GitHubLoginDialog open={GHOpen} respond={(token, gist_id, username) => {\n        setGHOpen(false);\n        if (token !== false) {\n          config.token = token;\n          config.gist_id = gist_id;\n          config.username = username;\n          postLogIn().then(state => dispatch(duck.overwriteState(state)));\n        }\n      }} />\n    </React.Fragment>\n  );\n}\n","\nimport * as React from 'react';\nimport { useDispatch } from 'react-redux';\nimport { IconButton } from '@material-ui/core';\nimport UndoIcon from '@material-ui/icons/Undo';\nimport RedoIcon from '@material-ui/icons/Redo';\nimport { ActionCreators } from 'redux-undo'\n\nexport default () => {\n  const dispatch = useDispatch();\n  return (\n    <React.Fragment>\n      <IconButton\n        onClick={() => dispatch(ActionCreators.undo())}\n        color=\"inherit\" edge=\"end\">\n        <UndoIcon />\n      </IconButton>\n      <IconButton\n        onClick={() => dispatch(ActionCreators.redo())}\n        color=\"inherit\" edge=\"end\">\n        <RedoIcon />\n      </IconButton>\n    </React.Fragment>\n  );\n};\n","\nimport React from 'react';\n\nexport default props =>\n  <div className=\"loading-screen-container\">\n    <span className=\"loading-screen-contents\">\n      Loading...\n    </span>\n  </div>;\n","\nimport * as React from 'react';\nimport { useDispatch } from 'react-redux';\nimport * as duck from '../ducks/kanban';\n\nimport { IconButton } from '@material-ui/core';\nimport MoreVertIcon from '@material-ui/icons/MoreVert';\nimport AddIcon from '@material-ui/icons/Add';\nimport { PopoverMenu, ConfirmDialog, PromptDialog } from '../components';\n\n// header name, add button, chips for each addon (WIP limit, EBS time estimate, etc), menu button\nexport default ({ col, add, menu }) => {\n  const dispatch = useDispatch();\n\n  const [confirmOpen, setConfirmOpen] = React.useState(false);\n  const confirmRespond = res => {\n    setConfirmOpen(false);\n    if (res) dispatch(duck.deleteColumn(col.id))\n  }\n\n  const [promptOpen, setPromptOpen] = React.useState(false);\n  const promptRespond = res => {\n    setPromptOpen(false);\n    if (typeof res === \"string\" && res.length)\n      dispatch(duck.renameColumn({ colID: col.id, name: res }));\n  }\n\n  const archiveAll = () => dispatch(duck.archiveCardsInColumn(col.id));\n\n  const dateTimeAttributeUsed = col.items.filter(card => ['string','number'].indexOf(typeof card.time) !== -1).length > 0;\n  const sortByDue = () => dispatch(duck.sortColByTime(col.id));\n\n  return (\n    <div>\n      <div className='columnHeaderContainer'>\n        <div className='columnHeaderText'>\n          {col.name}\n        </div>\n        <div>\n          {/*\n            // TODO: column powerup API with Chip indicators\n            <Chip size='small' label=\"0/6\" />\n            <Chip size='small' label=\"3h\" />\n          */}\n          <IconButton size='small' onClick={() => add()}>\n            <AddIcon />\n          </IconButton>\n          <PopoverMenu map={{\n            \"Archive all\": () => archiveAll(),\n            ...(dateTimeAttributeUsed ? {\n              \"Sort by due\": () => sortByDue(),\n            } : {}),\n            \"Rename\": () => setPromptOpen(true),\n            \"Delete\": () => setConfirmOpen(true),\n          }}>\n            <IconButton size='small'>\n              <MoreVertIcon />\n            </IconButton>\n          </PopoverMenu>\n        </div>\n      </div>\n      <hr className='columnHeaderRule' />\n      {confirmOpen && (\n        <ConfirmDialog open respond={confirmRespond}\n          title=\"Delete this column?\" subtitle=\"Don't worry, this action can be undone.\" />\n      )}\n      {promptOpen && (\n        <PromptDialog open respond={promptRespond}\n          title={`Rename column \"${col.name}\"`} subtitle=\"Don't worry, this action can be undone.\"\n          label=\"Name\" placeholder={col.name} />\n      )}\n    </div>\n  );\n};\n","\nimport * as React from 'react';\nimport { useSelector } from 'react-redux';\nimport { selectors } from '../store';\nimport { Draggable } from 'react-beautiful-dnd';\nimport { Markdown } from '../components';\nimport { Description, DateTime, Duration } from './attributes';\n\nexport default React.memo(({ card, index, setEditingCard }) => {\n  const cards = useSelector(selectors.boards.cards);\n  if (!card) return null;\n  const { id, content } = card;\n\n  return (\n    <React.Fragment>\n      <Draggable draggableId={id} index={index}>\n        {(provided, snapshot) => (\n          <div ref={provided.innerRef}\n            {...provided.draggableProps}\n            {...provided.dragHandleProps}\n            className={'card ' + (snapshot.isDragging ? \" draggingCard\" : \"\")}\n            style={provided.draggableProps.style}\n            onClick={() => setEditingCard(id)}>\n            <Markdown source={content} cards={cards} />\n            <Description.Indicator card={card} />\n            <DateTime.Indicator    card={card} />\n            <Duration.Indicator    card={card} />\n          </div>\n        )}\n      </Draggable>\n    </React.Fragment>\n  );\n});\n","\nimport * as React from 'react';\nimport { useDispatch } from 'react-redux';\nimport * as duck from '../ducks/kanban';\nimport { Button, IconButton, ButtonGroup, TextField } from '@material-ui/core';\nimport AddIcon from '@material-ui/icons/Add';\nimport DeleteIcon from '@material-ui/icons/Delete';\nimport { Droppable, Draggable } from 'react-beautiful-dnd';\nimport { mergeRefs } from '../common';\nimport ColumnHeader from './column-header';\nimport Card from './card';\n\nexport default React.memo(({ col, index, setEditingCard }) => {\n  const { id, items } = col;\n\n  const [editingNew, setEditingNew] = React.useState(false);\n  const [editingValue, setEditingValue] = React.useState(\"\");\n  const dispatch = useDispatch();\n  const addCard = () => {\n    if (editingValue.length)\n      dispatch(duck.addCard({\n        content: editingValue,\n        colID: id\n      }));\n    setEditingValue(\"\");\n    setEditingNew(false);\n  };\n  const addButton = () => {\n    if (editingNew)\n      setEditingValue(\"\");\n    else\n      // scroll so that the add card section at the top is visible\n      scrollContainerRef.current.scrollTop = 0;\n    setEditingNew(!editingNew);\n  };\n  const scrollContainerRef = React.useRef(null);\n  const menuButton = () => {\n    console.log('pressed menu button');\n  };\n  const internals = (\n    <Droppable droppableId={id} className='card-droppable' type=\"card\" ignoreContainerClipping>\n      {(provided, snapshot) => (\n        <React.Fragment>\n          <div\n            className={'column-internals' + (snapshot.isDraggingOver ? ' dragging-over' : '')}\n            ref={mergeRefs(provided.innerRef, scrollContainerRef)}\n          >\n            {editingNew && (\n              <EditingCard value={editingValue} setValue={setEditingValue}\n                add={addCard} cancel={() => { setEditingValue(\"\"); setEditingNew(false) }} />\n            )}\n            {items.map((card, index) => card ? <Card card={card} index={index} key={card.id}\n              setEditingCard={setEditingCard} /> : null)}\n          </div>\n          {provided.placeholder}\n        </React.Fragment>\n      )}\n    </Droppable>\n  );\n\n  return (\n    <Draggable draggableId={id} index={index}>\n      {(provided, snapshot) => (\n        <div ref={provided.innerRef}\n          {...provided.draggableProps}\n          className={\"columnContainer\" + (snapshot.isDragging ? \" draggingColumn\" : \"\")}\n          style={provided.draggableProps.style}>\n          <div className=\"column\">\n            <div {...provided.dragHandleProps}>\n              <ColumnHeader col={col} add={addButton} menu={menuButton} />\n            </div>\n            {internals}\n          </div>\n        </div>\n      )}\n    </Draggable>\n  );\n});\n\nconst EditingCard = ({ value, setValue, add, cancel }) => {\n  React.useEffect(() => {\n    // Pressing ESC cancels editing a card\n    const cb = e => e.which === 27 && cancel();\n    document.addEventListener('keydown', cb);\n    return () => document.removeEventListener('keydown', cb);\n  });\n  return (\n    <div>\n      <TextField\n        label=\"New Card\"\n        multiline\n        autoFocus\n        rowsMax={6}\n        value={value}\n        onChange={e => setValue(e.target.value)}\n        variant=\"filled\"\n        style={{ width: \"100%\" }} />\n      <ButtonGroup variant=\"contained\" size='small' className='editingCardButtons'>\n        <Button style={{flexGrow: 1}} variant='contained' onClick={add}>\n          Done\n        </Button>\n        <Button onClick={cancel}><DeleteIcon style={{color: '#555'}} /></Button>\n      </ButtonGroup>\n    </div>\n  );\n};\n\nexport const AddColumn = ({ add, hide }) => {\n  return (\n    <div className={'addColumnContainer' + (hide ? ' hidden' : '')}>\n      <div className='addColumn'>\n        <IconButton onClick={add}>\n          <AddIcon />\n        </IconButton>\n      </div>\n    </div>\n  );\n}\n","\nimport * as React from 'react';\nimport { useSelector, useDispatch } from 'react-redux';\nimport * as duck from '../ducks/kanban';\nimport { selectors } from '../store';\nimport { DragDropContext, Droppable } from 'react-beautiful-dnd';\nimport { PromptDialog, CardEditDialog } from '../components';\nimport { useHashLocation } from '../common';\nimport Column, { AddColumn } from './column';\nimport './index.scss';\n\nexport default ({ tabInfo }) => {\n  const tab = tabInfo.index;\n  const tabObj = tabInfo.tab;\n  const dispatch = useDispatch();\n\n  const tabOrder = useSelector(selectors.boards.tabOrder);\n  const columns = useSelector(selectors.boards.getColumnsInTabs)[tabOrder[tab]];\n  const tabs = useSelector(selectors.boards.tabs);\n  const cards = useSelector(selectors.boards.cards);\n  const colIDs = tabs[tabOrder[tab]].columns;\n\n  // dispatch move card action\n  const onDragEnd = res => {\n    if (!res.destination) return;\n    if (res.type === \"card\") {\n      dispatch(duck.moveCard([\n        res.source.droppableId, res.destination.droppableId,\n        res.source.index, res.destination.index\n      ]));\n    } else if (res.type === \"column\") {\n      dispatch(duck.moveColumn([\n        res.source.index, res.destination.index, tab\n      ]));\n    }\n  };\n\n  const [promptOpen, setPromptOpen] = React.useState(false);\n  const promptRespond = name => {\n    setPromptOpen(false);\n    if (typeof name === \"string\" && name.length)\n      dispatch(duck.addColumn({ tabID: tabObj.id, name }));\n  }\n\n  const [loc, setLoc] = useHashLocation();\n  // editing card if URL is /board/CARD_ID/edit\n  const editingCard = loc.split(\"/\")[4] === \"edit\" ? loc.split(\"/\")[3] : null;\n\n  const cardsByTab = useSelector(selectors.boards.cardsByTab);\n  const tabIDfromCardID = id => Object.keys(cardsByTab).filter(tabID => cardsByTab[tabID].indexOf(id) !== -1);\n  const setEditingCard = id => id\n    ? setLoc(`/boards/${tabs[tabIDfromCardID(id)].name.toLowerCase()}/${id}/edit`)\n    : setLoc(`/boards/${loc.split(\"/\")[2]}`);\n\n  return (\n    <div className='boardview-root'>\n      <DragDropContext onDragEnd={onDragEnd}>\n        <Droppable droppableId=\"default\" className='column-droppable' direction=\"horizontal\" type=\"column\">\n          {(provided, snapshot) => (\n            <React.Fragment>\n              <div className='root' ref={provided.innerRef}>\n                {colIDs.map((colID, i) => <Column col={columns[i]} key={colID} index={i}\n                  setEditingCard={setEditingCard} />)}\n                <AddColumn add={() => setPromptOpen(true)} hide={snapshot.isDraggingOver || snapshot.draggingFromThisWith} />\n              </div>\n              {provided.placeholder}\n            </React.Fragment>\n          )}\n        </Droppable>\n      </DragDropContext>\n      {promptOpen && (\n        <PromptDialog open respond={promptRespond}\n          title=\"Add column\" label=\"Name\" />\n      )}\n      {editingCard && Object.prototype.hasOwnProperty.call(cards, editingCard) && (\n        <CardEditDialog respond={() => setEditingCard(null)} card={cards[editingCard]} />\n      )}\n    </div>\n  );\n}\n","\nimport * as React from 'react';\nimport { useSelector, useDispatch } from 'react-redux';\nimport { TabView } from '../components';\nimport BoardView from './boardview';\nimport * as duck from '../ducks/kanban';\nimport { selectors } from '../store';\nimport { ConfirmDialog, PromptDialog } from '../components';\nimport { useHashLocation, useTitle } from '../common';\n\nexport default ({ active }) => {\n  const dispatch = useDispatch();\n  const [loc, setLoc] = useHashLocation();\n  // {id:{name, id, columns (ids)},...}\n  const tabs = useSelector(selectors.boards.tabs);\n  const tabOrder = useSelector(selectors.boards.tabOrder);\n  let currentTab = tabOrder.map(tabID => tabs[tabID].name.toLowerCase() === loc.split(\"/\")[2]).indexOf(true);\n  const setCurrentTab = num => setLoc(\"/boards/\"+tabs[tabOrder[num]].name.toLowerCase());\n  useTitle(() => active && currentTab >= 0 && tabs[tabOrder[currentTab]].name + \" | Mirror\");\n  if (currentTab < 0) currentTab = 0;\n\n  const [confirmOpen, setConfirmOpen] = React.useState(false);\n  const confirmRespond = res => {\n    setConfirmOpen(false);\n    if (res) {\n      dispatch(duck.deleteTab(currentTab));\n      setCurrentTab(Math.max(0,currentTab-1));\n    }\n  }\n\n  const [addPromptOpen, setAddPromptOpen] = React.useState(false);\n  const addPromptRespond = res => {\n    setAddPromptOpen(false);\n    if (typeof res === \"string\" && res.length)\n      dispatch(duck.addTab(res));\n  }\n\n  const [renamePromptOpen, setRenamePromptOpen] = React.useState(false);\n  const renamePromptRespond = res => {\n    setRenamePromptOpen(false);\n    if (typeof res === \"string\" && res.length)\n      dispatch(duck.renameTab({ tabID: tabOrder[currentTab], name: res }));\n  }\n\n  return (\n    <React.Fragment>\n      <TabView\n        tabs={tabOrder.map(tabID => tabs[tabID].name)}\n        render={i => <BoardView tabInfo={{ tab: tabs[tabOrder[i]], index: i }} />}\n        addTab={() => setAddPromptOpen(true)}\n        renameTab={() => setRenamePromptOpen(true)}\n        deleteTab={() => Object.values(tabs).length > 1 ? setConfirmOpen(true) : alert(\"Cannot delete only tab\")}\n        moveTab={data => dispatch(duck.moveTab(data))}\n        index={currentTab} setIndex={setCurrentTab}\n      />\n      {confirmOpen && (\n        <ConfirmDialog open respond={confirmRespond}\n          title=\"Delete this tab?\" subtitle=\"Don't worry, this action can be undone.\" />\n      )}\n      {addPromptOpen && (\n        <PromptDialog open respond={addPromptRespond} title=\"Add tab\" label=\"Name\" />\n      )}\n      {renamePromptOpen && (\n        <PromptDialog open respond={renamePromptRespond}\n          title={`Rename tab ${tabs[tabOrder[currentTab]].name}`} label=\"Name\" />\n      )}\n    </React.Fragment>\n  );\n}\n","\nimport * as React from 'react';\nimport { useHashLocation, useTitle, generateID, ReloadProtect } from '../common';\nimport { selectors } from '../store';\nimport { useSelector, useDispatch } from 'react-redux';\nimport { Markdown, AutocompleteEditor } from '../components';\nimport {\n  TextField, Button, ButtonGroup,\n  // Drawer, List, Divider, ListItem, ListItemText\n} from '@material-ui/core';\nimport EditIcon from '@material-ui/icons/Edit';\nimport DeleteIcon from '@material-ui/icons/Delete';\nimport AddIcon from '@material-ui/icons/Add';\nimport SearchIcon from '@material-ui/icons/Search';\nimport StarIcon from '@material-ui/icons/Star';\nimport StarBorderIcon from '@material-ui/icons/StarBorder';\nimport * as duck from '../ducks/kanban.js';\nimport './index.scss';\n\nexport default ({ active }) => {\n  const [loc] = useHashLocation();\n  const dispatch = useDispatch();\n  const cards = useSelector(selectors.boards.cards);\n  const loadingZettel = useSelector(selectors.boards.loadingZettel);\n\n  const currentCardID = loc.split('/')[2] || 'main'; //#/notes/ID\n  // const setCurrentCardID = id => setLoc(`/notes/${id}`);\n\n  if (!Object.prototype.hasOwnProperty.call(cards, currentCardID)) {\n    // If card either does not exist, or is not loaded into memory\n    // but is in IndexedDB (assuming sync with remote server is complete)\n    dispatch(duck.loadZettel(currentCardID));\n    return <ZettelLoadingView />;\n  }\n\n  if (loadingZettel === true)\n    return <ZettelLoadingView />;\n\n  if (loadingZettel === currentCardID)\n    return <ZettelFailedLoadingView id={currentCardID} />;\n\n  return <ZettelView\n    active={active} dispatch={dispatch} cards={cards}\n    currentCardID={currentCardID} />\n}\n\nfunction ZettelLoadingView () {\n  return (\n    <span>Loading Zettel...</span>\n  );\n}\n\nfunction ZettelFailedLoadingView () {\n  return (\n    <span>Failed to load Zettel. Either synchronisation failed or it does not exist.</span>\n  );\n}\n\nfunction ZettelView ({\n  active, dispatch, cards, currentCardID\n}) {\n  const [loc, setLoc] = useHashLocation();\n  const starred = useSelector(selectors.boards.starredZettels);\n  const card = cards[currentCardID];\n  const [newCard, setNewCard] = React.useState({ ...card }); // assuming no deep nesting\n  useTitle(() => active && newCard.content + \" | Mirror\");\n  const setCard = part => setNewCard({ ...newCard, ...part });\n\n  if (typeof card !== 'object') return null;\n\n  const editing = loc.split('/')[3] === 'edit'; //#/notes/ID/edit\n  const setEditing = yes => yes\n    ? setLoc(`/notes/${currentCardID}/edit`)\n    : setLoc(`/notes/${currentCardID}`);\n  const cancelEditing = () => {\n    setEditing(false);\n    setNewCard({...card});\n  }\n\n  const deleteZettel = () => {\n    dispatch(duck.deleteCard(currentCardID));\n    setLoc('/notes/main');\n  }\n  const saveZettel = zettel => {\n    dispatch(duck.editZettel({ zettel }));\n    setEditing(false);\n  }\n  const starZettel = () =>\n    dispatch(duck.toggleZettelStarred(currentCardID));\n\n  // update editing field on card change\n  if (card.id !== newCard.id) {\n    // We want to save the card if the 'Add note' button was pressed\n    // The only time a card is not saved is if you press cancel or delete\n    dispatch(duck.editZettel({ zettel: newCard }));\n    setNewCard({ ...card });\n  }\n\n  const addZettel = id => {\n    // create a new card and navigate to editing it\n    dispatch(duck.addZettel({ zettel: { content: 'New note', description: '...', id } }));\n    setLoc(`/notes/${id}/edit`);\n  };\n\n  const addNewNote = id => {\n    dispatch(duck.editZettel({ zettel: newCard }));\n    addZettel(id);\n  }\n\n  return (\n    // TODO: drawer\n    // Responsive: https://material-ui.com/components/drawers/#responsive-drawer\n    // Search bar: https://material-ui.com/components/text-fields/#icons\n    //   or https://material-ui.com/components/app-bar/#app-bar-with-a-primary-search-field\n    // Starred cards\n    // All notes button (navigate to #/notes/all and show a list of notes without contents)\n    <React.Fragment>\n      <ReloadProtect shouldProtect={JSON.stringify(newCard) !== JSON.stringify(card)} />\n      <div className='zettelContainer'>\n        {/*<Drawer\n          className='zettelDrawer'\n          variant=\"permanent\"\n          classes={{\n            paper: 'zettelDrawerPaper',\n          }}\n        >\n          <div className='zettelDrawerContainer'>\n            <List>\n              {['Inbox', 'Starred', 'Send email', 'Drafts'].map((text, index) => (\n                <ListItem button key={text}>\n                  <ListItemText primary={text} />\n                </ListItem>\n              ))}\n            </List>\n            <Divider />\n            <List>\n              {['All mail', 'Trash', 'Spam'].map((text, index) => (\n                <ListItem button key={text}>\n                  <ListItemText primary={text} />\n                </ListItem>\n              ))}\n            </List>\n          </div>\n        </Drawer>*/}\n        {editing && (\n          <div className='zettel'>\n            <TextField margin=\"dense\" autoFocus fullWidth\n              multiline rowsMax={3} value={newCard.content || ''} onChange={e => setCard({ content: e.target.value })} />\n            <AutocompleteEditor value={newCard.description || ''} setValue={description => setCard({ description })}\n              addNote={addNewNote} />\n            <div className='zettelEditingButtons'>\n              <Button onClick={cancelEditing} color=\"primary\">Cancel</Button>\n              <Button onClick={() => saveZettel(newCard)} color=\"primary\" variant=\"contained\">Save</Button>\n            </div>\n          </div>\n        )}\n        <div className={'zettel' + (editing ? ' notes-editing' : '')}>\n          <div className='zettelTitle'>\n            {(editing ? newCard.content : card.content) || ''}\n          </div>\n          <Markdown source={(editing ? newCard.description : card.description) || ''} cards={cards} />\n        </div>\n      </div>\n      <div className='zettelButtons' id='zettel-buttons-container'>\n        <ButtonGroup variant='contained' color='primary'>\n          {!editing && (\n            <Button onClick={() => setEditing(true)} title=\"Edit note\">\n              <EditIcon />\n            </Button>\n          )}\n          {card.id !== 'main' && (\n            <Button onClick={deleteZettel} title=\"Delete note\">\n              <DeleteIcon />\n            </Button>\n          )}\n          {!editing && (\n            <Button onClick={() => addZettel(generateID())} title=\"Add note\">\n              <AddIcon />\n            </Button>\n          )}\n          <Button onClick={() => alert('TODO')} title=\"Search notes\">\n            <SearchIcon />\n          </Button>\n          {starred.indexOf(card.id) === -1 ? (\n            <Button onClick={starZettel} title=\"Star this note\">\n              <StarBorderIcon />\n            </Button>\n          ) : (\n            <Button onClick={starZettel} title=\"Unstar this note\">\n              <StarIcon />\n            </Button>\n          )}\n        </ButtonGroup>\n      </div>\n    </React.Fragment>\n  );\n}\n","\n/**\n * app.js\n * Main JSX source\n */\n\nimport React from 'react';\nimport { Provider, useSelector, useDispatch } from 'react-redux';\nimport * as duck from './ducks/kanban';\nimport { synchroniseState, loggedIn } from './backends/github';\nimport { useHashLocation, useInterval, Hidden } from './common';\n\nimport { MenuBar, LoadingScreen } from './components';\nimport Kanban from './kanban';\nimport Zettelkasten from './zettelkasten';\nimport store, { globalSelectors as sel } from './store';\n\nconst baseTabNames = [\"boards\", \"notes\"];\n// Get the nth segment of a slash separated list\nconst getURLPart = (str, n) =>\n  str.split(\"/\").filter(s=>s.length)[n < 0 ? str.length + n : n];\nconst getScreen = loc =>\n  Math.max(baseTabNames.indexOf(getURLPart(loc, 0)), 0);\nconst getScreenNames = () => [\"/boards/\", \"/notes/main\"];\n\nconst ComponentsContainer = ({ active, setActive }) => {\n  return (\n    <React.Fragment>\n      <Hidden show={active === 0}>\n        <Kanban active={active === 0} />\n      </Hidden>\n      <Hidden show={active === 1}>\n        <Zettelkasten active={active === 1} />\n      </Hidden>\n    </React.Fragment>\n  );\n};\n\nconst Root = () => {\n  const dispatch = useDispatch();\n  // Update state cache every little while to support concurrent changes across devices\n  // It usually takes up to 30 seconds for the revisions to become available so\n  // more frequent querying is pointless\n  useInterval(() => {\n    if (loggedIn()) {\n      synchroniseState().then(diff => dispatch(duck.overwriteState(diff)));\n    }\n  }, 15000);\n  const [loc, setLoc] = useHashLocation();\n  const [tabURLs, setTabURLs] = React.useState([]);\n  const [loading, setLoading] = React.useState(true);\n  // BUG: for some reason the intial state is not the loading state\n  // in our createReducer shim and the prevState at first is the empty undoable state\n  // The below `state.present === undefined` is a temporary workaround\n  // useSelector(console.log);\n  const currentlyLoading = useSelector(state => state.present === undefined || sel.boards(state).loading);\n  if (loading && !currentlyLoading) {\n    setTabURLs(getScreenNames());\n    setLoading(false);\n  }\n  if (currentlyLoading) return <LoadingScreen />;\n  const setTabURL = (newURL, i, move) => {\n    let newTabURLs = tabURLs.slice(0);\n    newTabURLs[i] = newURL;\n    setTabURLs(newTabURLs);\n    if (move) setLoc(newURL);\n  };\n  const active = getScreen(loc);\n  const setActive = n => {\n    if (n === active) {\n      // Return to the base page of this tab\n      setTabURL(getScreenNames()[active], active, true);\n    } else {\n      // Save the current URL as the return URL for this tab\n      setTabURL(loc, active);\n      // Set the location to the saved URL for the new tab\n      setLoc(tabURLs[n]);\n    }\n  }\n\n  const style = { height: \"calc(100% - 48px)\" };\n\n  return (\n    <div id=\"jsx-root\">\n      <div style={style}>\n        <ComponentsContainer active={active} setActive={setActive} />\n      </div>\n      <MenuBar active={active} setActive={setActive} />\n    </div>\n  );\n}\n\nexport default () =>\n  <Provider store={store}>\n    <Root />\n  </Provider>\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' },\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then(registration => {\n        registration.unregister();\n      })\n      .catch(error => {\n        console.error(error.message);\n      });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport Application from './app.js';\nimport * as serviceWorker from './serviceWorker';\nimport './index.css';\n\nReactDOM.render(\n  <Application/>,\n  document.getElementById('root')\n);\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://create-react-app.dev/docs/making-a-progressive-web-app/\nserviceWorker.unregister();\n","\nimport * as React from 'react';\nimport marked from 'marked';\nimport { RawHTMLString } from '../common';\n\nconst PrismMarked = React.lazy(() => import('./markdown-prism'));\n\nexport const MarkdownBase = ({ source, postprocess = x => x, ...props }) => {\n  try {\n    if (source.indexOf('```') !== -1) {\n      return (\n        <React.Suspense fallback={<span>Loading...</span>}>\n          <PrismMarked source={source} postprocess={postprocess} />\n        </React.Suspense>\n      );\n    } else {\n      // The RawHTMLString component internally uses DOMPurify to reduce the risk of XSS\n      return (\n        <RawHTMLString source={postprocess(marked(source, { gfm: true }))} className='markdown' {...props} />\n      );\n    }\n  } catch (e) {\n    return (\n      <span>\n        Sorry, an error occurred.\n        <br />\n        Try editing the note to ensure any LaTeX math equations and the Markdown syntax are valid.\n        <br />\n        Error: {e.toString()}\n      </span>\n    );\n  }\n}\n"],"sourceRoot":""}